(this["webpackJsonphappy-author"]=this["webpackJsonphappy-author"]||[]).push([[75],{3341:function(e,t,n){"use strict";n.r(t),n.d(t,"getPreferredVideoArtifact",(function(){return N})),n.d(t,"InlinePlayerBase",(function(){return _})),n.d(t,"InlinePlayer",(function(){return J}));var r=n(28),i=n.n(r),a=n(26),s=n.n(a),o=n(9),c=n.n(o),l=n(10),u=n.n(l),d=n(5),f=n.n(d),p=n(15),v=n.n(p),h=n(18),m=n.n(h),b=n(7),y=n.n(b),k=n(1),w=n.n(k),R=n(12),g=n.n(R),x=n(0),C=n.n(x),S=n(852),U=n(3333),F=n(3312),I=n(2104),P=n(2112),E=n(2657),O=n(2508),B=n(2461),L=n(2506),j=n(2),D=n(2109),W=function(e){var t=e.testId,n=e.selected,r=e.dimensions,i=e.onClick,a=e.innerRef;return Object(j.d)("div",{id:"inlinePlayerWrapper","data-testid":t,className:D.a,css:Object(D.b)({selected:n,dimensions:r}),onClick:i,ref:a},e.children)};function A(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=y()(e);if(t){var i=y()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return m()(this,n)}}var N=function(e){if("processed"===e.status||"processing"===e.status){var t=e.artifacts;if(!t)return;return t["video_1280.mp4"]?"video_1280.mp4":t["video_640.mp4"]?"video_640.mp4":void 0}},_=function(e){v()(n,e);var t=A(n);function n(){var e;c()(this,n);for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return e=t.call.apply(t,[this].concat(i)),w()(f()(e),"state",{}),w()(f()(e),"divRef",C.a.createRef()),w()(f()(e),"setFileSrc",(function(t){e.setState({fileSrc:t})})),w()(f()(e),"setBinaryURL",s()(g.a.mark((function t(){var n,r,i,a,s,o,c;return g.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.props,r=n.mediaClient,i=n.identifier,a=n.onError,s=i.id,o=i.collectionName,t.prev=2,t.next=5,r.file.getFileBinaryURL(s,o);case 5:c=t.sent,e.setFileSrc(c),t.next=12;break;case 9:t.prev=9,t.t0=t.catch(2),a&&a(t.t0);case 12:case"end":return t.stop()}}),t,null,[[2,9]])})))),w()(f()(e),"unsubscribe",(function(){e.subscription&&e.subscription.unsubscribe()})),w()(f()(e),"revoke",(function(){var t=e.state.fileSrc;t&&URL.revokeObjectURL(t)})),w()(f()(e),"onDownloadClick",(function(){var t=e.props,n=t.mediaClient,r=t.identifier,i=r.id,a=r.collectionName;n.file.downloadBinary(i,void 0,a)})),w()(f()(e),"onFirstPlay",(function(){var t=e.props.identifier;S.a.emit("media-viewed",{fileId:t.id,viewingLevel:"full"})})),w()(f()(e),"saveElementWidth",(function(){var t=e.props.dimensions;if(t){var n=t.width;if(n&&Object(B.a)(n)&&e.divRef.current){var r=Object(L.a)(e.divRef.current,"width");e.setState({elementWidth:r})}}})),e}return u()(n,[{key:"componentDidMount",value:function(){var e=this;this.saveElementWidth();var t=this.props,n=t.mediaClient,r=t.identifier,i=r.id,a=r.collectionName;this.revoke(),this.unsubscribe(),this.subscription=n.file.getFileState(i,{collectionName:a}).subscribe({next:function(){var t=s()(g.a.mark((function t(r){var i,s,o,c,l,u,d;return g.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if("uploading"===r.status?e.setState({isUploading:!0,progress:r.progress}):e.setState({isUploading:!1}),!e.state.fileSrc){t.next=4;break}return t.abrupt("return");case 4:if("error"===r.status||!r.preview){t.next=13;break}return t.next=7,r.preview;case 7:if(i=t.sent,!((s=i.value)instanceof Blob&&0===s.type.indexOf("video/"))){t.next=13;break}return o=URL.createObjectURL(s),e.setFileSrc(o),t.abrupt("return");case 13:if("processed"!==r.status&&"processing"!==r.status){t.next=30;break}if(c=N(r),l=r.artifacts,c&&l){t.next=19;break}return e.setBinaryURL(),t.abrupt("return");case 19:return t.prev=19,t.next=22,n.file.getArtifactURL(l,c,a);case 22:u=t.sent,e.setFileSrc(u),t.next=30;break;case 26:t.prev=26,t.t0=t.catch(19),(d=e.props.onError)&&d(t.t0);case 30:case"end":return t.stop()}}),t,null,[[19,26]])})));return function(e){return t.apply(this,arguments)}}()})}},{key:"componentWillUnmount",value:function(){this.unsubscribe(),this.revoke()}},{key:"breakpoint",get:function(){var e=this.state.elementWidth||(this.props.dimensions?this.props.dimensions.width:"")||I.a.width;return Object(O.a)(parseInt("".concat(e),10))}},{key:"render",value:function(){var e=this,t=this.props,n=t.onClick,r=t.dimensions,i=t.originalDimensions,a=t.selected,s=t.testId,o=t.identifier,c=t.forwardRef,l=t.autoplay,u=t.cardPreview,d=t.onFullscreenChange,f=this.state,p=f.fileSrc,v=f.isUploading,h=f.progress;return p?C.a.createElement(W,{testId:s||"media-card-inline-player",selected:{selected:a},onClick:n,innerRef:c||void 0,dimensions:r},C.a.createElement(U.a,null,(function(t){return C.a.createElement(F.a,{type:"video",src:p,onFullscreenChange:d,fileId:o.id,isAutoPlay:l,isHDAvailable:!1,onDownloadClick:e.onDownloadClick,onFirstPlay:e.onFirstPlay,lastWatchTimeConfig:{contentId:o.id},originalDimensions:i,showControls:t,poster:null===u||void 0===u?void 0:u.dataURI})})),v?C.a.createElement(E.a,{progress:h,breakpoint:this.breakpoint,positionBottom:!0,showOnTop:!0}):null):C.a.createElement(P.a,{testId:s,dimensions:r})}}]),n}(x.Component);w()(_,"defaultProps",{dimensions:I.a});var J=C.a.forwardRef((function(e,t){return C.a.createElement(_,i()({},e,{forwardRef:t}))}))}}]);