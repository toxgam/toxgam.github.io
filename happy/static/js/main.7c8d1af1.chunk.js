(this["webpackJsonphappy-author"]=this["webpackJsonphappy-author"]||[]).push([[2],{178:function(e,t,n){"use strict";n.d(t,"b",(function(){return l})),n.d(t,"a",(function(){return j}));var r,c=n(8),o=n(11),a=n(26),i=Object(o.a)(a.collections);try{for(i.s();!(r=i.n()).done;){var s=r.value;delete a.jsonSchemas[s].properties.id,delete a.jsonSchemas[s].properties.parentId}}catch(f){i.e(f)}finally{i.f()}var u,l={},d=Object(o.a)(a.collections);try{for(d.s();!(u=d.n()).done;){var p=u.value;l[p]={}}}catch(f){d.e(f)}finally{d.f()}var b={"ui:widget":"textarea","ui:options":{rows:20}};l.mMarkdowns.text=b,l.mSurveys.question=b,l.mQuizes.question=b,l.mQuizes.explanation=b,l.mQuotes.quote=b;var j={};a.collections.forEach((function(e){var t=a.jsonSchemas[e].properties;j[e]={};for(var n=0,r=Object.entries(t);n<r.length;n++){var o=Object(c.a)(r[n],2),i=o[0],s=o[1];j[e][i]=s.default}}))},236:function(e,t,n){"use strict";function r(e,t){return e?new Promise((function(n){var r=new Image;r.onload=function(){if(r.width<=t)n(e);else{var c=function(e,t){var n=e.height*t/e.width,r=document.createElement("canvas");return r.width=t,r.height=n,r.getContext("2d").drawImage(e,0,0,t,n),r.toDataURL("image/jpeg",.7)}(r,t);n(c)}},r.src=e})):Promise.resolve("")}n.d(t,"a",(function(){return r}))},24:function(e,t,n){"use strict";(function(e){n.d(t,"i",(function(){return f})),n.d(t,"h",(function(){return h})),n.d(t,"j",(function(){return O})),n.d(t,"g",(function(){return m})),n.d(t,"k",(function(){return x})),n.d(t,"d",(function(){return v})),n.d(t,"e",(function(){return y})),n.d(t,"b",(function(){return w})),n.d(t,"a",(function(){return S})),n.d(t,"c",(function(){return P})),n.d(t,"f",(function(){return D}));var r=n(11),c=n(8),o=n(12),a=n.n(o),i=n(27),s=n(47),u=n(348),l=n(26),d=n(72),p=n(94),b=n(236),j=n(178);function f(e,t){var n=E(e).limit(9999);return void 0!==t&&(n=n.where("parentId","==",t)),Object(d.isOrdered)(e)&&(n=n.orderBy("order","asc")),Object(s.e)(n,{idField:"id"}).data}function h(e,t){var n=Object(s.d)().collection(Object(d.collectionPath)(e)).doc(t),r=Object(s.f)(n,{idField:"id"}).data;return 1===Object.keys(r).length?void 0:r}function O(e,t){return Object(l.getMacros)(t,(function(t,n){return f([e,t],n)}))}function m(e,t){var n=Q;return Object(u.a)(n,[e,t])}function x(e,t){var n=Object(s.d)().collection(Object(d.collectionPath)(e)).doc(t),r=n.update.bind(n);return function(){var t=Object(i.a)(a.a.mark((function t(n){var c;return a.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return J(n),t.next=3,R(e,n);case 3:return c=B(n),t.next=6,r(c);case 6:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()}function v(e){return g.apply(this,arguments)}function g(){return(g=Object(i.a)(a.a.mark((function e(t){var n,c,o,i,s,u;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,y("books",t);case 2:if(n=e.sent){e.next=5;break}return e.abrupt("return",void 0);case 5:c={},o=Object(r.a)(l.bookDataCollections),e.prev=7,o.s();case 9:if((i=o.n()).done){e.next=17;break}return s=i.value,e.next=13,L([t,s],void 0);case 13:u=e.sent,c[s]=u;case 15:e.next=9;break;case 17:e.next=22;break;case 19:e.prev=19,e.t0=e.catch(7),o.e(e.t0);case 22:return e.prev=22,o.f(),e.finish(22);case 25:return e.abrupt("return",{book:n,data:c});case 26:case"end":return e.stop()}}),e,null,[[7,19,22,25]])})))).apply(this,arguments)}function y(e,t){return k.apply(this,arguments)}function k(){return(k=Object(i.a)(a.a.mark((function e(t,n){var r;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,E(t).doc(n).get();case 2:return r=e.sent,e.abrupt("return",T(r));case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function I(e,t){return A.apply(this,arguments)}function A(){return(A=Object(i.a)(a.a.mark((function e(t,n){var r;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,E(t).add(n);case 2:return r=e.sent,e.abrupt("return",r.id);case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function w(e,t,n){return C.apply(this,arguments)}function C(){return(C=Object(i.a)(a.a.mark((function e(t,n,r){var c,o,i,s;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(c=Object(d.collectionFromPath)(t),o=Object(d.isOrdered)(t),e.t0=Object,e.t1=void 0===n?{}:{parentId:n},e.t2=j.a[c],!o){e.next=16;break}if(e.t4=r,e.t4){e.next=12;break}return e.next=10,z(t,n);case 10:e.t5=e.sent,e.t4=e.t5+1;case 12:e.t6=e.t4,e.t3={order:e.t6},e.next=17;break;case 16:e.t3={};case 17:if(e.t7=e.t3,i=e.t0.assign.call(e.t0,e.t1,e.t2,e.t7),"mListSelects"!==c&&"mListShows"!==c){e.next=27;break}return s=t[0],e.next=23,U(s);case 23:if(e.t8=e.sent,e.t8){e.next=26;break}e.t8="";case 26:i.listId=e.t8;case 27:return e.next=29,I(t,i);case 29:return e.abrupt("return",e.sent);case 30:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function S(e,t,n){return M.apply(this,arguments)}function M(){return(M=Object(i.a)(a.a.mark((function e(t,n,r){return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,y(t,n);case 2:if(e.sent){e.next=6;break}return e.next=6,G(t,n,r);case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function P(e,t){return q.apply(this,arguments)}function q(){return(q=Object(i.a)(a.a.mark((function e(t,n){var c,o,i,s,u,d,p,b,j;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,E(t).doc(n).delete();case 2:c=t[0],o=Object(r.a)(l.bookDataCollections),e.prev=4,o.s();case 6:if((i=o.n()).done){e.next=31;break}return s=i.value,u=[c,s],e.next=11,E(u).where("parentId","==",n).get();case 11:d=e.sent,p=Object(r.a)(d.docs),e.prev=13,p.s();case 15:if((b=p.n()).done){e.next=21;break}return j=b.value,e.next=19,P(u,j.id);case 19:e.next=15;break;case 21:e.next=26;break;case 23:e.prev=23,e.t0=e.catch(13),p.e(e.t0);case 26:return e.prev=26,p.f(),e.finish(26);case 29:e.next=6;break;case 31:e.next=36;break;case 33:e.prev=33,e.t1=e.catch(4),o.e(e.t1);case 36:return e.prev=36,o.f(),e.finish(36);case 39:case"end":return e.stop()}}),e,null,[[4,33,36,39],[13,23,26,29]])})))).apply(this,arguments)}function D(e,t,n){return F.apply(this,arguments)}function F(){return(F=Object(i.a)(a.a.mark((function e(t,n,r){return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,E(t).doc(n).update({parentId:r});case 2:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function T(e){var t=e.data();if(t){var n=t;return n.id=e.id,n}}function B(e){var t=Object.assign({},e);return delete t.id,t}function E(e){return p.b.collection(Object(d.collectionPath)(e))}function L(e,t){return _.apply(this,arguments)}function _(){return(_=Object(i.a)(a.a.mark((function e(t,n){var r,c;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=E(t).limit(9999),void 0!==n&&(r=r.where("parentId","==",n)),Object(d.isOrdered)(t)&&(r=r.orderBy("order","asc")),e.next=5,r.get();case 5:return c=e.sent,e.abrupt("return",c.docs.map((function(e){return T(e)})));case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Q(e,t){return N.apply(this,arguments)}function N(){return(N=Object(i.a)(a.a.mark((function e(t,n){var r,c;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=[];case 1:if(!n){e.next=8;break}return e.next=4,y(t,n);case 4:(c=e.sent)?(r.push(c),n=c.parentId):n="",e.next=1;break;case 8:return e.abrupt("return",r);case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function G(e,t,n){return W.apply(this,arguments)}function W(){return(W=Object(i.a)(a.a.mark((function e(t,n,r){return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,E(t).doc(n).set(r);case 2:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function z(e,t){return K.apply(this,arguments)}function K(){return(K=Object(i.a)(a.a.mark((function e(t,n){var r,c;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=E(t).orderBy("order","desc").limit(1),void 0!==n&&(r=r.where("parentId","==",n)),e.next=4,r.get();case 4:return c=e.sent,e.abrupt("return",c.empty?0:c.docs[0].data().order);case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function U(e){return V.apply(this,arguments)}function V(){return(V=Object(i.a)(a.a.mark((function e(t){var n;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,L([t,"lists"],void 0);case 2:return n=e.sent,e.abrupt("return",0===n.length?void 0:n[0].id);case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function J(e){for(var t=0,n=Object.entries(e);t<n.length;t++){var r=Object(c.a)(n[t],2),o=r[0];void 0===r[1]&&(e[o]="")}}function R(e,t){return Y.apply(this,arguments)}function Y(){return(Y=Object(i.a)(a.a.mark((function e(t,n){var r,c;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=600,"mImages"!==(c=Object(d.collectionFromPath)(t))&&"mQuotes"!==c){e.next=8;break}return e.next=5,Object(b.a)(n.image,r);case 5:n.image=e.sent,e.next=12;break;case 8:if("pages"!==c||"string"!==typeof n.visual){e.next=12;break}return e.next=11,Object(b.a)(n.visual,r);case 11:n.visual=e.sent;case 12:case"end":return e.stop()}}),e)})))).apply(this,arguments)}e.enabledFirestorePersistence||(e.enabledFirestorePersistence=!0,p.b.enablePersistence())}).call(this,n(74))},26:function(e,t,n){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n),Object.defineProperty(e,r,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),c=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||r(t,e,n)};Object.defineProperty(t,"__esModule",{value:!0}),c(n(317),t),c(n(626),t),c(n(321),t),c(n(319),t),c(n(627),t)},317:function(e,t,n){"use strict";var r=n(164);Object.defineProperty(t,"__esModule",{value:!0}),t.collections=t.bookDataCollections=t.childCollectionsWithoutOrder=t.collectionsWithoutParent=void 0;var c=n(319);t.collectionsWithoutParent=["books"],t.childCollectionsWithoutOrder=["lists"],t.bookDataCollections=[].concat(r(t.childCollectionsWithoutOrder),["pages"],r(c.macroTypes)),t.collections=[].concat(r(t.collectionsWithoutParent),r(t.bookDataCollections))},319:function(e,t,n){"use strict";var r=n(164),c=n(320);function o(e,t){return t.map((function(t){return{macroType:e,doc:t}}))}Object.defineProperty(t,"__esModule",{value:!0}),t.getMacros=t.macroTypes=void 0,t.macroTypes=["mAccordions","mImages","mInputs","mListSelects","mListShows","mMarkdowns","mQuizes","mQuotes","mSurveys","mTocs","mYouTubes"],t.getMacros=function(e,n){var a,i=[],s=c(t.macroTypes);try{for(s.s();!(a=s.n()).done;){var u=a.value,l=o(u,n(u,e));i.push.apply(i,r(l))}}catch(d){s.e(d)}finally{s.f()}return i.sort((function(e,t){return e.doc.order-t.doc.order})),i}},321:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.iconSets=void 0,t.iconSets=["AntDesign","Entypo","EvilIcons","Feather","FontAwesome","FontAwesome5","Fontisto","Foundation","Ionicons","MaterialCommunityIcons","MaterialIcons","Octicons","Zocial","SimpleLineIcons"]},348:function(e,t,n){"use strict";n.d(t,"a",(function(){return a}));var r=n(86),c=n(349),o=n.n(c);function a(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},c=n.category||e.toString(),a=n.lifespan||1e4,i=[c].concat(Object(r.a)(t)),s=function(){return e.apply(null,t)};return o()(s,i,a)}},626:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.topPageIds=void 0,t.topPageIds={sidebar:"sidebar",parts:"parts"}},627:function(e,t,n){"use strict";var r=n(230);Object.defineProperty(t,"__esModule",{value:!0}),t.jsonSchemas=t.defaultImage=void 0;var c=n(317),o=n(321);t.defaultImage="data:image/gif;base64,R0lGODlhEAAQAMQAAORHHOVSKudfOulrSOp3WOyDZu6QdvCchPGolfO0o/XBs/fNwfjZ0frl3/zy7////wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACH5BAkAABAALAAAAAAQABAAAAVVICSOZGlCQAosJ6mu7fiyZeKqNKToQGDsM8hBADgUXoGAiqhSvp5QAnQKGIgUhwFUYLCVDFCrKUE1lBavAViFIDlTImbKC5Gm2hB0SlBCBMQiB0UjIQA7",t.jsonSchemas={books:{title:"Book",type:"object",properties:{title:{type:"string",default:"Book title"},subtitle:{type:"string",default:"Subtitle"}},required:["title"]},lists:{title:"List",description:"List of groups of text",type:"object",properties:{title:{type:"string",default:"List title"},groups:{type:"array",items:{title:"Group",type:"object",properties:{name:{type:"string",default:"Group name"},items:{type:"array",items:{type:"string",default:"Item name"},uniqueItems:!0}},required:["name","items"]},uniqueItems:!0,default:[{name:"Group 1",items:["Item1","Item2"]},{name:"Group 2",items:["Item3","Item4"]}]}},required:["title","groups"]},pages:{title:"Page",description:"Pages can be structured into a tree",type:"object",properties:{title:{type:"string",default:"Page title"},visual:{oneOf:[{title:"Icon",type:"object",properties:{iconSet:{type:"string",enum:o.iconSets},icon:{type:"string"}},required:["iconSet","icon"]},{title:"Image",type:"string",format:"data-url",default:t.defaultImage}],default:{iconSet:"Ionicons",icon:"paper-plane-outline"}}},required:["title"]},mAccordions:{title:"Accordion",description:"Macro that shows child pages in an accordion",type:"object",properties:{}},mTocs:{title:"Toc",description:"Macro that shows table of contents of child pages",type:"object",properties:{}},mImages:{title:"Image",description:"Macro that shows an image",type:"object",properties:{image:{type:"string",format:"data-url",default:t.defaultImage},caption:{type:"string",default:"Image caption"}},required:["image"]},mInputs:{title:"Input",description:"Macro that records user text input",type:"object",properties:{multiline:{type:"boolean",default:!1}},required:["multiline"]},mListSelects:{title:"List select",description:"Macro that lets user select from a text list",type:"object",properties:{listId:{title:"List ID",type:"string"}},required:["listId"]},mListShows:{title:"List show",description:"Macro that shows a text list",type:"object",properties:{listId:{title:"List ID",type:"string"}},required:["listId"]},mMarkdowns:{title:"Markdown",description:"Macro that shows text in Markdown format",type:"object",properties:{text:{type:"string",default:"Markdown text"}},required:["text"]},mQuizes:{title:"Quiz",description:"Macro that shows a quiz (can be multiple choices)",type:"object",properties:{question:{description:"Markdown",type:"string",default:"Quiz question?"},choices:{type:"array",items:{title:"Choice",type:"object",properties:{choice:{type:"string",default:"Choice"},correct:{type:"boolean",default:!1}},required:["choice","correct"]},uniqueItems:!0,default:[{choice:"Choice 1",correct:!0},{choice:"Choice 2",correct:!1}]},explanation:{description:"Explanation about the answer (Markdown)",type:"string",default:"Markdown text"}},required:["question","choices"]},mQuotes:{title:"Quote",description:"Macro that shows a quote",type:"object",properties:{quote:{description:"Markdown",type:"string",default:"Markdown text"},author:{type:"string",default:"Author of the quote"},image:{type:"string",format:"data-url",default:t.defaultImage}},required:["quote","author"]},mSurveys:{title:"Survey",description:"Macro that shows a survey question",type:"object",properties:{question:{description:"Markdown",type:"string",default:"Ask something?"},choices:{type:"array",items:{type:"string",default:"Choice"},uniqueItems:!0,default:["Choice 1","Choice 2"]},multiple:{type:"boolean",default:!1}},required:["question","choices","multiple"]},mYouTubes:{title:"YouTube",description:"Macro that shows a YouTube video",type:"object",properties:{videoId:{type:"string",default:"pVBev5-2Ujk"}},required:["videoId"]}};for(var a=0,i=Object.entries(t.jsonSchemas);a<i.length;a++){var s=r(i[a],2),u=s[0],l=s[1],d=c.collectionsWithoutParent.includes(u),p=c.childCollectionsWithoutOrder.includes(u);l.properties=Object.assign({},{id:{type:"string"}},d?{}:p?{parentId:{type:"string"}}:{parentId:{type:"string"},order:{type:"integer",default:99}},l.properties),l.required||(l.required=[]),d?l.required.unshift("id"):p?l.required.unshift("id","parentId"):l.required.unshift("id","parentId","order")}},635:function(e,t,n){"use strict";n.r(t);var r=n(3),c=n(0),o=n.n(c),a=n(19),i=n.n(a),s=n(57),u=n(697),l=n(47),d=n(44),p=n(677),b=n(638),j=n(180),f=(n(620),n(8)),h=n(699),O=n(698),m=Object(d.b)({key:"snackbarState",default:{severity:"info",msg:""}});function x(){var e=Object(d.c)(m),t=Object(f.a)(e,2),n=t[0],c=n.severity,o=n.msg,a=t[1];return Object(r.jsx)(h.a,{open:o.length>0,autoHideDuration:3e3,onClose:function(){return a({severity:c,msg:""})},children:Object(r.jsx)(O.a,{severity:c,children:o})})}function v(){var e=Object(d.c)(m),t=Object(f.a)(e,2)[1];return function(e,n){return t({severity:e,msg:n})}}var g=n(683),y=n(357),k=Object(g.a)((function(e){return{paper:{marginBottom:e.spacing(2),padding:e.spacing(2)}}}));function I(e){var t=e.children,n=k();return Object(r.jsx)(y.a,{className:n.paper,children:t})}function A(){var e=Object(l.c)(),t=v();return Object(r.jsx)(p.a,{item:!0,md:6,sm:12,children:Object(r.jsx)(I,{children:Object(r.jsx)(j.a,{autoComplete:"off",schema:{type:"object",required:["email","password"],properties:{email:{type:"string",format:"email",title:"Email"},password:{type:"string",title:"Password"}}},uiSchema:{password:{"ui:widget":"password"}},onSubmit:function(n){var r,c,o=n.formData;return r=o.email,c=o.password,void e.signInWithEmailAndPassword(r,c).then((function(){}),(function(e){t("error","Could not login"),console.error(e)}))},children:Object(r.jsx)(b.a,{type:"submit",color:"primary",children:"Login"})})})})}var w=n(94),C=n(29),S=n(240),M=n(24),P=n(86),q=n(26),D=n(178),F=n(684),T=n(685),B=n(686),E=n(687),L=n(688),_=Object(d.b)({key:"confirmDlgState",default:{open:!1,msg:"",onConfirm:function(){}}});function Q(){var e=Object(d.c)(_),t=Object(f.a)(e,2),n=t[0],c=n.open,o=n.msg,a=n.onConfirm,i=t[1],s=function(){i({open:!1,msg:"",onConfirm:function(){}})};return Object(r.jsxs)(F.a,{open:c,onClose:s,children:[Object(r.jsx)(T.a,{children:"Confirm"}),Object(r.jsx)(B.a,{children:Object(r.jsx)(E.a,{children:o})}),Object(r.jsxs)(L.a,{children:[Object(r.jsx)(b.a,{onClick:function(){a(),s()},color:"secondary",children:"OK"}),Object(r.jsx)(b.a,{onClick:s,color:"primary",autoFocus:!0,children:"Cancel"})]})]})}var N=Object(g.a)((function(){return{buttons:{display:"flex",justifyContent:"space-between"}}}));function G(e){var t=e.bookId,n=e.collection,o=e.doc,a=e.onDelete,i=N(),s=v(),u=function(){var e=Object(d.c)(_),t=Object(f.a)(e,2)[1];return function(e,n){t({open:!0,msg:e,onConfirm:n})}}(),l=Object(C.g)(),p=Object(c.useState)(o),h=Object(f.a)(p,2),O=h[0],m=h[1],x=Object(c.useState)(W(O)),g=Object(f.a)(x,2),y=g[0],k=g[1],A="books"===n?n:[t,n],w=Object(M.k)(A,o.id),S=function(){a&&a(),Object(M.c)(A,o.id).then((function(){s("info","Successfully deleted document of ".concat(n))}),(function(e){s("error","Could not delete"),console.error(e)}))};return Object(r.jsx)(I,{children:Object(r.jsx)(j.a,{autoComplete:"off",schema:q.jsonSchemas[n],uiSchema:D.b[n],formData:O,onSubmit:function(e){var t=e.formData;return w(t).then((function(){m(t),k(W(t)),s("info","Successfully updated")}),(function(e){s("error","Could not update"),console.error(e)}))},children:Object(r.jsxs)("div",{className:i.buttons,children:[Object(r.jsx)(b.a,{type:"submit",color:"primary",children:"Update"}),"books"===n&&Object(r.jsx)(b.a,{color:"primary",onClick:function(){return l.push("/books/".concat(t))},children:"Edit content"}),"books"!==n&&Object(r.jsx)(b.a,{color:"secondary",onClick:function(){q.macroTypes.includes(n)?S():u("Do you want to delete this document of ".concat(n,"?"),S)},children:"Delete"})]})},y)})}function W(e){var t=z(e);return"".concat(e.id,"-").concat(t.join("-"))}function z(e){for(var t=[],n=0,r=Object.keys(e);n<r.length;n++){var c=r[n];t.push(c);var o=e[c];"object"!==typeof o||Array.isArray(o)||t.push.apply(t,Object(P.a)(z(o)))}return t}var K=n(693),U=n(694),V=n(678),J=n(700),R=n(352),Y=n.n(R),Z=n(36),H=n(692);function X(){var e=Object(l.c)(),t=Object(l.g)().data,n=v(),c=Object(C.g)();return Object(r.jsx)("div",{children:Object(r.jsxs)(S.a,{children:[Object(r.jsx)(b.a,{color:"primary",onClick:function(){e.signOut().then((function(){return c.push("/")}),(function(e){n("error","Could not logout"),console.error(e)}))},children:"Logout"}),t.email]})})}var $=n(12),ee=n.n($),te=n(27);function ne(){return(ne=Object(te.a)(ee.a.mark((function e(t){var n,r;return ee.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(M.d)(t);case 2:return n=e.sent,r=JSON.stringify(n,null,2),e.next=6,ce("backup/"+ae(t,{timestamped:!0}),r);case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function re(){return(re=Object(te.a)(ee.a.mark((function e(t){var n,r;return ee.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(M.d)(t);case 2:return n=e.sent,r=JSON.stringify(n,null,2),e.next=6,ce("backup/"+ae(t,{timestamped:!0,tag:"publish"}),r);case 6:return e.next=8,ce("publish/"+ae(t),r);case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function ce(e,t){return oe.apply(this,arguments)}function oe(){return(oe=Object(te.a)(ee.a.mark((function e(t,n){var r;return ee.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=w.c.ref(t),e.next=3,r.putString(n,void 0,{contentType:"text/json"}).then();case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function ae(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.timestamped,r=t.tag,c=n?"-"+ie():"",o=r?"-"+r:"";return"".concat(e,"/happy-").concat(e).concat(c).concat(o,".json")}function ie(){return(new Date).toISOString()}function se(){var e=Object(C.h)().bookId,t=Object(C.g)(),n=Object(M.h)("books",e),o=v();Object(c.useEffect)((function(){n||(console.error("Book not found: ".concat(e)),t.replace("/"))}));return n?Object(r.jsxs)(r.Fragment,{children:[Object(r.jsxs)("div",{children:[Object(r.jsx)(b.a,{color:"primary",onClick:function(){Object(M.d)(e).then((function(t){!function(e,t){var n=JSON.stringify(t,null,2),r=document.createElement("a");r.setAttribute("href","data:application/json;charset=utf-8,"+encodeURIComponent(n)),r.setAttribute("download",e),r.style.display="none",document.body.appendChild(r),r.click(),document.body.removeChild(r)}("happy-".concat(e,".json"),t)}),(function(e){o("error","Could not download"),console.error(e)}))},children:"Download"}),Object(r.jsx)(b.a,{color:"primary",onClick:function(){(function(e){return ne.apply(this,arguments)})(e).then((function(){o("info","Created backup")}),(function(e){o("error","Could not backup"),console.error(e)}))},children:"Backup"}),Object(r.jsx)(b.a,{color:"primary",onClick:function(){(function(e){return re.apply(this,arguments)})(e).then((function(){o("info","Created backup and published")}),(function(e){o("error","Could not publish"),console.error(e)}))},children:"Publish"})]}),Object(r.jsx)(b.a,{color:"primary",onClick:function(){return t.push("/")},children:"View book list"})]}):Object(r.jsx)(r.Fragment,{})}var ue=n(689);function le(){return Object(r.jsxs)(r.Fragment,{children:[Object(r.jsx)(O.a,{severity:"info",children:Object(r.jsx)(ue.a,{href:"https://github.com/adam-p/markdown-here/wiki/Markdown-Cheatsheet",target:"_blank",children:"Markdown text format refence"})}),Object(r.jsx)(O.a,{severity:"info",children:Object(r.jsx)(ue.a,{href:"https://oblador.github.io/react-native-vector-icons/",target:"_blank",children:"Icons"})}),Object(r.jsx)(O.a,{severity:"info",children:Object(r.jsx)(ue.a,{href:"https://translate.google.com/?hl=vi&sl=en&tl=vi&op=translate",target:"_blank",children:"Google Translate"})})]})}var de=n(18),pe=n(691),be=n(701),je=n(239),fe=n.n(je),he=n(351),Oe=n.n(he),me=n(350),xe=n.n(me);function ve(){return(ve=Object(te.a)(ee.a.mark((function e(t){var n,r,c,o;return ee.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=Object.keys(q.topPageIds),r=0;case 2:if(!(r<n.length)){e.next=10;break}return c=n[r],o={parentId:t,order:r+1,id:c,title:c},e.next=7,Object(M.a)([t,"pages"],c,o);case 7:r++,e.next=2;break;case 10:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var ge=n(690),ye=n(45),ke=n(133),Ie=n(70),Ae=n(71);function we(e){var t=e.msg;return Object(r.jsx)(S.a,{color:"error",children:t})}var Ce=function(e){Object(Ie.a)(n,e);var t=Object(Ae.a)(n);function n(e){var r;return Object(ye.a)(this,n),(r=t.call(this,e)).state={hasError:!1},r}return Object(ke.a)(n,[{key:"render",value:function(){return this.state.hasError?Object(r.jsx)(we,{msg:this.props.errorMsg}):this.props.children}}],[{key:"getDerivedStateFromError",value:function(e){return console.error(e),{hasError:!0}}}]),n}(c.Component);function Se(e){return Object(r.jsx)(Ce,{errorMsg:e.errorMsg,children:Object(r.jsx)(c.Suspense,{fallback:Object(r.jsx)(ge.a,{}),children:e.children})})}var Me=n(11),Pe=Object(d.b)({key:"docTreeState",default:{expandedNodeIds:["pages"],selectedNodeId:"pages"}});function qe(e,t,n){return"/books/".concat(e,"/").concat(t,"/").concat(n)}var De=qe;function Fe(){return Object(d.c)(Pe)}function Te(){var e=Object(C.h)().bookId,t=Object(M.h)("books",e),n=Fe(),c=Object(f.a)(n,2),o=c[0],a=o.expandedNodeIds,i=o.selectedNodeId,s=c[1];return Object(r.jsxs)(I,{children:[Object(r.jsx)(S.a,{variant:"h5",children:null===t||void 0===t?void 0:t.title}),Object(r.jsxs)(pe.a,{defaultCollapseIcon:Object(r.jsx)(xe.a,{}),defaultExpandIcon:Object(r.jsx)(Oe.a,{}),expanded:a,selected:i,onNodeToggle:function(e,t){return s({expandedNodeIds:t,selectedNodeId:i})},children:[Object(r.jsx)(Be,{bookId:e}),Object(r.jsx)(Ee,{bookId:e})]})]})}function Be(e){var t=e.bookId;return Object(r.jsx)(be.a,{nodeId:"lists",label:"Text lists",children:Object(r.jsx)(Le,{bookId:t,collection:"lists",recursive:!1,level:0,parentId:t,labelMaker:function(e){return e.title}})})}function Ee(e){var t=e.bookId;return Object(c.useEffect)((function(){Object(M.e)("books",t).then((function(e){e&&function(e){ve.apply(this,arguments)}(t)}))}),[t]),Object(r.jsx)(be.a,{nodeId:"pages",label:"Pages",children:Object(r.jsx)(Le,{bookId:t,collection:"pages",recursive:!0,level:0,parentId:t,labelMaker:function(e){return e.title}})})}function Le(e){return Object(r.jsx)(Se,{errorMsg:"Error loading ".concat(e.collection),children:Object(r.jsx)(_e,Object(de.a)({},e))})}function _e(e){var t=e.bookId,n=e.collection,c=e.recursive,o=e.level,a=e.parentId,i=e.grandParentId,s=e.labelMaker,u=Object(C.g)(),l=Fe(),d=Object(f.a)(l,1)[0].selectedNodeId,p=Object(M.i)([t,n],a),b=v(),j=function(e){Object(M.b)([t,n],e).then((function(e){u.push(qe(t,n,e))}),(function(e){console.error(e),b("error","Could not add new document to ".concat(n))}))};return Object(r.jsxs)(r.Fragment,{children:[p.map((function(e){var i=e.id,l=De(t,n,i),d=qe(t,n,i);return Object(r.jsx)(be.a,{nodeId:l,label:s(e),onLabelClick:function(e){e.preventDefault(),u.push(d)},children:c&&Object(r.jsx)(Le,{bookId:t,collection:n,recursive:!0,level:o+1,parentId:i,grandParentId:a,labelMaker:s})},l)})),(a===t&&"pages"!==n||De(t,n,a)===d)&&Object(r.jsxs)(r.Fragment,{children:[o<=3&&Object(r.jsx)(be.a,{nodeId:"add-doc-to-".concat(t,"-").concat(n,"-").concat(a),icon:Object(r.jsx)(fe.a,{}),label:"Add child",onClick:function(){return j(a)}}),i&&Object(r.jsx)(be.a,{nodeId:"add-doc-to-".concat(t,"-").concat(n,"-").concat(i),icon:Object(r.jsx)(fe.a,{}),label:"Add sibling",onClick:function(){return j(i)}})]})]})}function Qe(){return Object(r.jsxs)(r.Fragment,{children:[Object(r.jsx)(C.b,{path:"/books/:bookId",children:Object(r.jsx)(Te,{})}),Object(r.jsxs)(I,{children:[Object(r.jsxs)(C.b,{path:"/books/:bookId",children:[Object(r.jsx)(le,{}),Object(r.jsx)(se,{})]}),Object(r.jsx)(X,{})]})]})}function Ne(){var e=Object(Z.a)();return Object(H.a)(e.breakpoints.up("md"))}function Ge(e){var t=e.title,n=Ne(),o=Object(c.useState)(!1),a=Object(f.a)(o,2),i=a[0],s=a[1];return Object(r.jsx)(K.a,{position:"static",children:Object(r.jsxs)(U.a,{children:[!n&&Object(r.jsxs)(r.Fragment,{children:[Object(r.jsx)(V.a,{color:"inherit",edge:"start",onClick:function(){return s(!0)},children:Object(r.jsx)(Y.a,{})}),Object(r.jsx)(J.a,{anchor:"left",open:i,onClose:function(){return s(!1)},children:Object(r.jsx)(Qe,{})})]}),Object(r.jsx)(S.a,{children:t})]})})}function We(e){return Object(r.jsxs)(r.Fragment,{children:[Object(r.jsx)(Ge,{title:e.title}),Object(r.jsx)("div",{style:{marginTop:"1em"},children:Object(r.jsx)(Se,{errorMsg:"There's error, please try reloading this web page.",children:e.children})})]})}function ze(){var e=Object(M.i)("books",void 0);return e.sort((function(e,t){return e.title<t.title?-1:1})),Object(r.jsxs)(r.Fragment,{children:[e.map((function(e){return Object(r.jsx)(G,{bookId:e.id,collection:"books",doc:e,onDelete:function(){}},e.id)})),Object(r.jsx)(b.a,{color:"primary",onClick:function(){return Object(M.b)("books",void 0)},children:"Add book"}),Object(r.jsx)(O.a,{severity:"info",children:Object(r.jsx)(S.a,{children:"Deleting books from this admin UI is not effecient for the system. If you want to delete a book, please contact a DB admin."})})]})}var Ke=Object(r.jsx)(C.b,{path:"/",exact:!0,children:Object(r.jsx)(We,{title:"Books",children:Object(r.jsx)(ze,{})})});function Ue(){return Object(r.jsx)(S.a,{children:"Please start from the sidebar."})}var Ve=Object(r.jsx)(C.b,{path:"/books/:bookId",exact:!0,children:Object(r.jsx)(We,{title:"Edit book",children:Object(r.jsx)(Ue,{})})}),Je=n(355),Re=n(695),Ye=n(696),Ze=n(679),He=n(682),Xe=n(680),$e=n(681),et=n(353),tt=n.n(et);function nt(e){var t=e.bookId,n=e.pageId,c=e.order,a=o.a.useState(!1),i=Object(f.a)(a,2),s=i[0],u=i[1],l=o.a.useRef(null),d=o.a.useState(0),j=Object(f.a)(d,2),h=j[0],O=j[1],m=q.macroTypes[h],x=q.jsonSchemas[m].title,v=function(e){l.current&&l.current.contains(e.target)||u(!1)};return Object(r.jsx)(p.a,{container:!0,direction:"column",alignItems:"center",children:Object(r.jsxs)(p.a,{item:!0,xs:12,children:[Object(r.jsxs)(Re.a,{variant:"contained",color:"primary",ref:l,children:[Object(r.jsxs)(b.a,{onClick:function(){Object(M.b)([t,m],n,c)},children:["Add ",x]}),Object(r.jsx)(b.a,{color:"primary",size:"small",onClick:function(){u((function(e){return!e}))},children:Object(r.jsx)(tt.a,{})})]}),Object(r.jsx)(Ye.a,{open:s,anchorEl:l.current,role:void 0,transition:!0,disablePortal:!0,children:function(e){var t=e.TransitionProps,n=e.placement;return Object(r.jsx)(Ze.a,Object(de.a)(Object(de.a)({},t),{},{style:{transformOrigin:"bottom"===n?"center top":"center bottom"},children:Object(r.jsx)(y.a,{children:Object(r.jsx)(He.a,{onClickAway:v,children:Object(r.jsx)(Xe.a,{children:q.macroTypes.map((function(e,t){return Object(r.jsx)($e.a,{selected:t===h,onClick:function(e){return function(e,t){O(t),u(!1)}(0,t)},children:q.jsonSchemas[e].title},e)}))})})})}))}})]})})}function rt(e){var t=e.bookId,n=e.pageId,c=Object(M.j)(t,n);return Object(r.jsxs)("div",{children:[c.map((function(e){return function(e,t){var n=t.macroType,c=t.doc;return q.macroTypes.includes(n)?Object(r.jsx)(G,{bookId:e,collection:n,doc:c},c.id):Object(r.jsx)(we,{msg:"Unknown page macro type: ".concat(n)})}(t,e)})),Object(r.jsx)(nt,{bookId:t,pageId:n,order:c.length+1})]})}function ct(e){var t=e.bookId,n=e.currentPageAndAncestors,o=Object(c.useState)(void 0),a=Object(f.a)(o,2),i=a[0],s=a[1],u=v(),l=n[0],d=Object.keys(q.topPageIds).includes(l.id),p=Object(r.jsx)(b.a,{color:"secondary",onClick:function(){s(l),u("info","Select a page at the page tree to move to")},children:"Move this page"});if(!i)return d?null:p;if(i&&i.id===l.id)return null;if(function(e,t){var n,r=Object(Me.a)(t);try{for(r.s();!(n=r.n()).done;){if(n.value.id===e.id)return!0}}catch(c){r.e(c)}finally{r.f()}return!1}(i,n))return p;if(function(e,t){return e.parentId===t.id}(i,l))return p;var j=Object(r.jsx)(b.a,{color:"secondary",onClick:function(){Object(M.f)([t,"pages"],i.id,l.id),s(void 0)},children:"Move it here"}),h=Object(r.jsx)(ue.a,{href:"/#/books/".concat(t,"/pages/").concat(i.id),target:"_blank",children:"Page to move"});return Object(r.jsxs)(r.Fragment,{children:[h,j,p]})}function ot(e){var t=e.collection,n=Object(C.h)(),o=n.bookId,a=n.bookDataId,i=Object(M.g)([o,t],a),s=function(){var e=Object(d.c)(Pe),t=Object(f.a)(e,2),n=t[0].expandedNodeIds,r=t[1];return Object(c.useCallback)((function(e,t,c,o){var a,i=De(e,t,c),s=Object(P.a)(n),u=Object(Me.a)(o);try{for(u.s();!(a=u.n()).done;){var l=a.value,d=De(e,t,l);s.includes(d)||s.push(d)}}catch(b){u.e(b)}finally{u.f()}var p=s.length!==n.length;r({expandedNodeIds:p?s:n,selectedNodeId:i})}),[n,r])}(),u=Object(C.g)(),l=i.map((function(e){return e.id}));if(Object(Je.a)((function(){return s(o,t,a,l)}),[s,o,t,a,l]),0===i.length)return Object(r.jsx)(we,{msg:"Could not load data to edit"});var p=i[0];return Object(r.jsxs)(r.Fragment,{children:["pages"===t&&Object(r.jsx)(ct,{bookId:o,currentPageAndAncestors:i}),Object(r.jsx)(G,{bookId:o,collection:t,doc:p,onDelete:function(){return u.push("/books/".concat(o))}},"".concat(o,"/").concat(t,"/").concat(a)),"pages"===t&&Object(r.jsx)(rt,{bookId:o,pageId:a})]})}var at=[["lists","Edit text list"],["pages","Edit page"]].map((function(e){var t=Object(f.a)(e,2),n=t[0],c=t[1];return Object(r.jsx)(C.b,{path:"/books/:bookId/".concat(n,"/:bookDataId"),exact:!0,children:Object(r.jsx)(We,{title:c,children:Object(r.jsx)(ot,{collection:n})})},n)}));function it(){var e=Ne();return Object(r.jsxs)(p.a,{container:!0,spacing:e?2:0,children:[e&&Object(r.jsx)(p.a,{item:!0,md:5,children:Object(r.jsx)(Qe,{})}),Object(r.jsx)(p.a,{item:!0,md:7,sm:12,children:Object(r.jsxs)(C.d,{children:[Ke,Ve,at,Object(r.jsx)(C.a,{from:"*",to:"/"})]})})]})}function st(){return Object(r.jsxs)(r.Fragment,{children:[Object(r.jsx)(u.a,{}),Object(r.jsx)(Se,{errorMsg:"There's error, please try reloading this page",children:Object(r.jsx)(d.a,{children:Object(r.jsxs)(s.a,{children:[Object(r.jsx)(x,{}),Object(r.jsx)(Q,{}),Object(r.jsx)(l.b,{firebaseApp:w.a,suspense:!0,children:Object(r.jsx)(l.a,{fallback:Object(r.jsx)(A,{}),children:Object(r.jsx)(it,{})})})]})})})]})}i.a.render(Object(r.jsx)(st,{}),document.getElementById("root"))},72:function(e,t,n){"use strict";var r=n(230);Object.defineProperty(t,"__esModule",{value:!0}),t.isOrdered=t.collectionFromPath=t.collectionPath=void 0;var c=n(631);function o(e){return"string"===typeof e?e:e[1]}t.collectionPath=function(e){if("string"===typeof e)return e;var t=r(e,2),n=t[0],c=t[1];return"books/".concat(n,"/").concat(c)},t.collectionFromPath=o,t.isOrdered=function(e){var t=o(e),n=c.collectionsWithoutParent,r=c.childCollectionsWithoutOrder;return!n.includes(t)&&!r.includes(t)}},94:function(e,t,n){"use strict";(function(e){n.d(t,"a",(function(){return c})),n.d(t,"b",(function(){return o})),n.d(t,"c",(function(){return a}));var r=n(58),c=(n(636),n(637),r.a.initializeApp({apiKey:"AIzaSyB-svyOf1GKrlLnGCNWFo7SA9xMzKKLkys",projectId:"happy-child-302620",authDomain:"localhost",storageBucket:"gs://happy-child-302620.appspot.com"})),o=r.a.firestore(c),a=r.a.storage(c);e.firestore=o}).call(this,n(74))}},[[635,3,4]]]);