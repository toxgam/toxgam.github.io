/*! For license information please see 5.ece43c21.chunk.js.LICENSE.txt */
(this["webpackJsonphappy-author"]=this["webpackJsonphappy-author"]||[]).push([[5],{2668:function(e,t,n){"use strict";n.d(t,"a",(function(){return i}));var r=n(3184);function i(e){return{packageName:r.a,packageVersion:r.b,componentName:e,component:e}}},2677:function(e,t,n){"use strict";n.d(t,"a",(function(){return c}));var r=n(8),i=n.n(r),o=n(9),a=n.n(o),c=function(){function e(){i()(this,e)}return a()(e,[{key:"setAbort",value:function(e){this.abortFunction=e}},{key:"abort",value:function(){this.abortFunction&&this.abortFunction()}}]),e}()},2680:function(e,t,n){"use strict";n.d(t,"a",(function(){return C}));var r=n(14),i=n.n(r),o=n(22),a=n.n(o),c=n(8),u=n.n(c),l=n(9),s=n.n(l),f=n(3),p=n.n(f),d=n(11),v=n.n(d),m=n(12),h=n.n(m),y=n(5),b=n.n(y),w=n(1),k=n.n(w),F=n(0),U=n(2681),g=n(595),P=n(1409),S=n(2766),O=n(2871);function E(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=b()(e);if(t){var i=b()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return h()(this,n)}}var C=function(e){v()(n,e);var t=E(n);function n(e,r){var o;u()(this,n),o=t.call(this,e),k()(p()(o),"uploadComponent",new S.a),k()(p()(o),"fireCommencedEvent",(function(e){e.files.forEach((function(e){var t=e.id,n=e.size,r=e.type;Object(U.start)("MediaPicker.fireUpload.".concat(t)),o.createAndFireAnalyticsEvent({eventType:"operational",action:"commenced",actionSubject:"mediaUpload",actionSubjectId:"localMedia",attributes:{sourceType:"local",serviceName:"upload",fileAttributes:{fileId:t,fileSize:n,fileMimetype:r}}})}))})),k()(p()(o),"fireUploadSucceeded",(function(e){var t=e.file,n=t.id,r=t.size,i=t.type,a=Object(U.end)("MediaPicker.fireUpload.".concat(n)).duration,c=void 0===a?-1:a;o.createAndFireAnalyticsEvent({eventType:"operational",action:"succeeded",actionSubject:"mediaUpload",actionSubjectId:"localMedia",attributes:{sourceType:"local",serviceName:"upload",status:"success",fileAttributes:{fileId:n,fileSize:r,fileMimetype:i},uploadDurationMsec:c}})})),k()(p()(o),"fireUploadFailed",function(){var e=a()(i.a.mark((function e(t){var n,r,a,c,u,l,s;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=t.fileId,r=t.error,a=r.name,c=r.rawError,u=Object(U.end)("MediaPicker.fireUpload.".concat(n)),l=u.duration,s=void 0===l?-1:l,o.createAndFireAnalyticsEvent({eventType:"operational",action:"failed",actionSubject:"mediaUpload",actionSubjectId:"localMedia",attributes:{sourceType:"local",serviceName:"upload",status:"fail",failReason:a,error:c?Object(g.a)(c):"unknown",fileAttributes:{fileId:n},uploadDurationMsec:s}});case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),k()(p()(o),"createAndFireAnalyticsEvent",(function(e){var t=o.props.createAnalyticsEvent;t&&t(e).fire(P.a)})),k()(p()(o),"cancel",(function(e){o.uploadService.cancel(e)})),k()(p()(o),"onFilesAdded",(function(e){var t=e.files;o.uploadComponent.emitUploadsStart(t)})),k()(p()(o),"onFilePreviewUpdate",(function(e){var t=e.file,n=e.preview;o.uploadComponent.emitUploadPreviewUpdate(t,n)})),k()(p()(o),"onFileConverting",(function(e){var t=e.file;o.uploadComponent.emitUploadEnd(t)})),k()(p()(o),"onUploadError",(function(e){var t=e.fileId,n=e.error;o.uploadComponent.emitUploadError(t,n)})),o.componentName=r;var c=o.props,l=c.mediaClient,s=c.config,f=c.onUploadsStart,d=c.onPreviewUpdate,v=c.onEnd,m=c.onError,h=s.uploadParams,y=s.shouldCopyFileToRecents,b=void 0===y||y;return o.uploadComponent.on("uploads-start",o.fireCommencedEvent),o.uploadComponent.on("upload-end",o.fireUploadSucceeded),o.uploadComponent.on("upload-error",o.fireUploadFailed),f&&o.uploadComponent.on("uploads-start",f),d&&o.uploadComponent.on("upload-preview-update",d),v&&o.uploadComponent.on("upload-end",v),m&&o.uploadComponent.on("upload-error",m),o.uploadService=new O.a(l,h,b),o.uploadService.on("files-added",o.onFilesAdded),o.uploadService.on("file-preview-update",o.onFilePreviewUpdate),o.uploadService.on("file-converting",o.onFileConverting),o.uploadService.on("file-upload-error",o.onUploadError),o}return s()(n,[{key:"setUploadParams",value:function(e){this.uploadService.setUploadParams(e)}}]),n}(F.Component)},2681:function(e,t,n){(function(e){!function(t){"use strict";var n="[object process]"===Object.prototype.toString.call("undefined"!==typeof e?e:0),r="undefined"!==typeof performance&&"undefined"!==typeof performance.now&&"function"===typeof performance.mark&&"function"===typeof performance.measure&&("function"===typeof performance.clearMarks||"function"===typeof performance.clearMeasures),i="undefined"!==typeof PerformanceObserver&&"undefined"!==typeof PerformanceObserver.prototype&&"function"===typeof PerformanceObserver.prototype.constructor,o={},a={},c=function(){return r?performance.now():Date.now()},u=function(e){o[e]=void 0,a[e]&&(a[e]=void 0),r&&(n||performance.clearMeasures(e),performance.clearMarks(e))},l=function(e){if(r){if(n&&i){var t=new PerformanceObserver((function(n){a[e]=n.getEntries().find((function(t){return t.name===e})),t.disconnect()}));t.observe({entryTypes:["measure"]})}performance.mark(e)}o[e]=c()},s=function(e,t){try{var i=o[e];return r?(t||performance.mark(e+"-end"),performance.measure(e,e,t||e+"-end"),n?a[e]?a[e]:i?{duration:c()-i,startTime:i,entryType:"measure",name:e}:{}:performance.getEntriesByName(e).pop()||{}):i?{duration:c()-i,startTime:i,entryType:"measure",name:e}:{}}catch(l){return{}}finally{u(e),u(t||e+"-end")}},f=function(){o={},a={},r&&(n||performance.clearMeasures(),performance.clearMarks())},p=function(e){return!r||n?[]:performance.getEntriesByType(e)||[]},d=function(){return p("navigation").pop()||{}};function v(e,t,n,r){function i(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,o){function a(e){try{u(r.next(e))}catch(t){o(t)}}function c(e){try{u(r.throw(e))}catch(t){o(t)}}function u(e){e.done?n(e.value):i(e.value).then(a,c)}u((r=r.apply(e,t||[])).next())}))}function m(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:c(0),throw:c(1),return:c(2)},"function"===typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function c(e){return function(t){return u([e,t])}}function u(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=(i=a.trys).length>0&&i[i.length-1])&&(6===o[0]||2===o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(c){o=[6,c],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}}var h=function(e,t){return v(void 0,void 0,void 0,(function(){var n,r,i;return m(this,(function(o){switch(o.label){case 0:l(t),o.label=1;case 1:return o.trys.push([1,3,,4]),[4,e()];case 2:return n=o.sent(),r=s(t),[2,n?Object.assign({},{data:n,mark:r}):{mark:r}];case 3:throw i=o.sent(),s(t),i;case 4:return[2]}}))}))};t.clear=u,t.clearAll=f,t.end=s,t.getEntriesByType=p,t.getNavigationMarker=d,t.isNodeJSEnv=n,t.isPerformanceObservableSupported=i,t.isUserTimingAPISupported=r,t.profiler=h,t.start=l,Object.defineProperty(t,"__esModule",{value:!0})}(t)}).call(this,n(252))},2744:function(e,t,n){"use strict";n.d(t,"a",(function(){return r}));var r;!function(e){e.PastedFile="pastedFile",e.PastedScreenshot="pastedScreenshot",e.LocalUpload="localUpload"}(r||(r={}))},2766:function(e,t,n){"use strict";n.d(t,"a",(function(){return y}));var r=n(8),i=n.n(r),o=n(9),a=n.n(o),c=n(11),u=n.n(c),l=n(12),s=n.n(l),f=n(5),p=n.n(f),d=n(1),v=n.n(d),m=n(519);function h(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=p()(e);if(t){var i=p()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return s()(this,n)}}var y=function(e){u()(n,e);var t=h(n);function n(){return i()(this,n),t.apply(this,arguments)}return a()(n,[{key:"emitPluginItemsInserted",value:function(e){var t=e.map((function(e){return{pluginName:e.serviceName,pluginFile:{id:e.id,metadata:e.metadata}}}));this.emit("plugin-items-inserted",t)}},{key:"emitUploadsStart",value:function(e){this.emit("uploads-start",{files:e})}},{key:"emitUploadPreviewUpdate",value:function(e,t){this.emit("upload-preview-update",{file:e,preview:t})}},{key:"emitUploadEnd",value:function(e){this.emit("upload-end",{file:e})}},{key:"emitUploadError",value:function(e,t){this.emit("upload-error",{fileId:e,error:t})}}]),n}(function(){function e(){i()(this,e),v()(this,"emitter",new m.EventEmitter2({wildcard:!0}))}return a()(e,[{key:"once",value:function(e,t){this.emitter.once(e,t)}},{key:"on",value:function(e,t){this.emitter.on(e,t)}},{key:"onAny",value:function(e){this.emitter.onAny(e)}},{key:"addListener",value:function(e,t){this.emitter.addListener(e,t)}},{key:"off",value:function(e,t){this.emitter.off(e,t)}},{key:"removeListener",value:function(e,t){this.emitter.removeListener(e,t)}},{key:"removeAllListeners",value:function(e){void 0===e?this.emitter.removeAllListeners():this.emitter.removeAllListeners(e)}},{key:"emit",value:function(e,t){return this.emitter.emit(e,t)}}]),e}())},2806:function(e,t,n){"use strict";n.d(t,"a",(function(){return l}));var r=n(14),i=n.n(r),o=n(22),a=n.n(o),c=n(871),u=function(e){return!e.width&&!e.height};function l(e,t){return s.apply(this,arguments)}function s(){return(s=a()(i.a.mark((function e(t,n){var r;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:e.t0=t,e.next="image"===e.t0||"video"===e.t0?3:9;break;case 3:return e.next=5,Object(c.a)(t,n);case 5:if(r=e.sent,!u(r)){e.next=8;break}return e.abrupt("return",{file:n,scaleFactor:1});case 8:return e.abrupt("return",{file:n,dimensions:r,scaleFactor:1});case 9:return e.abrupt("return",{file:n});case 10:case"end":return e.stop()}}),e)})))).apply(this,arguments)}},2871:function(e,t,n){"use strict";n.d(t,"a",(function(){return I}));var r=n(14),i=n.n(r),o=n(22),a=n.n(o),c=n(8),u=n.n(c),l=n(9),s=n.n(l),f=n(1),p=n.n(f),d=n(330),v=n.n(d),m=n(520),h=n(669),y=n(2677),b=n(866),w=n(278),k=n(270),F=n(439),U=n(287),g=n(519),P=n(191);function S(e){return Object(P.isClientBasedAuth)(e)?{id:e.clientId,token:e.token,baseUrl:e.baseUrl}:e}var O=n(2707),E=n(2477);function C(){return(C=a()(i.a.mark((function e(t,n){var r,o,a,c,u,l;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(O.c)(t);case 2:return r=e.sent,e.next=5,Object(E.a)(r);case 5:if(null!==(o=e.sent)){e.next=10;break}return e.abrupt("return",{file:t});case 10:return a=o.width,c=o.height,u=o.scaleFactor,l={file:t,dimensions:{width:a,height:c},scaleFactor:n||u},e.abrupt("return",l);case 13:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var j=n(2744),M=n(2806);function A(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function T(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?A(Object(n),!0).forEach((function(t){p()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):A(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var I=function(){function e(t,n,r){var o=this;u()(this,e),p()(this,"emit",(function(e,t){o.emitter.emit(e,t)})),p()(this,"onFileSuccess",function(){var e=a()(i.a.mark((function e(t,n){var r;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=t.mediaFile,o.copyFileToUsersCollection(n).catch(console.log),o.emit("file-converting",{file:r}),t.cancel=function(){o.releaseCancellableFile(r)};case 4:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()),p()(this,"onFileError",(function(e,t,n){if(o.releaseCancellableFile(e),"canceled"!==n){var r=n instanceof Error?n.message:n,i=n instanceof Error?n:void 0;o.emit("file-upload-error",{fileId:e.id,error:{fileId:e.id,name:t,description:r,rawError:i}})}})),this.tenantMediaClient=t,this.tenantUploadParams=n,this.shouldCopyFileToRecents=r,this.emitter=new g.EventEmitter2,this.cancellableFilesUploads={};var c=t.config.userAuthProvider;c&&(this.userMediaStore=new m.a({authProvider:c}),this.userMediaClient=new h.a({userAuthProvider:c,authProvider:c}))}return s()(e,[{key:"setUploadParams",value:function(e){this.tenantUploadParams=e}},{key:"createUploadController",value:function(){return new y.a}},{key:"addFiles",value:function(e){this.addFilesWithSource(e.map((function(e){return{file:e,source:j.a.LocalUpload}})))}},{key:"addFilesWithSource",value:function(e){var t=this;if(0!==e.length){var n=Date.now(),r=this.userMediaClient,i=this.tenantMediaClient,o=this.shouldCopyFileToRecents,a=o?i:r,c=o?this.tenantUploadParams.collection:U.c;if(a){for(var u=[],l=0;l<e.length;l++)u.push({fileId:v()(),occurrenceKey:v()(),collection:c});var s=a.file.touchFiles(u,c),f=e.map((function(e,r){var i=e.file,l=e.source,f=u[r],p=f.fileId,d=f.occurrenceKey,v=s.then((function(e){var t=e.created.find((function(e){return e.fileId===p}));if(!t)throw new Error("Cant retrieve uploadId from result of touch endpoint call");return t.uploadId})),m={collection:c,content:i,name:i.name,mimeType:i.type},h={id:p,occurrenceKey:d,deferredUploadId:v},y=t.createUploadController(),k=a.file.upload(m,y,h),F={id:p,name:i.name,size:i.size,creationDate:n,type:i.type,occurrenceKey:d},U={mediaFile:F,file:i,source:l,cancel:function(){y.abort()}},g=t.onFileSuccess.bind(t);return k.subscribe({next:function(e){"processing"===e.status&&(this.unsubscribe(),o&&(a.emit("file-added",e),b.a.emit("file-added",e)),g(U,p))},error:function(e){t.onFileError(F,"upload_fail",e)}}),t.cancellableFilesUploads[p]=U,Object(w.b)().set(p,k),U})),p=f.map((function(e){return e.mediaFile}));this.emit("files-added",{files:p}),this.emitPreviews(f)}}}},{key:"cancel",value:function(e){var t=this;if(e){var n=this.cancellableFilesUploads[e];n&&n.cancel&&n.cancel()}else Object.keys(this.cancellableFilesUploads).forEach((function(e){var n=t.cancellableFilesUploads[e];n.cancel&&n.cancel()}))}},{key:"on",value:function(e,t){this.emitter.on(e,t)}},{key:"off",value:function(e,t){this.emitter.off(e,t)}},{key:"emitPreviews",value:function(e){var t=this;e.forEach((function(e){var n=e.file,r=e.mediaFile,i=e.source,o=n.type,a=t.getMediaTypeFromFile(n);Object(k.d)(o)?"image"===a?function(e,t){return C.apply(this,arguments)}(n,i===j.a.PastedScreenshot?window.devicePixelRatio:void 0).then((function(e){t.emit("file-preview-update",{file:r,preview:e})})):Object(M.a)(a,n).then((function(e){t.emit("file-preview-update",{file:r,preview:e})})).catch((function(){return t.emit("file-preview-update",{file:r,preview:{}})})):t.emit("file-preview-update",{file:r,preview:{}})}))}},{key:"getMediaTypeFromFile",value:function(e){var t=e.type;return Object(F.a)(t)}},{key:"releaseCancellableFile",value:function(e){delete this.cancellableFilesUploads[e.id]}},{key:"copyFileToUsersCollection",value:function(e){var t=this.shouldCopyFileToRecents,n=this.userMediaStore,r=this.tenantUploadParams;if(!t||!n)return Promise.resolve();var i=r.collection;return(0,this.tenantMediaClient.config.authProvider)({collectionName:i}).then((function(t){var r={sourceFile:{id:e,collection:i,owner:T({},S(t))}},o={collection:U.c};return n.copyFileWithToken(r,o)}))}}]),e}()},3184:function(e){e.exports=JSON.parse('{"a":"@atlaskit/media-picker","b":"57.3.1"}')}}]);