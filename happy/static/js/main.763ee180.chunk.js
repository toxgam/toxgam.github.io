(this["webpackJsonphappy-author"]=this["webpackJsonphappy-author"]||[]).push([[2],{178:function(e,t,n){"use strict";n.d(t,"b",(function(){return l})),n.d(t,"a",(function(){return b}));var r,o=n(8),c=n(12),a=n(27),i=Object(c.a)(a.collections);try{for(i.s();!(r=i.n()).done;){var s=r.value;delete a.jsonSchemas[s].properties.id,delete a.jsonSchemas[s].properties.parentId}}catch(j){i.e(j)}finally{i.f()}var u,l={},d=Object(c.a)(a.collections);try{for(d.s();!(u=d.n()).done;){var p=u.value;l[p]={}}}catch(j){d.e(j)}finally{d.f()}var f={"ui:widget":"textarea","ui:options":{rows:20}};l.mMarkdowns.text=f,l.mSurveys.question=f,l.mQuizTests.instruction=f,l.mQuizzes.question=f,l.mQuizzes.explanation=f,l.mQuotes.quote=f;var b={};a.collections.forEach((function(e){var t=a.jsonSchemas[e].properties;b[e]={};for(var n=0,r=Object.entries(t);n<r.length;n++){var c=Object(o.a)(r[n],2),i=c[0],s=c[1];b[e][i]=s.default}}))},21:function(e,t,n){"use strict";(function(e){n.d(t,"k",(function(){return h})),n.d(t,"h",(function(){return m})),n.d(t,"l",(function(){return O})),n.d(t,"i",(function(){return g})),n.d(t,"j",(function(){return v})),n.d(t,"e",(function(){return x})),n.d(t,"f",(function(){return k})),n.d(t,"b",(function(){return C})),n.d(t,"a",(function(){return q})),n.d(t,"d",(function(){return T})),n.d(t,"c",(function(){return L})),n.d(t,"g",(function(){return _}));var r=n(12),o=n(8),c=n(9),a=n.n(c),i=n(16),s=n(47),u=n(348),l=n(27),d=n(73),p=n(72),f=n(237),b=n(178);e.enabledFirestorePersistence||(e.enabledFirestorePersistence=!0,p.b.enablePersistence());var j=9999;function h(e,t,n){var r=W(e).limit(void 0===n?j:2);return void 0!==t&&(r=r.where("parentId","==",t)),Object(d.isOrdered)(e)&&(r=r.orderBy("order","asc"),n&&(r=r.startAfter(n))),Object(s.e)(r,{idField:"id"}).data}function m(e,t){var n=Object(s.d)().collection(Object(d.collectionPath)(e)).doc(t),r=Object(s.f)(n,{idField:"id"}).data;return 1===Object.keys(r).length?void 0:r}function O(e,t,n){return Object(l.useMacros)(t,(function(t,r){return h([e,t],r,n)}))}function g(e,t){var n=J;return Object(u.a)(n,[e,t])}function v(e,t){var n=Object(s.d)().collection(Object(d.collectionPath)(e)).doc(t),r=n.update.bind(n);return function(){var t=Object(i.a)(a.a.mark((function t(n){var o;return a.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return ee(n),t.next=3,te(e,n);case 3:return o=G(n),t.next=6,r(o);case 6:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()}function x(e){return y.apply(this,arguments)}function y(){return(y=Object(i.a)(a.a.mark((function e(t){var n,o,c,i,s,u;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,k("books",t);case 2:if(n=e.sent){e.next=5;break}return e.abrupt("return",void 0);case 5:o={},c=Object(r.a)(l.bookDataCollections),e.prev=7,c.s();case 9:if((i=c.n()).done){e.next=17;break}return s=i.value,e.next=13,K([t,s],void 0);case 13:u=e.sent,o[s]=u;case 15:e.next=9;break;case 17:e.next=22;break;case 19:e.prev=19,e.t0=e.catch(7),c.e(e.t0);case 22:return e.prev=22,c.f(),e.finish(22);case 25:return e.abrupt("return",{book:n,data:o});case 26:case"end":return e.stop()}}),e,null,[[7,19,22,25]])})))).apply(this,arguments)}function k(e,t){return I.apply(this,arguments)}function I(){return(I=Object(i.a)(a.a.mark((function e(t,n){var r;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,W(t).doc(n).get();case 2:return r=e.sent,e.abrupt("return",R(r));case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function w(e,t){return A.apply(this,arguments)}function A(){return(A=Object(i.a)(a.a.mark((function e(t,n){var r;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,W(t).add(n);case 2:return r=e.sent,e.abrupt("return",r.id);case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function C(e,t,n){return P.apply(this,arguments)}function P(){return(P=Object(i.a)(a.a.mark((function e(t,n,r){var o,c,i,s;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(o=Object(d.collectionFromPath)(t),c=Object(d.isOrdered)(t),e.t0=Object,e.t1=void 0===n?{}:{parentId:n},e.t2=b.a[o],!c){e.next=16;break}if(e.t4=r,e.t4){e.next=12;break}return e.next=10,Z(t,n);case 10:e.t5=e.sent,e.t4=e.t5+1;case 12:e.t6=e.t4,e.t3={order:e.t6},e.next=17;break;case 16:e.t3={};case 17:if(e.t7=e.t3,i=e.t0.assign.call(e.t0,e.t1,e.t2,e.t7),"mListSelects"!==o&&"mListShows"!==o){e.next=27;break}return s=t[0],e.next=23,X(s);case 23:if(e.t8=e.sent,e.t8){e.next=26;break}e.t8="";case 26:i.listId=e.t8;case 27:return e.next=29,w(t,i);case 29:return e.abrupt("return",e.sent);case 30:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function S(e,t,n){return M.apply(this,arguments)}function M(){return(M=Object(i.a)(a.a.mark((function e(t,n,r){return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,W(t).doc(n).set(r);case 2:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function q(e,t,n){return D.apply(this,arguments)}function D(){return(D=Object(i.a)(a.a.mark((function e(t,n,r){return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,k(t,n);case 2:if(e.sent){e.next=6;break}return e.next=6,S(t,n,r);case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function T(e,t){return z.apply(this,arguments)}function z(){return(z=Object(i.a)(a.a.mark((function e(t,n){return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,p.b.runTransaction((function(e){return F(e,t,n)}));case 2:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function F(e,t,n){return B.apply(this,arguments)}function B(){return(B=Object(i.a)(a.a.mark((function e(t,n,r){var o,c,s,u;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s=function(){return(s=Object(i.a)(a.a.mark((function e(n){var c,i,s;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return c=[o,n],e.next=3,W(c).where("parentId","==",r).get();case 3:return i=e.sent,s=i.docs.map((function(e){return F(t,c,e.id)})),e.next=7,Promise.all(s);case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)},c=function(e){return s.apply(this,arguments)},t.delete(W(n).doc(r)),o=n[0],u=l.bookDataCollections.map(c),e.next=7,Promise.all(u);case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function L(e,t){return E.apply(this,arguments)}function E(){return(E=Object(i.a)(a.a.mark((function e(t,n){return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,p.b.runTransaction((function(e){return Q(e,t,n)}));case 2:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Q(e,t,n,r){return N.apply(this,arguments)}function N(){return(N=Object(i.a)(a.a.mark((function e(t,n,r,o){var c,s,u,d,p,f,b,j,h,m,O;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(m=function(){return(m=Object(i.a)(a.a.mark((function e(r){var o,c,i,s;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=[b,r],c=[j,r],e.next=4,W(o).where("parentId","==",n.id).get();case 4:return i=e.sent,s=i.docs.map((function(e){return Q(t,{bookIdAndDataCollection:o,id:e.id},{bookIdAndDataCollection:c,parentId:f},e.data())})),e.next=8,Promise.all(s);case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)},h=function(e){return m.apply(this,arguments)},o){e.next=11;break}return c=W(n.bookIdAndDataCollection),s=c.doc(n.id),e.next=7,s.get();case 7:if(u=e.sent,o=u.data()){e.next=11;break}return e.abrupt("return");case 11:return d=W(r.bookIdAndDataCollection).doc(),p=Object.assign({},o,{parentId:r.parentId}),t.set(d,p),f=d.id,b=n.bookIdAndDataCollection[0],j=r.bookIdAndDataCollection[0],O=l.bookDataCollections.map(h),e.next=20,Promise.all(O);case 20:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function _(e,t,n){return U.apply(this,arguments)}function U(){return(U=Object(i.a)(a.a.mark((function e(t,n,r){return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,W(t).doc(n).update({parentId:r});case 2:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function R(e){var t=e.data();if(t){var n=t;return n.id=e.id,n}}function G(e){var t=Object.assign({},e);return delete t.id,t}function W(e){return p.b.collection(Object(d.collectionPath)(e))}function K(e,t,n){return V.apply(this,arguments)}function V(){return(V=Object(i.a)(a.a.mark((function e(t,n,r){var o,c;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=W(t).limit(void 0===r?j:2),void 0!==n&&(o=o.where("parentId","==",n)),Object(d.isOrdered)(t)&&(o=o.orderBy("order","asc"),r&&(o=o.startAfter(r))),e.next=5,o.get();case 5:return c=e.sent,e.abrupt("return",c.docs.map((function(e){return R(e)})));case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function J(e,t){return Y.apply(this,arguments)}function Y(){return(Y=Object(i.a)(a.a.mark((function e(t,n){var r,o;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=[];case 1:if(!n){e.next=8;break}return e.next=4,k(t,n);case 4:(o=e.sent)?(r.push(o),n=o.parentId):n="",e.next=1;break;case 8:return e.abrupt("return",r);case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Z(e,t){return H.apply(this,arguments)}function H(){return(H=Object(i.a)(a.a.mark((function e(t,n){var r,o;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=W(t).orderBy("order","desc").limit(1),void 0!==n&&(r=r.where("parentId","==",n)),e.next=4,r.get();case 4:return o=e.sent,e.abrupt("return",o.empty?0:o.docs[0].data().order);case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function X(e){return $.apply(this,arguments)}function $(){return($=Object(i.a)(a.a.mark((function e(t){var n;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,K([t,"lists"],void 0);case 2:return n=e.sent,e.abrupt("return",0===n.length?void 0:n[0].id);case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function ee(e){for(var t=0,n=Object.entries(e);t<n.length;t++){var r=Object(o.a)(n[t],2),c=r[0];void 0===r[1]&&(e[c]="")}}function te(e,t){return ne.apply(this,arguments)}function ne(){return(ne=Object(i.a)(a.a.mark((function e(t,n){var r,o;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=600,"mImages"!==(o=Object(d.collectionFromPath)(t))&&"mQuotes"!==o){e.next=8;break}return e.next=5,Object(f.a)(n.image,r);case 5:n.image=e.sent,e.next=12;break;case 8:if("pages"!==o||"string"!==typeof n.visual){e.next=12;break}return e.next=11,Object(f.a)(n.visual,r);case 11:n.visual=e.sent;case 12:case"end":return e.stop()}}),e)})))).apply(this,arguments)}}).call(this,n(75))},230:function(e,t,n){"use strict";var r=n(9),o=n(164),c=n(320),a=n(626);function i(){return(i=a(r.mark((function e(n,a){var i,u,l,d,p,f;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:i=[],u=c(t.macroTypes),e.prev=2,u.s();case 4:if((l=u.n()).done){e.next=13;break}return d=l.value,e.next=8,a(d,n);case 8:p=e.sent,f=s(d,p),i.push.apply(i,o(f));case 11:e.next=4;break;case 13:e.next=18;break;case 15:e.prev=15,e.t0=e.catch(2),u.e(e.t0);case 18:return e.prev=18,u.f(),e.finish(18);case 21:return i.sort((function(e,t){return e.doc.order-t.doc.order})),e.abrupt("return",i);case 23:case"end":return e.stop()}}),e,null,[[2,15,18,21]])})))).apply(this,arguments)}function s(e,t){return t.map((function(t){return{macroType:e,doc:t}}))}Object.defineProperty(t,"__esModule",{value:!0}),t.useMacros=t.getMacros=t.tocTypes=t.macroTypes=void 0,t.macroTypes=["mAccordions","mAudios","mImages","mIncludePages","mInputs","mListSelects","mListShows","mMarkdowns","mQuizTests","mQuizzes","mQuotes","mSurveys","mTocs","mYouTubes"],t.tocTypes=["parts","chapters","subpages"],t.getMacros=function(e,t){return i.apply(this,arguments)},t.useMacros=function(e,n){var r,a=[],i=c(t.macroTypes);try{for(i.s();!(r=i.n()).done;){var u=r.value,l=s(u,n(u,e));a.push.apply(a,o(l))}}catch(d){i.e(d)}finally{i.f()}return a.sort((function(e,t){return e.doc.order-t.doc.order})),a}},237:function(e,t,n){"use strict";function r(e,t){return e?new Promise((function(n){var r=new Image;r.onload=function(){if(r.width<=t)n(e);else{var o=function(e,t){var n=e.height*t/e.width,r=document.createElement("canvas");return r.width=t,r.height=n,r.getContext("2d").drawImage(e,0,0,t,n),r.toDataURL("image/jpeg",.7)}(r,t);n(o)}},r.src=e})):Promise.resolve("")}n.d(t,"a",(function(){return r}))},27:function(e,t,n){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n),Object.defineProperty(e,r,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),o=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||r(t,e,n)};Object.defineProperty(t,"__esModule",{value:!0}),o(n(318),t),o(n(627),t),o(n(321),t),o(n(230),t),o(n(628),t)},318:function(e,t,n){"use strict";var r=n(164);Object.defineProperty(t,"__esModule",{value:!0}),t.collections=t.bookDataCollections=t.childCollectionsWithoutOrder=t.collectionsWithoutParent=void 0;var o=n(230);t.collectionsWithoutParent=["books"],t.childCollectionsWithoutOrder=["lists"],t.bookDataCollections=[].concat(r(t.childCollectionsWithoutOrder),["pages"],r(o.macroTypes)),t.collections=[].concat(r(t.collectionsWithoutParent),r(t.bookDataCollections))},321:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.iconSets=void 0,t.iconSets=["AntDesign","Entypo","EvilIcons","Feather","FontAwesome","FontAwesome5","Fontisto","Foundation","Ionicons","MaterialCommunityIcons","MaterialIcons","Octicons","Zocial","SimpleLineIcons"]},348:function(e,t,n){"use strict";n.d(t,"a",(function(){return a}));var r=n(87),o=n(349),c=n.n(o);function a(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},o=n.category||e.toString(),a=n.lifespan||1e4,i=[o].concat(Object(r.a)(t)),s=function(){return e.apply(null,t)};return c()(s,i,a)}},627:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.topPageIds=void 0,t.topPageIds={sidebar:"sidebar",parts:"parts"}},628:function(e,t,n){"use strict";var r=n(231);Object.defineProperty(t,"__esModule",{value:!0}),t.jsonSchemas=t.defaultImage=void 0;var o=n(318),c=n(321),a=n(230);t.defaultImage="data:image/gif;base64,R0lGODlhEAAQAMQAAORHHOVSKudfOulrSOp3WOyDZu6QdvCchPGolfO0o/XBs/fNwfjZ0frl3/zy7////wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACH5BAkAABAALAAAAAAQABAAAAVVICSOZGlCQAosJ6mu7fiyZeKqNKToQGDsM8hBADgUXoGAiqhSvp5QAnQKGIgUhwFUYLCVDFCrKUE1lBavAViFIDlTImbKC5Gm2hB0SlBCBMQiB0UjIQA7",t.jsonSchemas={books:{title:"Book",type:"object",properties:{title:{type:"string",default:"Book title"},subtitle:{type:"string",default:"Subtitle"},language:{type:"string",enum:["en","vi"],default:"en"}},required:["title","language"]},lists:{title:"List",description:"List of groups of text",type:"object",properties:{title:{type:"string",default:"List title"},groups:{type:"array",items:{title:"Group",type:"object",properties:{name:{type:"string",default:"Group name"},items:{type:"array",items:{type:"string",default:"Item name"},uniqueItems:!0}},required:["name","items"]},uniqueItems:!0,default:[{name:"Group 1",items:["Item1","Item2"]},{name:"Group 2",items:["Item3","Item4"]}]}},required:["title","groups"]},pages:{title:"Page",description:"Pages can be structured into a tree",type:"object",properties:{title:{type:"string",default:"Page title"},visual:{oneOf:[{title:"Icon",type:"object",properties:{iconSet:{type:"string",enum:c.iconSets},icon:{type:"string"}},required:["iconSet","icon"]},{title:"Image",type:"string",format:"data-url",default:t.defaultImage}],default:{iconSet:"Ionicons",icon:"paper-plane-outline"}}},required:["title"]},mAccordions:{title:"Accordion",description:"Macro that shows child pages in an accordion",type:"object",properties:{}},mAudios:{title:"Audio",description:"Macro that shows an audio player",type:"object",properties:{title:{type:"string",default:"Title"},artist:{type:"string",default:"Artist"},url:{type:"string",default:"URL or resource ID"}},required:["title","url"]},mImages:{title:"Image",description:"Macro that shows an image",type:"object",properties:{image:{type:"string",format:"data-url",default:t.defaultImage},caption:{type:"string",default:"Image caption"}},required:["image"]},mIncludePages:{title:"Include page",description:"Macro that includes the content of another page",type:"object",properties:{pageId:{type:"string",default:"ID of the page to include"}},required:["pageId"]},mInputs:{title:"Input",description:"Macro that records user text input",type:"object",properties:{multiline:{type:"boolean",default:!1}},required:["multiline"]},mListSelects:{title:"List select",description:"Macro that lets user select from a text list",type:"object",properties:{listId:{title:"List ID",type:"string"}},required:["listId"]},mListShows:{title:"List show",description:"Macro that shows a text list",type:"object",properties:{listId:{title:"List ID",type:"string"}},required:["listId"]},mMarkdowns:{title:"Markdown",description:"Macro that shows text in Markdown format",type:"object",properties:{text:{type:"string",default:"Markdown text"}},required:["text"]},mQuizTests:{title:"Quiz test",description:"Macro that shows a test containing multiple quizzes",type:"object",properties:{title:{type:"string",default:"Title"},instruction:{description:"Markdown",type:"string",default:"Instruction for the test."},min:{description:"Minimum number of quizzes to create",type:"integer",default:5},max:{description:"Maximum number of quizzes to create",type:"integer",default:50},sources:{type:"array",items:{title:"Quiz source",type:"object",properties:{pageId:{description:"Page containing quizzes",type:"string",default:"pageId"},min:{description:"Minimum number of quizzes to take from this source, when there are multiple sources",type:"integer",default:5},max:{description:"Maximum number of quizzes to take from this source, when there are multiple sources",type:"integer",default:50}},required:["pageId","min","max"]},uniqueItems:!0,default:[{pageId:"pageId",min:5,max:50}]}},required:["title","min","max","sources"]},mQuizzes:{title:"Quiz",description:"Macro that shows a quiz (can be multiple choices)",type:"object",properties:{question:{description:"Markdown",type:"string",default:"Quiz question?"},choices:{type:"array",items:{title:"Choice",type:"object",properties:{choice:{type:"string",default:"Choice"},correct:{type:"boolean",default:!1}},required:["choice","correct"]},uniqueItems:!0,default:[{choice:"Choice 1",correct:!0},{choice:"Choice 2",correct:!1}]},multiple:{type:"boolean",default:!1},explanation:{description:"Explanation about the answer (Markdown)",type:"string",default:"Markdown text"}},required:["question","choices","multiple"]},mQuotes:{title:"Quote",description:"Macro that shows a quote",type:"object",properties:{quote:{description:"Markdown",type:"string",default:"Markdown text"},author:{type:"string",default:"Author of the quote"},image:{type:"string",format:"data-url",default:t.defaultImage}},required:["quote","author"]},mSurveys:{title:"Survey",description:"Macro that shows a survey question",type:"object",properties:{question:{description:"Markdown",type:"string",default:"Ask something?"},choices:{type:"array",items:{type:"string",default:"Choice"},uniqueItems:!0,default:["Choice 1","Choice 2"]},multiple:{type:"boolean",default:!1}},required:["question","choices","multiple"]},mTocs:{title:"Toc",description:"Macro that shows table of contents of child pages",type:"object",properties:{type:{type:"string",enum:a.tocTypes,default:"subpages"}},required:["type"]},mYouTubes:{title:"YouTube",description:"Macro that shows a YouTube video",type:"object",properties:{videoId:{type:"string",default:"pVBev5-2Ujk"}},required:["videoId"]}};for(var i=0,s=Object.entries(t.jsonSchemas);i<s.length;i++){var u=r(s[i],2),l=u[0],d=u[1],p=o.collectionsWithoutParent.includes(l),f=o.childCollectionsWithoutOrder.includes(l);d.properties=Object.assign({},{id:{type:"string"}},p?{}:f?{parentId:{type:"string"}}:{parentId:{type:"string"},order:{type:"integer",default:99}},d.properties),d.required||(d.required=[]),p?d.required.unshift("id"):f?d.required.unshift("id","parentId"):d.required.unshift("id","parentId","order")}},636:function(e,t,n){"use strict";n.r(t);var r=n(3),o=n(0),c=n.n(o),a=n(20),i=n.n(a),s=n(57),u=n(698),l=n(47),d=n(30),p=n(678),f=n(639),b=n(180),j=(n(620),n(8)),h=n(700),m=n(699),O=Object(d.b)({key:"snackbarState",default:{severity:"info",msg:""}});function g(){var e=Object(d.c)(O),t=Object(j.a)(e,2),n=t[0],o=n.severity,c=n.msg,a=t[1];return Object(r.jsx)(h.a,{open:c.length>0,autoHideDuration:3e3,onClose:function(){return a({severity:o,msg:""})},children:Object(r.jsx)(m.a,{severity:o,children:c})})}function v(){var e=Object(d.c)(O),t=Object(j.a)(e,2)[1];return function(e,n){return t({severity:e,msg:n})}}var x=n(684),y=n(357),k=Object(x.a)((function(e){return{paper:{marginBottom:e.spacing(2),padding:e.spacing(2)}}}));function I(e){var t=e.children,n=k();return Object(r.jsx)(y.a,{className:n.paper,children:t})}function w(){var e=Object(l.c)(),t=v();return Object(r.jsx)(p.a,{item:!0,md:6,sm:12,children:Object(r.jsx)(I,{children:Object(r.jsx)(b.a,{autoComplete:"off",schema:{type:"object",required:["email","password"],properties:{email:{type:"string",format:"email",title:"Email"},password:{type:"string",title:"Password"}}},uiSchema:{password:{"ui:widget":"password"}},onSubmit:function(n){var r,o,c=n.formData;return r=c.email,o=c.password,void e.signInWithEmailAndPassword(r,o).then((function(){}),(function(e){t("error","Could not login"),console.error(e)}))},children:Object(r.jsx)(f.a,{type:"submit",color:"primary",children:"Login"})})})})}var A=n(72),C=n(29),P=n(241),S=n(21),M=n(87),q=n(9),D=n.n(q),T=n(16),z=n(27),F=n(178),B=n(685),L=n(686),E=n(687),Q=n(688),N=n(689),_=Object(d.b)({key:"confirmDlgState",default:{open:!1,msg:"",onConfirm:function(){}}});function U(){var e=Object(d.c)(_),t=Object(j.a)(e,2),n=t[0],o=n.open,c=n.msg,a=n.onConfirm,i=t[1],s=function(){i({open:!1,msg:"",onConfirm:function(){}})};return Object(r.jsxs)(B.a,{open:o,onClose:s,children:[Object(r.jsx)(L.a,{children:"Confirm"}),Object(r.jsx)(E.a,{children:Object(r.jsx)(Q.a,{children:c})}),Object(r.jsxs)(N.a,{children:[Object(r.jsx)(f.a,{onClick:function(){a(),s()},color:"secondary",children:"OK"}),Object(r.jsx)(f.a,{onClick:s,color:"primary",autoFocus:!0,children:"Cancel"})]})]})}var R=n(38),G=n(95),W=n(58),K=n(59);function V(e,t){var n=document.createElement("a");n.setAttribute("href",t),n.setAttribute("download",e),n.style.display="none",document.body.appendChild(n),n.click(),document.body.removeChild(n)}function J(e,t){return e.replace(";base64",";name=".concat(encodeURIComponent(t),";base64"))}function Y(e){var t=e.name,n=e.size,r=e.type;return new Promise((function(o,c){var a=new window.FileReader;a.onerror=c,a.onload=function(e){o({dataURL:J(e.target.result,t),name:t,size:n,type:r})},a.readAsDataURL(e)}))}function Z(e){var t=e.filesInfo;return 0===t.length?null:Object(r.jsx)("ul",{className:"file-info",children:t.map((function(e,t){var n=e.name,o=e.size,c=e.type;return Object(r.jsxs)("li",{children:[Object(r.jsx)("strong",{children:n})," (",c,", ",o," bytes)",Object(r.jsx)("br",{}),Object(r.jsx)("button",{onClick:function(){return V(e.name,e.dataURL)},children:"Download"})]},t)}))})}function H(e){return e.filter((function(e){return"undefined"!==typeof e})).map((function(e){var t=function(e){var t,n=e.split(","),r=n[0].split(";"),o=r[0].replace("data:",""),c=r.filter((function(e){return"name"===e.split("=")[0]}));t=1!==c.length?"unknown":c[0].split("=")[1];for(var a=atob(n[1]),i=[],s=0;s<a.length;s++)i.push(a.charCodeAt(s));return{blob:new window.Blob([new Uint8Array(i)],{type:o}),name:t}}(e),n=t.blob;return{name:t.name,size:n.size,type:n.type,dataURL:e}}))}var X=function(e){Object(W.a)(n,e);var t=Object(K.a)(n);function n(e){var r;Object(R.a)(this,n),(r=t.call(this,e)).onChange=function(e){var t,n=r.props,o=n.multiple,c=n.onChange;(t=e.target.files,Promise.all([].map.call(t,Y))).then((function(e){var t={values:e.map((function(e){return e.dataURL})),filesInfo:e};r.setState(t,(function(){c(o?t.values:t.values[0])}))}))};var o=e.value,c=Array.isArray(o)?o:[o];return r.state={values:c,filesInfo:H(c)},r}return Object(G.a)(n,[{key:"shouldComponentUpdate",value:function(e,t){return function(e,t,n){var r=e.props,o=e.state;return!ee(r,t)||!ee(o,n)}(this,e,t)}},{key:"render",value:function(){var e=this,t=this.props,n=t.multiple,o=t.id,c=t.readonly,a=t.disabled,i=t.autofocus,s=t.options,u=this.state.filesInfo;return Object(r.jsxs)("div",{children:[Object(r.jsx)("p",{children:Object(r.jsx)("input",{ref:function(t){return e.inputRef=t},id:o,type:"file",disabled:c||a,onChange:this.onChange,defaultValue:"",autoFocus:i,multiple:n,accept:s.accept})}),Object(r.jsx)(Z,{filesInfo:u})]})}}]),n}(o.Component);X.defaultProps={autofocus:!1};var $=X;function ee(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[];if(e===t)return!0;if("function"===typeof e||"function"===typeof t)return!0;if("object"!==typeof e||"object"!==typeof t)return!1;if(null===e||null===t)return!1;if(e instanceof Date&&t instanceof Date)return e.getTime()===t.getTime();if(e instanceof RegExp&&t instanceof RegExp)return e.source===t.source&&e.global===t.global&&e.multiline===t.multiline&&e.lastIndex===t.lastIndex&&e.ignoreCase===t.ignoreCase;if(te(e)||te(t)){if(!te(e)||!te(t))return!1;var o=Array.prototype.slice;return ee(o.call(e),o.call(t),n,r)}if(e.constructor!==t.constructor)return!1;var c=Object.keys(e),a=Object.keys(t);if(0===c.length&&0===a.length)return!0;if(c.length!==a.length)return!1;for(var i,s=n.length;s--;)if(n[s]===e)return r[s]===t;n.push(e),r.push(t),c.sort(),a.sort();for(var u=c.length-1;u>=0;u--)if(c[u]!==a[u])return!1;for(var l=c.length-1;l>=0;l--)if(!ee(e[i=c[l]],t[i],n,r))return!1;return n.pop(),r.pop(),!0}function te(e){return"[object Arguments]"===Object.prototype.toString.call(e)}var ne=n(645),re=n(690),oe=Object(d.b)({key:"longRunningTaskState",default:{open:!1,msg:""}});function ce(){var e=Object(d.c)(oe),t=Object(j.a)(e,2)[1];return function(){var e=Object(T.a)(D.a.mark((function e(n,r){var o;return D.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t({open:!0,msg:n}),e.prev=1,e.next=4,r();case 4:t({open:!1,msg:""}),e.next=13;break;case 7:e.prev=7,e.t0=e.catch(1),o="Error running task: ".concat(n),console.error(o,e.t0),t({open:!0,msg:o}),setTimeout((function(){return t({open:!1,msg:""})}),3e3);case 13:case"end":return e.stop()}}),e,null,[[1,7]])})));return function(t,n){return e.apply(this,arguments)}}()}var ae=Object(x.a)((function(e){return{backdrop:{zIndex:e.zIndex.drawer+1,color:"#fff"},msg:{margin:"1em"}}}));function ie(){var e=Object(d.c)(oe),t=Object(j.a)(e,1)[0],n=t.open,o=t.msg,c=ae();return Object(r.jsxs)(ne.a,{className:c.backdrop,open:n,children:[Object(r.jsx)(re.a,{color:"inherit"}),Object(r.jsx)(P.a,{className:c.msg,children:o})]})}var se=Object(x.a)((function(){return{buttons:{display:"flex",justifyContent:"space-between"}}}));function ue(e){var t=e.bookId,n=e.collection,c=e.doc,a=e.onDelete,i=se(),s=ce(),u=v(),l=function(){var e=Object(d.c)(_),t=Object(j.a)(e,2)[1];return function(e,n){t({open:!0,msg:e,onConfirm:n})}}(),p=Object(C.g)(),h=Object(o.useState)(c),m=Object(j.a)(h,2),O=m[0],g=m[1],x=Object(o.useState)(le(O)),y=Object(j.a)(x,2),k=y[0],w=y[1],A="books"===n?n:[t,n],P=Object(S.j)(A,c.id),M=function(){var e=Object(T.a)(D.a.mark((function e(){var t;return D.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a&&a(),"string"!==typeof A){e.next=3;break}return e.abrupt("return");case 3:if("pages"!==(t=A)[1]){e.next=9;break}s("Deleting page...",Object(T.a)(D.a.mark((function e(){return D.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(S.d)(t,c.id);case 2:u("info","Successfully deleted the page");case 3:case"end":return e.stop()}}),e)})))),e.next=19;break;case 9:return e.prev=9,e.next=12,Object(S.d)(t,c.id);case 12:u("info","Successfully deleted"),e.next=19;break;case 15:e.prev=15,e.t0=e.catch(9),console.error("Successfully deleted document of ".concat(n,": ").concat(c.id)),u("error","Could not delete");case 19:case"end":return e.stop()}}),e,null,[[9,15]])})));return function(){return e.apply(this,arguments)}}();return Object(r.jsx)(I,{children:Object(r.jsx)(b.a,{autoComplete:"off",schema:z.jsonSchemas[n],uiSchema:F.b[n],widgets:{FileWidget:$},formData:O,onSubmit:function(e){var t=e.formData;return P(t).then((function(){g(t),w(le(t)),u("info","Successfully updated")}),(function(e){u("error","Could not update"),console.error(e)}))},children:Object(r.jsxs)("div",{className:i.buttons,children:[Object(r.jsx)(f.a,{type:"submit",color:"primary",children:"Update"}),"books"===n&&Object(r.jsx)(f.a,{color:"primary",onClick:function(){return p.push("/books/".concat(t))},children:"Edit content"}),"books"!==n&&Object(r.jsx)(f.a,{color:"secondary",onClick:function(){z.macroTypes.includes(n)?M():l("Do you want to delete this document of ".concat(n,"?"),M)},children:"Delete"})]})},k)})}function le(e){var t=de(e);return"".concat(e.id,"-").concat(t.join("-"))}function de(e){for(var t=[],n=0,r=Object.keys(e);n<r.length;n++){var o=r[n];t.push(o);var c=e[o];"object"!==typeof c||Array.isArray(c)||t.push.apply(t,Object(M.a)(de(c)))}return t}var pe=n(694),fe=n(695),be=n(679),je=n(701),he=n(352),me=n.n(he),Oe=n(37),ge=n(693);function ve(){var e=Object(l.c)(),t=Object(l.g)().data,n=v(),o=Object(C.g)();return Object(r.jsx)("div",{children:Object(r.jsxs)(P.a,{children:[Object(r.jsx)(f.a,{color:"primary",onClick:function(){e.signOut().then((function(){return o.push("/")}),(function(e){n("error","Could not logout"),console.error(e)}))},children:"Logout"}),t.email]})})}function xe(){return(xe=Object(T.a)(D.a.mark((function e(t){var n,r;return D.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(S.e)(t);case 2:return n=e.sent,r=JSON.stringify(n,null,2),e.next=6,ke("backup/"+we(t,{timestamped:!0}),r);case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function ye(){return(ye=Object(T.a)(D.a.mark((function e(t){var n,r;return D.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(S.e)(t);case 2:return n=e.sent,r=JSON.stringify(n,null,2),e.next=6,ke("backup/"+we(t,{timestamped:!0,tag:"publish"}),r);case 6:return e.next=8,ke("publish/"+we(t),r);case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function ke(e,t){return Ie.apply(this,arguments)}function Ie(){return(Ie=Object(T.a)(D.a.mark((function e(t,n){var r;return D.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=A.c.ref(t),e.next=3,r.putString(n,void 0,{contentType:"text/json"}).then();case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function we(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.timestamped,r=t.tag,o=n?"-"+Ae():"",c=r?"-"+r:"";return"".concat(e,"/happy-").concat(e).concat(o).concat(c,".json")}function Ae(){return(new Date).toISOString()}function Ce(){var e=Object(C.h)().bookId,t=Object(C.g)(),n=Object(S.h)("books",e),c=v();Object(o.useEffect)((function(){n||(console.error("Book not found: ".concat(e)),t.replace("/"))}));return n?Object(r.jsxs)(r.Fragment,{children:[Object(r.jsxs)("div",{children:[Object(r.jsx)(f.a,{color:"primary",onClick:function(){Object(S.e)(e).then((function(t){!function(e,t){var n=JSON.stringify(t,null,2);V(e,"data:application/json;charset=utf-8,"+encodeURIComponent(n))}("happy-".concat(e,".json"),t)}),(function(e){c("error","Could not download"),console.error(e)}))},children:"Download"}),Object(r.jsx)(f.a,{color:"primary",onClick:function(){(function(e){return xe.apply(this,arguments)})(e).then((function(){c("info","Created backup")}),(function(e){c("error","Could not backup"),console.error(e)}))},children:"Backup"}),Object(r.jsx)(f.a,{color:"primary",onClick:function(){(function(e){return ye.apply(this,arguments)})(e).then((function(){c("info","Created backup and published")}),(function(e){c("error","Could not publish"),console.error(e)}))},children:"Publish"})]}),Object(r.jsx)(f.a,{color:"primary",onClick:function(){return t.push("/")},children:"View book list"})]}):Object(r.jsx)(r.Fragment,{})}var Pe=n(691);function Se(){return Object(r.jsxs)(r.Fragment,{children:[Object(r.jsx)(m.a,{severity:"info",children:Object(r.jsx)(Pe.a,{href:"https://github.com/adam-p/markdown-here/wiki/Markdown-Cheatsheet",target:"_blank",children:"Markdown text format refence"})}),Object(r.jsx)(m.a,{severity:"info",children:Object(r.jsx)(Pe.a,{href:"https://oblador.github.io/react-native-vector-icons/",target:"_blank",children:"Icons"})}),Object(r.jsx)(m.a,{severity:"info",children:Object(r.jsx)(Pe.a,{href:"https://translate.google.com/?hl=vi&sl=en&tl=vi&op=translate",target:"_blank",children:"Google Translate"})})]})}var Me=n(19),qe=n(692),De=n(702),Te=n(240),ze=n.n(Te),Fe=n(351),Be=n.n(Fe),Le=n(350),Ee=n.n(Le);function Qe(){return(Qe=Object(T.a)(D.a.mark((function e(t){var n,r,o,c;return D.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=Object.keys(z.topPageIds),r=0;case 2:if(!(r<n.length)){e.next=10;break}return o=n[r],c={parentId:t,order:r+1,id:o,title:o},e.next=7,Object(S.a)([t,"pages"],o,c);case 7:r++,e.next=2;break;case 10:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Ne(e){var t=e.msg;return Object(r.jsx)(P.a,{color:"error",children:t})}var _e=function(e){Object(W.a)(n,e);var t=Object(K.a)(n);function n(e){var r;return Object(R.a)(this,n),(r=t.call(this,e)).state={hasError:!1},r}return Object(G.a)(n,[{key:"render",value:function(){return this.state.hasError?Object(r.jsx)(Ne,{msg:this.props.errorMsg}):this.props.children}}],[{key:"getDerivedStateFromError",value:function(e){return console.error(e),{hasError:!0}}}]),n}(o.Component);function Ue(e){return Object(r.jsx)(_e,{errorMsg:e.errorMsg,children:Object(r.jsx)(o.Suspense,{fallback:Object(r.jsx)(re.a,{}),children:e.children})})}var Re=n(12),Ge=Object(d.b)({key:"docTreeState",default:{expandedNodeIds:["pages"],selectedNodeId:"pages"}});function We(e,t,n){return"/books/".concat(e,"/").concat(t,"/").concat(n)}var Ke=We;function Ve(){return Object(d.c)(Ge)}function Je(){var e=Object(C.h)().bookId,t=Object(S.h)("books",e),n=Ve(),o=Object(j.a)(n,2),c=o[0],a=c.expandedNodeIds,i=c.selectedNodeId,s=o[1];return Object(r.jsxs)(I,{children:[Object(r.jsx)(P.a,{variant:"h5",children:null===t||void 0===t?void 0:t.title}),Object(r.jsx)(P.a,{variant:"h6",children:null===t||void 0===t?void 0:t.subtitle}),Object(r.jsxs)(qe.a,{defaultCollapseIcon:Object(r.jsx)(Ee.a,{}),defaultExpandIcon:Object(r.jsx)(Be.a,{}),expanded:a,selected:i,onNodeToggle:function(e,t){return s({expandedNodeIds:t,selectedNodeId:i})},children:[Object(r.jsx)(Ye,{bookId:e}),Object(r.jsx)(Ze,{bookId:e})]})]})}function Ye(e){var t=e.bookId;return Object(r.jsx)(De.a,{nodeId:"lists",label:"Text lists",children:Object(r.jsx)(He,{bookId:t,collection:"lists",recursive:!1,level:0,parentId:t,labelMaker:function(e){return e.title}})})}function Ze(e){var t=e.bookId;return Object(o.useEffect)((function(){Object(S.f)("books",t).then((function(e){e&&function(e){Qe.apply(this,arguments)}(t)}))}),[t]),Object(r.jsx)(De.a,{nodeId:"pages",label:"Pages",children:Object(r.jsx)(He,{bookId:t,collection:"pages",recursive:!0,level:0,parentId:t,labelMaker:function(e){return e.title}})})}function He(e){return Object(r.jsx)(Ue,{errorMsg:"Error loading ".concat(e.collection),children:Object(r.jsx)(Xe,Object(Me.a)({},e))})}function Xe(e){var t=e.bookId,n=e.collection,o=e.recursive,c=e.level,a=e.parentId,i=e.grandParentId,s=e.labelMaker,u=Object(C.g)(),l=Ve(),d=Object(j.a)(l,1)[0].selectedNodeId,p=Object(S.k)([t,n],a),f=v(),b=function(e){Object(S.b)([t,n],e).then((function(e){u.push(We(t,n,e))}),(function(e){console.error(e),f("error","Could not add new document to ".concat(n))}))};return Object(r.jsxs)(r.Fragment,{children:[p.map((function(e){var i=e.id,l=Ke(t,n,i),d=We(t,n,i);return Object(r.jsx)(De.a,{nodeId:l,label:s(e),onLabelClick:function(e){e.preventDefault(),u.push(d)},children:o&&Object(r.jsx)(He,{bookId:t,collection:n,recursive:!0,level:c+1,parentId:i,grandParentId:a,labelMaker:s})},l)})),(a===t&&"pages"!==n||Ke(t,n,a)===d)&&Object(r.jsxs)(r.Fragment,{children:[c<=3&&Object(r.jsx)(De.a,{nodeId:"add-doc-to-".concat(t,"-").concat(n,"-").concat(a),icon:Object(r.jsx)(ze.a,{}),label:"Add child",onClick:function(){return b(a)}}),i&&Object(r.jsx)(De.a,{nodeId:"add-doc-to-".concat(t,"-").concat(n,"-").concat(i),icon:Object(r.jsx)(ze.a,{}),label:"Add sibling",onClick:function(){return b(i)}})]})]})}function $e(){return Object(r.jsxs)(r.Fragment,{children:[Object(r.jsx)(C.b,{path:"/books/:bookId",children:Object(r.jsx)(Je,{})}),Object(r.jsxs)(I,{children:[Object(r.jsxs)(C.b,{path:"/books/:bookId",children:[Object(r.jsx)(Se,{}),Object(r.jsx)(Ce,{})]}),Object(r.jsx)(ve,{})]})]})}function et(){var e=Object(Oe.a)();return Object(ge.a)(e.breakpoints.up("md"))}function tt(e){var t=e.title,n=et(),c=Object(o.useState)(!1),a=Object(j.a)(c,2),i=a[0],s=a[1];return Object(r.jsx)(pe.a,{position:"static",children:Object(r.jsxs)(fe.a,{children:[!n&&Object(r.jsxs)(r.Fragment,{children:[Object(r.jsx)(be.a,{color:"inherit",edge:"start",onClick:function(){return s(!0)},children:Object(r.jsx)(me.a,{})}),Object(r.jsx)(je.a,{anchor:"left",open:i,onClose:function(){return s(!1)},children:Object(r.jsx)($e,{})})]}),Object(r.jsx)(P.a,{children:t})]})})}function nt(e){return Object(r.jsxs)(r.Fragment,{children:[Object(r.jsx)(tt,{title:e.title}),Object(r.jsx)("div",{style:{marginTop:"1em"},children:Object(r.jsx)(Ue,{errorMsg:"There's error, please try reloading this web page.",children:e.children})})]})}function rt(){var e=Object(S.k)("books",void 0);return e.sort((function(e,t){return e.title<t.title?-1:1})),Object(r.jsxs)(r.Fragment,{children:[e.map((function(e){return Object(r.jsx)(ue,{bookId:e.id,collection:"books",doc:e,onDelete:function(){}},e.id)})),Object(r.jsx)(f.a,{color:"primary",onClick:function(){return Object(S.b)("books",void 0)},children:"Add book"}),Object(r.jsx)(m.a,{severity:"info",children:Object(r.jsx)(P.a,{children:"Deleting books from this admin UI is not effecient for the system. If you want to delete a book, please contact a DB admin."})})]})}var ot=Object(r.jsx)(C.b,{path:"/",exact:!0,children:Object(r.jsx)(nt,{title:"Books",children:Object(r.jsx)(rt,{})})});function ct(){return Object(r.jsx)(P.a,{children:"Please start from the sidebar."})}var at=Object(r.jsx)(C.b,{path:"/books/:bookId",exact:!0,children:Object(r.jsx)(nt,{title:"Edit book",children:Object(r.jsx)(ct,{})})}),it=n(355),st=n(696),ut=n(697),lt=n(680),dt=n(683),pt=n(681),ft=n(682),bt=n(353),jt=n.n(bt);function ht(e){var t=e.bookId,n=e.pageId,o=e.order,a=c.a.useState(!1),i=Object(j.a)(a,2),s=i[0],u=i[1],l=c.a.useRef(null),d=c.a.useState(0),b=Object(j.a)(d,2),h=b[0],m=b[1],O=z.macroTypes[h],g=z.jsonSchemas[O].title,v=function(e){l.current&&l.current.contains(e.target)||u(!1)};return Object(r.jsx)(p.a,{container:!0,direction:"column",alignItems:"center",children:Object(r.jsxs)(p.a,{item:!0,xs:12,children:[Object(r.jsxs)(st.a,{variant:"contained",color:"primary",ref:l,children:[Object(r.jsxs)(f.a,{onClick:function(){Object(S.b)([t,O],n,o)},children:["Add ",g]}),Object(r.jsx)(f.a,{color:"primary",size:"small",onClick:function(){u((function(e){return!e}))},children:Object(r.jsx)(jt.a,{})})]}),Object(r.jsx)(ut.a,{open:s,anchorEl:l.current,role:void 0,transition:!0,disablePortal:!0,children:function(e){var t=e.TransitionProps,n=e.placement;return Object(r.jsx)(lt.a,Object(Me.a)(Object(Me.a)({},t),{},{style:{transformOrigin:"bottom"===n?"center top":"center bottom"},children:Object(r.jsx)(y.a,{children:Object(r.jsx)(dt.a,{onClickAway:v,children:Object(r.jsx)(pt.a,{children:z.macroTypes.map((function(e,t){return Object(r.jsx)(ft.a,{selected:t===h,onClick:function(e){return function(e,t){m(t),u(!1)}(0,t)},children:z.jsonSchemas[e].title},e)}))})})})}))}})]})})}function mt(e){var t=e.bookId,n=e.pageId,o=Object(S.l)(t,n);return Object(r.jsxs)("div",{children:[o.map((function(e){return function(e,t){var n=t.macroType,o=t.doc;return z.macroTypes.includes(n)?Object(r.jsx)(ue,{bookId:e,collection:n,doc:o},o.id):Object(r.jsx)(Ne,{msg:"Unknown page macro type: ".concat(n)})}(t,e)})),Object(r.jsx)(ht,{bookId:t,pageId:n,order:o.length+1})]})}var Ot=Object(d.b)({key:"srcPageState",default:{srcBookId:"",srcPage:void 0}});function gt(e){var t=e.bookId,n=e.currentPageAndAncestors,o=Object(d.c)(Ot),c=Object(j.a)(o,2),a=c[0],i=a.srcBookId,s=a.srcPage,u=c[1],l=ce(),p=v(),b=n[0],h=Object.keys(z.topPageIds).includes(b.id),m=Object(r.jsx)(f.a,{color:"secondary",onClick:function(){u({srcBookId:t,srcPage:b}),p("info","Select a page at the page tree to copy/move to")},children:"Copy/move this page"});if(!s)return h?null:m;if(s&&s.id===b.id)return null;if(function(e,t,n,r){if(e!==n)return!1;var o,c=Object(Re.a)(r);try{for(c.s();!(o=c.n()).done;){if(o.value.id===t.id)return!0}}catch(a){c.e(a)}finally{c.f()}return!1}(i,s,t,n))return m;if(function(e,t,n,r){if(e!==n)return!1;return t.parentId===r.id}(i,s,t,b))return m;var O=Object(r.jsx)(f.a,{color:"secondary",onClick:Object(T.a)(D.a.mark((function e(){return D.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:u({srcBookId:"",srcPage:void 0}),l("Copying page...",Object(T.a)(D.a.mark((function e(){return D.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(S.c)({bookIdAndDataCollection:[i,"pages"],id:s.id},{bookIdAndDataCollection:[t,"pages"],parentId:b.id});case 2:p("info","Page copy finished");case 3:case"end":return e.stop()}}),e)}))));case 2:case"end":return e.stop()}}),e)}))),children:"Copy it here"}),g=Object(r.jsx)(f.a,{color:"secondary",onClick:Object(T.a)(D.a.mark((function e(){return D.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return u({srcBookId:"",srcPage:void 0}),e.next=3,Object(S.g)([t,"pages"],s.id,b.id);case 3:p("info","Page move finished");case 4:case"end":return e.stop()}}),e)}))),children:"Move it here"}),x=Object(r.jsx)(Pe.a,{href:"/#/books/".concat(t,"/pages/").concat(s.id),target:"_blank",children:"Page to move"});return Object(r.jsxs)(r.Fragment,{children:[x,O,i===t&&g,m]})}function vt(e){var t=e.collection,n=Object(C.h)(),c=n.bookId,a=n.bookDataId,i=Object(S.i)([c,t],a),s=function(){var e=Object(d.c)(Ge),t=Object(j.a)(e,2),n=t[0].expandedNodeIds,r=t[1];return Object(o.useCallback)((function(e,t,o,c){var a,i=Ke(e,t,o),s=Object(M.a)(n),u=Object(Re.a)(c);try{for(u.s();!(a=u.n()).done;){var l=a.value,d=Ke(e,t,l);s.includes(d)||s.push(d)}}catch(f){u.e(f)}finally{u.f()}var p=s.length!==n.length;r({expandedNodeIds:p?s:n,selectedNodeId:i})}),[n,r])}(),u=Object(C.g)(),l=i.map((function(e){return e.id}));if(Object(it.a)((function(){return s(c,t,a,l)}),[s,c,t,a,l]),0===i.length)return Object(r.jsx)(Ne,{msg:"Could not load data to edit"});var p=i[0];return Object(r.jsxs)(r.Fragment,{children:["pages"===t&&Object(r.jsx)(gt,{bookId:c,currentPageAndAncestors:i}),Object(r.jsx)(ue,{bookId:c,collection:t,doc:p,onDelete:function(){return u.push("/books/".concat(c))}},"".concat(c,"/").concat(t,"/").concat(a)),"pages"===t&&Object(r.jsx)(Ue,{errorMsg:"Could not load macros",children:Object(r.jsx)(mt,{bookId:c,pageId:a},"".concat(c,"-").concat(a))})]})}var xt=[["lists","Edit text list"],["pages","Edit page"]].map((function(e){var t=Object(j.a)(e,2),n=t[0],o=t[1];return Object(r.jsx)(C.b,{path:"/books/:bookId/".concat(n,"/:bookDataId"),exact:!0,children:Object(r.jsx)(nt,{title:o,children:Object(r.jsx)(vt,{collection:n})})},n)}));function yt(){var e=et();return Object(r.jsxs)(p.a,{container:!0,spacing:e?2:0,children:[e&&Object(r.jsx)(p.a,{item:!0,md:5,children:Object(r.jsx)($e,{})}),Object(r.jsx)(p.a,{item:!0,md:7,sm:12,children:Object(r.jsxs)(C.d,{children:[ot,at,xt,Object(r.jsx)(C.a,{from:"*",to:"/"})]})})]})}function kt(){return Object(r.jsxs)(r.Fragment,{children:[Object(r.jsx)(u.a,{}),Object(r.jsx)(Ue,{errorMsg:"There's error, please try reloading this page",children:Object(r.jsx)(d.a,{children:Object(r.jsxs)(s.a,{children:[Object(r.jsx)(g,{}),Object(r.jsx)(U,{}),Object(r.jsx)(ie,{}),Object(r.jsx)(l.b,{firebaseApp:A.a,suspense:!0,children:Object(r.jsx)(l.a,{fallback:Object(r.jsx)(w,{}),children:Object(r.jsx)(yt,{})})})]})})})]})}i.a.render(Object(r.jsx)(kt,{}),document.getElementById("root"))},72:function(e,t,n){"use strict";(function(e){n.d(t,"a",(function(){return o})),n.d(t,"b",(function(){return c})),n.d(t,"c",(function(){return a}));var r=n(60),o=(n(637),n(638),r.a.initializeApp({apiKey:"AIzaSyB-svyOf1GKrlLnGCNWFo7SA9xMzKKLkys",projectId:"happy-child-302620",authDomain:"localhost",storageBucket:"gs://happy-child-302620.appspot.com"})),c=r.a.firestore(o),a=r.a.storage(o);e.firestore=c}).call(this,n(75))},73:function(e,t,n){"use strict";var r=n(231);Object.defineProperty(t,"__esModule",{value:!0}),t.isOrdered=t.collectionFromPath=t.collectionPath=void 0;var o=n(632);function c(e){return"string"===typeof e?e:e[1]}t.collectionPath=function(e){if("string"===typeof e)return e;var t=r(e,2),n=t[0],o=t[1];return"books/".concat(n,"/").concat(o)},t.collectionFromPath=c,t.isOrdered=function(e){var t=c(e),n=o.collectionsWithoutParent,r=o.childCollectionsWithoutOrder;return!n.includes(t)&&!r.includes(t)}}},[[636,3,4]]]);