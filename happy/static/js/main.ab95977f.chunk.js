(this["webpackJsonphappy-author"]=this["webpackJsonphappy-author"]||[]).push([[157],{104:function(e,t,n){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n);var o=Object.getOwnPropertyDescriptor(t,n);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,r,o)}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),o=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||r(t,e,n)};Object.defineProperty(t,"__esModule",{value:!0}),o(n(692),t),o(n(1377),t),o(n(906),t),o(n(335),t),o(n(907),t),o(n(1402),t)},1159:function(e,t,n){"use strict";n.d(t,"a",(function(){return a}));var r=n(119),o=n(1160),c=n.n(o);function a(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},o=n.category||e.toString(),a=n.lifespan||1e4,i=[o].concat(Object(r.a)(t)),s=function(){return e.apply(null,t)};return c()(s,i,a)}},1266:function(e,t,n){"use strict";n.r(t),n.d(t,"DocShow",(function(){return ce})),n.d(t,"ContextedEditor",(function(){return he})),n.d(t,"Editor",(function(){return fe})),n.d(t,"macrosToDoc",(function(){return D}));var r=n(96),o=n(443),c=n(631),a=n(0),i=n(612),s=n(2347),u=n(2337),l=n(2351),d=n(1263),p=n.n(d),f=n(104),b=n(2340),j=n(2324),h=n(1265);var m=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!==typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),v=function(){return v=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},v.apply(this,arguments)};function O(e,t){return e.replace(";base64",";name=".concat(encodeURIComponent(t),";base64"))}function y(e){var t=e.name,n=e.size,r=e.type;return new Promise((function(o,c){var a=new window.FileReader;a.onerror=c,a.onload=function(e){o({dataURL:O(e.target.result,t),name:t,size:n,type:r})},a.readAsDataURL(e)}))}function g(e){var t=e.filesInfo;return 0===t.length?null:Object(r.jsx)("ul",v({className:"file-info"},{children:t.map((function(e,t){var n=e.name,o=e.size,c=e.type;return Object(r.jsxs)("li",{children:[Object(r.jsx)("strong",{children:n})," (",c,", ",o," bytes)",Object(r.jsx)("br",{}),Object(r.jsx)("button",v({onClick:function(){return function(e,t){var n=document.createElement("a");n.setAttribute("href",t),n.setAttribute("download",e),n.style.display="none",document.body.appendChild(n),n.click(),document.body.removeChild(n)}(e.name,e.dataURL)}},{children:"Download"}))]},t)}))}))}function x(e){return e.map((function(e){return e||void 0})).filter((function(e){return"undefined"!==typeof e})).map((function(e){var t=function(e){var t,n=e.split(","),r=n[0].split(";"),o=r[0].replace("data:",""),c=r.filter((function(e){return"name"===e.split("=")[0]}));t=1!==c.length?"unknown":c[0].split("=")[1];for(var a=atob(n[1]),i=[],s=0;s<a.length;s++)i.push(a.charCodeAt(s));return{blob:new window.Blob([new Uint8Array(i)],{type:o}),name:t}}(e),n=t.blob;return{name:t.name,size:n.size,type:n.type,dataURL:e}}))}var k=function(e){function t(t){var n=e.call(this,t)||this;n.onChange=function(e){var t,r=n.props,o=r.multiple,c=r.onChange;(t=e.target.files,Promise.all([].map.call(t,y))).then((function(e){var t={values:e.map((function(e){return e.dataURL})),filesInfo:e};n.setState(t,(function(){c(o?t.values:t.values[0])}))}))};var r=t.value,o=Array.isArray(r)?r:[r];return n.state={values:o,filesInfo:x(o)},n}return m(t,e),t.prototype.shouldComponentUpdate=function(e,t){return function(e,t,n){var r=e.props,o=e.state;return!I(r,t)||!I(o,n)}(this,e,t)},t.prototype.render=function(){var e=this,t=this.props,n=t.multiple,o=t.id,c=t.readonly,a=t.disabled,i=t.autofocus,s=t.options,u=this.state.filesInfo;return Object(r.jsxs)("div",{children:[Object(r.jsx)("p",{children:Object(r.jsx)("input",{ref:function(t){return e.inputRef=t},id:o,type:"file",disabled:c||a,onChange:this.onChange,defaultValue:"",autoFocus:i,multiple:n,accept:s.accept})}),Object(r.jsx)(g,{filesInfo:u})]})},t}(a.Component);k.defaultProps={autofocus:!1};var w=k;function I(e,t,n,r){if(void 0===n&&(n=[]),void 0===r&&(r=[]),e===t)return!0;if("function"===typeof e||"function"===typeof t)return!0;if("object"!==typeof e||"object"!==typeof t)return!1;if(null===e||null===t)return!1;if(e instanceof Date&&t instanceof Date)return e.getTime()===t.getTime();if(e instanceof RegExp&&t instanceof RegExp)return e.source===t.source&&e.global===t.global&&e.multiline===t.multiline&&e.lastIndex===t.lastIndex&&e.ignoreCase===t.ignoreCase;if(A(e)||A(t)){if(!A(e)||!A(t))return!1;var o=Array.prototype.slice;return I(o.call(e),o.call(t),n,r)}if(e.constructor!==t.constructor)return!1;var c=Object.keys(e),a=Object.keys(t);if(0===c.length&&0===a.length)return!0;if(c.length!==a.length)return!1;for(var i=n.length;i--;)if(n[i]===e)return r[i]===t;n.push(e),r.push(t),c.sort(),a.sort();for(var s=c.length-1;s>=0;s--)if(c[s]!==a[s])return!1;for(var u=void 0,l=c.length-1;l>=0;l--)if(!I(e[u=c[l]],t[u],n,r))return!1;return n.pop(),r.pop(),!0}function A(e){return"[object Arguments]"===Object.prototype.toString.call(e)}var C=n(17),P=n(466),M=n(1268),S=n(670),z=new M.a(P.a),T=new S.a(P.a),_=function(){function e(){}return e.prototype.encode=function(e){return z.encode(e)},e.prototype.parse=function(e){return T.parse(e)},e}();function q(e){var t=[],n=[];function r(){var e=function(e){if(0===e.length)return null;var t={version:1,type:"doc",content:e},n=C.Node.fromJSON(P.a,t),r=Q(z.encode(n));if(0===r.length)return null;return{macroType:"mMarkdowns",doc:{text:r}}}(n);e&&t.push(e),n=[]}for(var o=0,c=e.content;o<c.length;o++){var a=c[o];"extension"===a.type?(r(),t.push(E(a))):n.push(a)}return r(),t}function D(e){for(var t=[],n=0,r=e;n<r.length;n++){var o=r[n];if("mMarkdowns"===o.macroType){var c=o.doc;T.parse(c.text).forEach((function(e){return t.push(e.toJSON())}))}else{var a=o.macroType,i=o.doc,s=f.shortJsonSchemas[a].title;t.push({type:"extension",attrs:{extensionType:o.macroType,extensionKey:s,parameters:i,layout:"default"}})}}return{version:1,type:"doc",content:t}}function Q(e){return e.replaceAll(/[\u21b5\u200c]/g,"").replace(/^\s+|\s+$/g,"")}function E(e){var t=e.attrs;return{macroType:t.extensionType,doc:t.parameters}}var F=function(e,t,n,r){return new(n||(n=Promise))((function(o,c){function a(e){try{s(r.next(e))}catch(t){c(t)}}function i(e){try{s(r.throw(e))}catch(t){c(t)}}function s(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,i)}s((r=r.apply(e,t||[])).next())}))},L=function(e,t){var n,r,o,c,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return c={next:i(0),throw:i(1),return:i(2)},"function"===typeof Symbol&&(c[Symbol.iterator]=function(){return this}),c;function i(c){return function(i){return function(c){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(o=2&c[0]?r.return:c[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,c[1])).done)return o;switch(r=0,o&&(c=[2&c[0],o.value]),c[0]){case 0:case 1:o=c;break;case 4:return a.label++,{value:c[1],done:!1};case 5:a.label++,r=c[1],c=[0];continue;case 7:c=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===c[0]||2===c[0])){a=0;continue}if(3===c[0]&&(!o||c[1]>o[0]&&c[1]<o[3])){a.label=c[1];break}if(6===c[0]&&a.label<o[1]){a.label=o[1],o=c;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(c);break}o[2]&&a.ops.pop(),a.trys.pop();continue}c=t.call(e,a)}catch(i){c=[6,i],r=0}finally{n=o=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([c,i])}}};for(var B={},R=0,U=f.collections;R<U.length;R++){var N=U[R];B[N]={}}for(var G={"ui:widget":"textarea"},J=Object(f.getMarkdownProperties)(),W=0,K=f.collections;W<K.length;W++)for(var V=K[W],$=0,H=J[V];$<H.length;$++){var Y=H[$];B[V][Y]=G}var Z={FileWidget:w,TextareaWidget:function(e){var t=this;return Object(r.jsxs)(o.a,{children:[Object(r.jsx)("label",{children:e.label}),Object(r.jsx)(c.a,{render:function(n){return Object(r.jsx)(u.a,{shouldFocus:!1,appearance:"comment",allowHelpDialog:!1,allowTables:!0,defaultValue:e.value,contentTransformerProvider:function(){return new _},onChange:function(){return F(t,void 0,void 0,(function(){var t,r;return L(this,(function(o){switch(o.label){case 0:return[4,n.getValue()];case 1:return t=o.sent(),r=Q(t),e.onChange(r),[2]}}))}))}})}})]})}},X=function(){return X=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},X.apply(this,arguments)};function ee(e){var t=e.macroType,n=e.params,o=e.formId,c=e.onSave,a=f.shortJsonSchemas[t];return Object(r.jsx)(h.a,X({id:o,autoComplete:"off",schema:a,uiSchema:B[t],widgets:Z,formData:n,onSubmit:function(e){return null===c||void 0===c?void 0:c(e.formData)}},{children:" "}))}var te=function(){return te=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},te.apply(this,arguments)};function ne(e){var t=e.macroType,n=e.params,o=e.onClose,c="macro-form-".concat(Date.now());return Object(r.jsxs)(b.a,{children:[Object(r.jsx)("div",{style:{marginTop:"1em"}}),Object(r.jsx)(ee,{formId:c,macroType:t,params:n,onSave:function(e){o(e)}}),Object(r.jsxs)(j.a,{children:[Object(r.jsx)(s.a,te({appearance:"primary",type:"submit",form:c},{children:"Save"})),Object(r.jsx)(s.a,te({onClick:function(){o(n)}},{children:"Cancel"}))]})]})}var re=n(1262),oe=n.n(re);function ce(e){var t=e.doc,n=e.sortKeys;return Object(r.jsx)("pre",{children:Object(r.jsx)("code",{children:oe.a.stringify(ae(t),{sortMapEntries:function(e,t){return n.indexOf(e.key.value)-n.indexOf(t.key.value)}})})})}function ae(e){for(var t={},n=0,r=Object.entries(e);n<r.length;n++){var o=r[n],c=o[0],a=o[1];["id","parentId","order"].includes(c)||(t[c]="string"===typeof a?a.length>50?a.substring(0,50)+"...":a:"object"===typeof a&&null!==a?Array.isArray(a)?a:ae(a):a)}return t}function ie(e){var t=e.macro,n=t.macroType,o=t.doc,c=f.shortJsonSchemas[n],a=Object.keys(c.properties);return Object(r.jsx)(ce,{doc:o,sortKeys:a})}function se(e){return f.macroTypes.filter((function(e){return"mMarkdowns"!==e})).map((function(t){return function(e,t){var n=f.shortJsonSchemas[e],o=n.description,c=n.title;return{categories:["Happy"],keywords:["happy"],title:"Happy ".concat(c),type:e,key:c,description:o,icons:{48:function(){return Promise.resolve(p.a)}},modules:{quickInsert:[{key:e,action:{type:"node",key:"default",parameters:f.newDocTemplates[e]}}],nodes:{default:{type:"extension",render:function(){return Promise.resolve(ue)},update:function(n){return new Promise((function(o){var c=function(e){o(e),t(null)};t(Object(r.jsx)(ne,{macroType:e,params:n,onClose:c}))}))}}}}}}(t,e)}))}function ue(e){var t=e.node,n=t.parameters,o={macroType:t.extensionType,doc:n};return Object(r.jsx)(ie,{macro:o})}var le=function(){return le=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},le.apply(this,arguments)},de=function(e,t,n,r){return new(n||(n=Promise))((function(o,c){function a(e){try{s(r.next(e))}catch(t){c(t)}}function i(e){try{s(r.throw(e))}catch(t){c(t)}}function s(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,i)}s((r=r.apply(e,t||[])).next())}))},pe=function(e,t){var n,r,o,c,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return c={next:i(0),throw:i(1),return:i(2)},"function"===typeof Symbol&&(c[Symbol.iterator]=function(){return this}),c;function i(c){return function(i){return function(c){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(o=2&c[0]?r.return:c[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,c[1])).done)return o;switch(r=0,o&&(c=[2&c[0],o.value]),c[0]){case 0:case 1:o=c;break;case 4:return a.label++,{value:c[1],done:!1};case 5:a.label++,r=c[1],c=[0];continue;case 7:c=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===c[0]||2===c[0])){a=0;continue}if(3===c[0]&&(!o||c[1]>o[0]&&c[1]<o[3])){a.label=c[1];break}if(6===c[0]&&a.label<o[1]){a.label=o[1],o=c;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(c);break}o[2]&&a.ops.pop(),a.trys.pop();continue}c=t.call(e,a)}catch(i){c=[6,i],r=0}finally{n=o=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([c,i])}}};function fe(e){var t=this,n=e.pageId,o=e.before,c=e.actions,d=e.onSave,p=Object(a.useState)(null),f=p[0],b=p[1],j=Object(a.useState)(null),h=j[0],m=j[1];return Object(a.useEffect)((function(){var e=se(m);b(new l.a(e))}),[]),f?Object(r.jsx)(i.b,le({locale:"en"},{children:Object(r.jsxs)(r.Fragment,{children:[Object(r.jsx)(u.a,{shouldFocus:!1,appearance:"comment",allowHelpDialog:!1,allowTables:!0,allowExtension:{allowAutoSave:!1},extensionProviders:[f],defaultValue:D(o),primaryToolbarComponents:d?Object(r.jsx)(s.a,le({appearance:"primary",onClick:function(){return de(t,void 0,void 0,(function(){var e,t,r;return pe(this,(function(a){switch(a.label){case 0:return[4,be(c)];case 1:return e=a.sent(),function(e,t){for(var n=[],r=function(r){var o=t[r].doc;return o.id?e.findIndex((function(e){return e.doc.id===o.id}))<0?(o.id="","continue"):void(n.includes(o.id)?o.id="":n.push(o.id)):"continue"},o=0;o<t.length;o++)r(o)}(o,e),t=function(e,t,n){for(var r=[],o=[],c=[],a=[],i=function(a){var i=n[a].doc;if(i.parentId=e,i.order=a+1,i.id){var s=t.findIndex((function(e){return e.doc.id===i.id}));if(s<0)throw new Error("Doc id has been set, thus the macro should have been saved before");I(t[s].doc,i)?c.push(a):o.push(a)}else r.push(a)},s=0;s<n.length;s++)i(s);for(var u=function(e){var r=t[e].doc;o.findIndex((function(e){return n[e].doc.id===r.id}))<0&&(c.findIndex((function(e){return n[e].doc.id===r.id}))<0&&a.push(e))},l=0;l<t.length;l++)u(l);var d=0,p=0;for(;d<r.length&&p<a.length;){var f=r[d],b=n[f];if("mMarkdowns"===b.macroType){var j=a[p],h=t[j];"mMarkdowns"===h.macroType?(b.doc.id=h.doc.id,I(b,h)||o.push(f),r.splice(d,1),a.splice(p,1)):p++}else d++}return{after:n,create:r,update:o,remove:a}}(n,o,e),[4,d(t)];case 2:return r=a.sent(),c.replaceDocument(D(r)),[2]}}))}))}},{children:"Save"})):void 0}),h]})})):null}function be(e){return de(this,void 0,void 0,(function(){return pe(this,(function(t){switch(t.label){case 0:return[4,e.getValue()];case 1:return[2,q(t.sent())]}}))}))}var je=function(){return je=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},je.apply(this,arguments)};function he(e){return Object(r.jsx)(o.a,{children:Object(r.jsx)(c.a,{render:function(t){return Object(r.jsx)(fe,je({},e,{actions:t}))}})})}t.default=he},131:function(e,t,n){"use strict";(function(e){n.d(t,"m",(function(){return j})),n.d(t,"j",(function(){return h})),n.d(t,"n",(function(){return m})),n.d(t,"k",(function(){return v})),n.d(t,"l",(function(){return O})),n.d(t,"f",(function(){return y})),n.d(t,"g",(function(){return x})),n.d(t,"a",(function(){return w})),n.d(t,"c",(function(){return A})),n.d(t,"h",(function(){return P})),n.d(t,"b",(function(){return S})),n.d(t,"e",(function(){return T})),n.d(t,"d",(function(){return Q})),n.d(t,"i",(function(){return B}));var r=n(65),o=n(55),c=n(61),a=n(98),i=n(238),s=n(1159),u=n(104),l=n(332),d=n(329),p=n(813),f=n(617);e.enabledFirestorePersistence||(e.enabledFirestorePersistence=!0,d.b.enablePersistence());var b=9999;function j(e,t,n){var r=G(e).limit(void 0===n?b:2);return void 0!==t&&(r=r.where("parentId","==",t)),Object(l.isOrdered)(e)&&(r=r.orderBy("order","asc"),n&&(r=r.startAfter(n))),Object(i.d)(r,{idField:"id"}).data}function h(e,t){var n=Object(i.c)().collection(Object(l.collectionPath)(e)).doc(t),r=Object(i.e)(n,{idField:"id"}).data;return 1===Object.keys(r).length?void 0:r}function m(e,t,n){return Object(u.useMacros)(t,(function(t,r){return j([e,t],r,n)}))}function v(e,t){var n=K;return Object(s.a)(n,[e,t])}function O(e,t){var n=Object(i.c)().collection(Object(l.collectionPath)(e)).doc(t),r=n.update.bind(n);return function(){var t=Object(a.a)(Object(c.a)().mark((function t(n){var o;return Object(c.a)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,ee(e,n);case 2:return X(n),o=N(n),t.next=6,r(o);case 6:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()}function y(e){return g.apply(this,arguments)}function g(){return(g=Object(a.a)(Object(c.a)().mark((function e(t){var n,o,a,i,s,l;return Object(c.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,x("books",t);case 2:if(n=e.sent){e.next=5;break}return e.abrupt("return",void 0);case 5:o={},a=Object(r.a)(u.bookDataCollections),e.prev=7,a.s();case 9:if((i=a.n()).done){e.next=17;break}return s=i.value,e.next=13,J([t,s],void 0);case 13:l=e.sent,o[s]=l;case 15:e.next=9;break;case 17:e.next=22;break;case 19:e.prev=19,e.t0=e.catch(7),a.e(e.t0);case 22:return e.prev=22,a.f(),e.finish(22);case 25:return e.abrupt("return",{book:n,data:o});case 26:case"end":return e.stop()}}),e,null,[[7,19,22,25]])})))).apply(this,arguments)}function x(e,t){return k.apply(this,arguments)}function k(){return(k=Object(a.a)(Object(c.a)().mark((function e(t,n){var r;return Object(c.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,G(t).doc(n).get();case 2:return r=e.sent,e.abrupt("return",U(r));case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function w(e,t){return I.apply(this,arguments)}function I(){return(I=Object(a.a)(Object(c.a)().mark((function e(t,n){var r;return Object(c.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,ee(t,n);case 2:return X(n),e.next=5,G(t).add(n);case 5:return r=e.sent,e.abrupt("return",r.id);case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function A(e,t,n){return C.apply(this,arguments)}function C(){return(C=Object(a.a)(Object(c.a)().mark((function e(t,n,r){var o,a,i,s;return Object(c.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(o=Object(l.collectionFromPath)(t),a=Object(l.isOrdered)(t),e.t0=Object,e.t1=void 0===n?{}:{parentId:n},e.t2=f.a[o],!a){e.next=16;break}if(e.t4=r,e.t4){e.next=12;break}return e.next=10,$(t,n);case 10:e.t5=e.sent,e.t4=e.t5+1;case 12:e.t6=e.t4,e.t3={order:e.t6},e.next=17;break;case 16:e.t3={};case 17:if(e.t7=e.t3,i=e.t0.assign.call(e.t0,e.t1,e.t2,e.t7),"mListSelects"!==o&&"mListShows"!==o){e.next=27;break}return s=t[0],e.next=23,Y(s);case 23:if(e.t8=e.sent,e.t8){e.next=26;break}e.t8="";case 26:i.listId=e.t8;case 27:return e.next=29,w(t,i);case 29:return e.abrupt("return",e.sent);case 30:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function P(e,t,n){return M.apply(this,arguments)}function M(){return(M=Object(a.a)(Object(c.a)().mark((function e(t,n,r){return Object(c.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,ee(t,r);case 2:return X(r),e.next=5,G(t).doc(n).set(r);case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function S(e,t,n){return z.apply(this,arguments)}function z(){return(z=Object(a.a)(Object(c.a)().mark((function e(t,n,r){return Object(c.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,x(t,n);case 2:if(e.sent){e.next=6;break}return e.next=6,P(t,n,r);case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function T(e,t){return _.apply(this,arguments)}function _(){return(_=Object(a.a)(Object(c.a)().mark((function e(t,n){return Object(c.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,d.b.runTransaction((function(e){return q(e,t,n)}));case 2:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function q(e,t,n){return D.apply(this,arguments)}function D(){return D=Object(a.a)(Object(c.a)().mark((function e(t,n,r){var o,i,s,l;return Object(c.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s=function(){return(s=Object(a.a)(Object(c.a)().mark((function e(n){var a,i,s;return Object(c.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=[o,n],e.next=3,G(a).where("parentId","==",r).get();case 3:return i=e.sent,s=i.docs.map((function(e){return q(t,a,e.id)})),e.next=7,Promise.all(s);case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)},i=function(e){return s.apply(this,arguments)},t.delete(G(n).doc(r)),o=n[0],l=u.bookDataCollections.map(i),e.next=7,Promise.all(l);case 7:case"end":return e.stop()}}),e)}))),D.apply(this,arguments)}function Q(e,t){return E.apply(this,arguments)}function E(){return(E=Object(a.a)(Object(c.a)().mark((function e(t,n){return Object(c.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,d.b.runTransaction((function(e){return F(e,t,n)}));case 2:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function F(e,t,n,r){return L.apply(this,arguments)}function L(){return L=Object(a.a)(Object(c.a)().mark((function e(t,n,r,o){var i,s,l,d,p,f,b,j,h,m,v;return Object(c.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(m=function(){return(m=Object(a.a)(Object(c.a)().mark((function e(r){var o,a,i,s;return Object(c.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=[b,r],a=[j,r],e.next=4,G(o).where("parentId","==",n.id).get();case 4:return i=e.sent,s=i.docs.map((function(e){return F(t,{bookIdAndDataCollection:o,id:e.id},{bookIdAndDataCollection:a,parentId:f},e.data())})),e.next=8,Promise.all(s);case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)},h=function(e){return m.apply(this,arguments)},o){e.next=11;break}return i=G(n.bookIdAndDataCollection),s=i.doc(n.id),e.next=7,s.get();case 7:if(l=e.sent,o=l.data()){e.next=11;break}return e.abrupt("return");case 11:return d=G(r.bookIdAndDataCollection).doc(),p=Object.assign({},o,{parentId:r.parentId}),t.set(d,p),f=d.id,b=n.bookIdAndDataCollection[0],j=r.bookIdAndDataCollection[0],v=u.bookDataCollections.map(h),e.next=20,Promise.all(v);case 20:case"end":return e.stop()}}),e)}))),L.apply(this,arguments)}function B(e,t,n){return R.apply(this,arguments)}function R(){return(R=Object(a.a)(Object(c.a)().mark((function e(t,n,r){return Object(c.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,G(t).doc(n).update({parentId:r});case 2:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function U(e){var t=e.data();if(t){var n=t;return n.id=e.id,n}}function N(e){var t=Object.assign({},e);return delete t.id,t}function G(e){return d.b.collection(Object(l.collectionPath)(e))}function J(e,t,n){return W.apply(this,arguments)}function W(){return(W=Object(a.a)(Object(c.a)().mark((function e(t,n,r){var o,a;return Object(c.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=G(t).limit(void 0===r?b:2),void 0!==n&&(o=o.where("parentId","==",n)),Object(l.isOrdered)(t)&&(o=o.orderBy("order","asc"),r&&(o=o.startAfter(r))),e.next=5,o.get();case 5:return a=e.sent,e.abrupt("return",a.docs.map((function(e){return U(e)})));case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function K(e,t){return V.apply(this,arguments)}function V(){return(V=Object(a.a)(Object(c.a)().mark((function e(t,n){var r,o;return Object(c.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=[];case 1:if(!n){e.next=8;break}return e.next=4,x(t,n);case 4:(o=e.sent)?(r.push(o),n=o.parentId):n="",e.next=1;break;case 8:return e.abrupt("return",r);case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function $(e,t){return H.apply(this,arguments)}function H(){return(H=Object(a.a)(Object(c.a)().mark((function e(t,n){var r,o;return Object(c.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=G(t).orderBy("order","desc").limit(1),void 0!==n&&(r=r.where("parentId","==",n)),e.next=4,r.get();case 4:return o=e.sent,e.abrupt("return",o.empty?0:o.docs[0].data().order);case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Y(e){return Z.apply(this,arguments)}function Z(){return(Z=Object(a.a)(Object(c.a)().mark((function e(t){var n;return Object(c.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,J([t,"lists"],void 0);case 2:return n=e.sent,e.abrupt("return",0===n.length?void 0:n[0].id);case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function X(e){for(var t=0,n=Object.entries(e);t<n.length;t++){var r=Object(o.a)(n[t],2),c=r[0];void 0===r[1]&&delete e[c]}}function ee(e,t){return te.apply(this,arguments)}function te(){return(te=Object(a.a)(Object(c.a)().mark((function e(t,n){var r,o;return Object(c.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=600,"mImages"!==(o=Object(l.collectionFromPath)(t))&&"mQuizzes"!==o&&"mQuotes"!==o){e.next=8;break}return e.next=5,Object(p.a)(n.image,r);case 5:n.image=e.sent,e.next=12;break;case 8:if("pages"!==o||"string"!==typeof n.visual){e.next=12;break}return e.next=11,Object(p.a)(n.visual,r);case 11:n.visual=e.sent;case 12:case"end":return e.stop()}}),e)})))).apply(this,arguments)}}).call(this,n(186))},1377:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.topPageIds=void 0,t.topPageIds={sidebar:"sidebar",parts:"parts"}},1381:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.books=void 0;t.books={title:"Book",type:"object",properties:{title:{type:"string",default:"Book title"},subtitle:{type:"string",default:"Subtitle"},language:{type:"string",enum:["en","vi"],default:"en"},shareUrl:{type:"string",default:"https://toxgam.github.io/"},supportUrl:{type:"string",default:"https://facebook.com/"}},required:["title","language","shareUrl","supportUrl"]}},1382:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.lists=void 0,t.lists={title:"List",description:"List of groups of text",type:"object",properties:{title:{type:"string",default:"List title"},groups:{type:"array",items:{title:"Group",type:"object",properties:{name:{type:"string",default:"Group name"},items:{type:"array",items:{type:"string",default:"Item name"},uniqueItems:!0}},required:["name","items"]},uniqueItems:!0,default:[{name:"Group 1",items:["Item1","Item2"]},{name:"Group 2",items:["Item3","Item4"]}]}},required:["title","groups"]}},1383:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.pages=void 0;var r=n(906),o=n(335);t.pages={title:"Page",description:"Pages can be structured into a tree",type:"object",properties:{title:{type:"string",default:"Page title"},visual:{oneOf:[{title:"Icon",type:"object",properties:{iconSet:{type:"string",enum:r.iconSets,default:"Ionicons"},icon:{type:"string",default:"paper-plane-outline"}},required:["iconSet","icon"]},{title:"Image",type:"string",format:"data-url",default:o.defaultImage}],default:{iconSet:"Ionicons",icon:"paper-plane-outline"}}},required:["title"]}},1384:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.mAccordions=void 0,t.mAccordions={title:"Accordion",description:"Macro that shows child pages in an accordion",type:"object",properties:{}}},1385:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.mAudios=void 0,t.mAudios={title:"Audio",description:"Macro that shows an audio player",type:"object",properties:{title:{type:"string",default:"Title"},artist:{type:"string",default:"Artist"},url:{type:"string",default:"URL or resource ID"},start:{description:"Start time [ms]",type:"integer",default:0},end:{description:"End time [ms]",type:"integer",default:-1}},required:["title","url","start","end"]}},1386:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.mExpands=void 0,t.mExpands={title:"Expand",description:"Macro that shows a single content in the accordion style",type:"object",properties:{title:{type:"string",default:"Title"},body:{type:"string",default:"Body",$comment:"Markdown"}},required:["title","body"]}},1387:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.mImages=void 0;var r=n(335);t.mImages={title:"Image",description:"Macro that shows an image",type:"object",properties:{image:{type:"string",format:"data-url",default:r.defaultImage},caption:{type:"string",default:"Image caption"}},required:["image"]}},1388:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.mIncludePages=void 0;var r=n(335);t.mIncludePages={title:"Include page",description:"Macro that includes the content of another page",type:"object",properties:{pageId:{type:"string",default:"ID of the page to include"},type:{type:"string",enum:r.includePageTypes,default:"expand"}},required:["pageId","type"]}},1389:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.mInputs=void 0,t.mInputs={title:"Input",description:"Macro that records user text input",type:"object",properties:{multiline:{type:"boolean",default:!1}},required:["multiline"]}},1390:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.mListSelects=void 0,t.mListSelects={title:"List select",description:"Macro that lets user select from a text list",type:"object",properties:{listId:{title:"List ID",type:"string",default:"ID of list to select"}},required:["listId"]}},1391:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.mListShows=void 0,t.mListShows={title:"List show",description:"Macro that shows a text list",type:"object",properties:{listId:{title:"List ID",type:"string",default:"ID of list to show"}},required:["listId"]}},1392:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.mMarkdowns=void 0,t.mMarkdowns={title:"Markdown",description:"Macro that shows text in Markdown format",type:"object",properties:{text:{type:"string",default:"Markdown text",$comment:"Markdown"}},required:["text"]}},1393:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.mPanels=void 0;var r=n(335);t.mPanels={title:"Panel",description:"Macro that shows a panel to highlight a content",type:"object",properties:{type:{type:"string",enum:r.panelTypes,default:"info"},body:{type:"string",default:"Markdown text",$comment:"Markdown"}},required:["type","body"]}},1394:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.mQuotes=void 0;var r=n(335);t.mQuotes={title:"Quote",description:"Macro that shows a quote",type:"object",properties:{quote:{type:"string",default:"Quote text",$comment:"Markdown"},author:{type:"string",default:"Author of the quote"},image:{type:"string",format:"data-url",default:r.defaultImage}},required:["quote","author"]}},1395:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.mSurveys=void 0,t.mSurveys={title:"Survey",description:"Macro that shows a survey question",type:"object",properties:{question:{type:"string",default:"Survey question?",$comment:"Markdown"},choices:{type:"array",items:{type:"string",default:"Choice"},uniqueItems:!0,default:["Choice 1","Choice 2"]},multiple:{type:"boolean",default:!1}},required:["question","choices","multiple"]}},1396:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.mTocs=void 0;var r=n(335);t.mTocs={title:"Toc",description:"Macro that shows table of contents of child pages",type:"object",properties:{type:{type:"string",enum:r.tocTypes,default:"pages"}},required:["type"]}},1397:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.mYouTubes=void 0,t.mYouTubes={title:"YouTube",description:"Macro that shows a YouTube video",type:"object",properties:{videoId:{type:"string",default:"pVBev5-2Ujk"}},required:["videoId"]}},1398:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.mRearrangeQuizzes=void 0,t.mRearrangeQuizzes={title:"Rearrange quiz",description:"Macro that asks user to rearrange a list of items",type:"object",properties:{question:{type:"string",default:"Quiz question?",$comment:"Markdown"},items:{type:"array",items:{title:"Item",type:"string"},default:[]},explanation:{description:"Explanation about the answer",type:"string",default:"Markdown text",$comment:"Markdown"}},required:["question","items"]}},1399:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.mInputQuizzes=void 0,t.mInputQuizzes={title:"Input quiz",description:"Macro that asks user to input",type:"object",properties:{question:{type:"string",default:"Quiz question?",$comment:"Markdown"},validInputs:{type:"array",items:{title:"Valid input",type:"string"},default:[]},explanation:{description:"Explanation about the answer",type:"string",default:"Markdown text",$comment:"Markdown"}},required:["question","validInputs"]}},1400:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.mQuizGroups=void 0;var r=n(908);t.mQuizGroups={title:"Quiz group",description:"Macro that shows a group of quizzes",type:"object",properties:{question:{type:"string",default:"Question for the group of quizzes?",$comment:"Markdown"},quizzes:{type:"array",items:r.mQuizzes,default:[]}},required:["question","quizzes"]}},1401:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.mQuizTests=void 0,t.mQuizTests={title:"Quiz test",description:"Macro that shows a test containing multiple quizzes",type:"object",properties:{title:{type:"string",default:"Title"},instruction:{type:"string",default:"Instruction for the test.",$comment:"Markdown"},min:{description:"Minimum number of quizzes to create",type:"integer",default:5},max:{description:"Maximum number of quizzes to create",type:"integer",default:50},sources:{type:"array",items:{title:"Quiz source",type:"object",properties:{pageId:{description:"Page containing quizzes",type:"string",default:"pageId"},min:{description:"Minimum number of quizzes to take from this source, when there are multiple sources",type:"integer",default:5},max:{description:"Maximum number of quizzes to take from this source, when there are multiple sources",type:"integer",default:50}},required:["pageId","min","max"]},uniqueItems:!0,default:[{pageId:"pageId",min:5,max:50}]}},required:["title","min","max","sources"]}},1402:function(e,t,n){"use strict";var r=n(694).default;Object.defineProperty(t,"__esModule",{value:!0}),t.newDocTemplates=void 0;var o=n(692),c=n(907);t.newDocTemplates={},o.collections.forEach((function(e){var n=c.shortJsonSchemas[e].properties;t.newDocTemplates[e]={};for(var o=0,a=Object.entries(n);o<a.length;o++){var i=r(a[o],2),s=i[0],u=i[1];t.newDocTemplates[e][s]=u.default}}))},2070:function(e,t,n){"use strict";n.r(t);var r=n(3),o=n(122),c=n.n(o),a=n(228),i=n(2336),s=n(172),u=n(164),l=n(2267),d=n(2265),p=n(831),f=n(2346),b=n(131),j=n(119),h=n(61),m=n(98),v=n(55),O=n(667),y=n(2280),g=n(104),x=n(2350),k=n(25),w=Object(s.b)({key:"snackbarState",default:{severity:"info",msg:""}});function I(){var e=Object(s.c)(w),t=Object(v.a)(e,2),n=t[0],r=n.severity,o=n.msg,c=t[1];return Object(k.jsx)(x.a,{open:o.length>0,autoHideDuration:3e3,onClose:function(){return c({severity:r,msg:""})},children:Object(k.jsx)(f.a,{severity:r,children:o})})}function A(){return function(e,t){console.log("[".concat(e,"] ").concat(t)),alert("[".concat(e,"] ").concat(t))}}var C=n(617),P=n(2275),M=n(2276),S=n(2277),z=n(2278),T=n(2279),_=Object(s.b)({key:"confirmDlgState",default:{open:!1,msg:"",onConfirm:function(){}}});function q(){var e=Object(s.c)(_),t=Object(v.a)(e,2),n=t[0],r=n.open,o=n.msg,c=n.onConfirm,a=t[1],i=function(){a({open:!1,msg:"",onConfirm:function(){}})};return Object(k.jsxs)(P.a,{open:r,onClose:i,children:[Object(k.jsx)(M.a,{children:"Confirm"}),Object(k.jsx)(S.a,{children:Object(k.jsx)(z.a,{children:o})}),Object(k.jsxs)(T.a,{children:[Object(k.jsx)(d.a,{onClick:function(){c(),i()},color:"secondary",children:"OK"}),Object(k.jsx)(d.a,{onClick:i,color:"primary",autoFocus:!0,children:"Cancel"})]})]})}var D=n(80),Q=n(72),E=n(139),F=n(140);function L(e,t){var n=document.createElement("a");n.setAttribute("href",t),n.setAttribute("download",e),n.style.display="none",document.body.appendChild(n),n.click(),document.body.removeChild(n)}function B(e,t){return e.replace(";base64",";name=".concat(encodeURIComponent(t),";base64"))}function R(e){var t=e.name,n=e.size,r=e.type;return new Promise((function(o,c){var a=new window.FileReader;a.onerror=c,a.onload=function(e){o({dataURL:B(e.target.result,t),name:t,size:n,type:r})},a.readAsDataURL(e)}))}function U(e){var t=e.filesInfo;return 0===t.length?null:Object(k.jsx)("ul",{className:"file-info",children:t.map((function(e,t){var n=e.name,r=e.size,o=e.type;return Object(k.jsxs)("li",{children:[Object(k.jsx)("strong",{children:n})," (",o,", ",r," bytes)",Object(k.jsx)("br",{}),Object(k.jsx)("button",{onClick:function(){return L(e.name,e.dataURL)},children:"Download"})]},t)}))})}function N(e){return e.filter((function(e){return"undefined"!==typeof e})).map((function(e){var t=function(e){var t,n=e.split(","),r=n[0].split(";"),o=r[0].replace("data:",""),c=r.filter((function(e){return"name"===e.split("=")[0]}));t=1!==c.length?"unknown":c[0].split("=")[1];for(var a=atob(n[1]),i=[],s=0;s<a.length;s++)i.push(a.charCodeAt(s));return{blob:new window.Blob([new Uint8Array(i)],{type:o}),name:t}}(e),n=t.blob;return{name:t.name,size:n.size,type:n.type,dataURL:e}}))}var G=function(e){Object(E.a)(n,e);var t=Object(F.a)(n);function n(e){var r;Object(D.a)(this,n),(r=t.call(this,e)).onChange=function(e){var t,n=r.props,o=n.multiple,c=n.onChange;(t=e.target.files,Promise.all([].map.call(t,R))).then((function(e){var t={values:e.map((function(e){return e.dataURL})),filesInfo:e};r.setState(t,(function(){c(o?t.values:t.values[0])}))}))};var o=e.value,c=Array.isArray(o)?o:[o];return r.state={values:c,filesInfo:N(c)},r}return Object(Q.a)(n,[{key:"shouldComponentUpdate",value:function(e,t){return function(e,t,n){var r=e.props,o=e.state;return!W(r,t)||!W(o,n)}(this,e,t)}},{key:"render",value:function(){var e=this,t=this.props,n=t.multiple,r=t.id,o=t.readonly,c=t.disabled,a=t.autofocus,i=t.options,s=this.state.filesInfo;return Object(k.jsxs)("div",{children:[Object(k.jsx)("p",{children:Object(k.jsx)("input",{ref:function(t){return e.inputRef=t},id:r,type:"file",disabled:o||c,onChange:this.onChange,defaultValue:"",autoFocus:a,multiple:n,accept:i.accept})}),Object(k.jsx)(U,{filesInfo:s})]})}}]),n}(r.Component);G.defaultProps={autofocus:!1};var J=G;function W(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[];if(e===t)return!0;if("function"===typeof e||"function"===typeof t)return!0;if("object"!==typeof e||"object"!==typeof t)return!1;if(null===e||null===t)return!1;if(e instanceof Date&&t instanceof Date)return e.getTime()===t.getTime();if(e instanceof RegExp&&t instanceof RegExp)return e.source===t.source&&e.global===t.global&&e.multiline===t.multiline&&e.lastIndex===t.lastIndex&&e.ignoreCase===t.ignoreCase;if(K(e)||K(t)){if(!K(e)||!K(t))return!1;var o=Array.prototype.slice;return W(o.call(e),o.call(t),n,r)}if(e.constructor!==t.constructor)return!1;var c=Object.keys(e),a=Object.keys(t);if(0===c.length&&0===a.length)return!0;if(c.length!==a.length)return!1;for(var i,s=n.length;s--;)if(n[s]===e)return r[s]===t;n.push(e),r.push(t),c.sort(),a.sort();for(var u=c.length-1;u>=0;u--)if(c[u]!==a[u])return!1;for(var l=c.length-1;l>=0;l--)if(!W(e[i=c[l]],t[i],n,r))return!1;return n.pop(),r.pop(),!0}function K(e){return"[object Arguments]"===Object.prototype.toString.call(e)}var V=n(2078),$=n(2281),H=Object(s.b)({key:"longRunningTaskState",default:{open:!1,msg:""}});function Y(){var e=Object(s.c)(H),t=Object(v.a)(e,2)[1],n=function(){var e=Object(m.a)(Object(h.a)().mark((function e(n,r){var o;return Object(h.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t({open:!0,msg:n}),e.prev=1,e.next=4,r();case 4:t({open:!1,msg:""}),e.next=13;break;case 7:e.prev=7,e.t0=e.catch(1),o="Error running task: ".concat(n),console.error(o,e.t0),t({open:!0,msg:o}),setTimeout((function(){return t({open:!1,msg:""})}),3e3);case 13:case"end":return e.stop()}}),e,null,[[1,7]])})));return function(t,n){return e.apply(this,arguments)}}();return n}var Z=Object(y.a)((function(e){return{backdrop:{zIndex:e.zIndex.drawer+1,color:"#fff"},msg:{margin:"1em"}}}));function X(){var e=Object(s.c)(H),t=Object(v.a)(e,1)[0],n=t.open,r=t.msg,o=Z();return Object(k.jsxs)(V.a,{className:o.backdrop,open:n,children:[Object(k.jsx)($.a,{color:"inherit"}),Object(k.jsx)(p.a,{className:o.msg,children:r})]})}var ee=n(1274),te=Object(y.a)((function(e){return{paper:{marginBottom:e.spacing(2),padding:e.spacing(2)}}}));function ne(e){var t=e.children,n=te();return Object(k.jsx)(ee.a,{className:n.paper,children:t})}var re=Object(y.a)((function(){return{buttons:{display:"flex",justifyContent:"space-between"}}}));function oe(e){var t=e.bookId,n=e.collection,o=e.doc,c=e.onDelete,a=e.onCancel,i=re(),l=Y(),p=A(),f=function(){var e=Object(s.c)(_),t=Object(v.a)(e,2)[1];return function(e,n){t({open:!0,msg:e,onConfirm:n})}}(),j=Object(u.g)(),y=Object(r.useState)(o),x=Object(v.a)(y,2),w=x[0],I=x[1],P=Object(r.useState)(ce(w)),M=Object(v.a)(P,2),S=M[0],z=M[1],T="books"===n?n:[t,n],q=Object(b.l)(T,o.id),D=function(){var e=Object(m.a)(Object(h.a)().mark((function e(){var t;return Object(h.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(c&&c(),"string"!==typeof T){e.next=3;break}return e.abrupt("return");case 3:if("pages"!==(t=T)[1]){e.next=9;break}l("Deleting page...",Object(m.a)(Object(h.a)().mark((function e(){return Object(h.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(b.e)(t,o.id);case 2:p("info","Successfully deleted the page");case 3:case"end":return e.stop()}}),e)})))),e.next=19;break;case 9:return e.prev=9,e.next=12,Object(b.e)(t,o.id);case 12:p("info","Successfully deleted"),e.next=19;break;case 15:e.prev=15,e.t0=e.catch(9),console.error("Successfully deleted document of ".concat(n,": ").concat(o.id)),p("error","Could not delete");case 19:case"end":return e.stop()}}),e,null,[[9,15]])})));return function(){return e.apply(this,arguments)}}();return Object(k.jsx)(ne,{children:Object(k.jsx)(O.a,{autoComplete:"off",schema:g.jsonSchemas[n],uiSchema:C.b[n],widgets:{FileWidget:J},formData:w,onSubmit:function(e){var t=e.formData;return q(t).then((function(){I(t),z(ce(t)),p("info","Successfully updated")}),(function(e){p("error","Could not update"),console.error(e)}))},children:Object(k.jsxs)("div",{className:i.buttons,children:[a&&Object(k.jsx)(d.a,{onClick:a,children:"Cancel"}),Object(k.jsx)(d.a,{type:"submit",color:"primary",children:"Update"}),"books"===n&&Object(k.jsx)(d.a,{color:"primary",onClick:function(){return j.push("/books/".concat(t))},children:"Edit content"}),"books"!==n&&Object(k.jsx)(d.a,{color:"secondary",onClick:function(){g.macroTypes.includes(n)?D():f("Do you want to delete this document of ".concat(n,"?"),D)},children:"Delete"})]})},S)})}function ce(e){var t=ae(e);return"".concat(e.id,"-").concat(t.join("-"))}function ae(e){for(var t=[],n=0,r=Object.keys(e);n<r.length;n++){var o=r[n];t.push(o);var c=e[o];"object"!==typeof c||Array.isArray(c)||t.push.apply(t,Object(j.a)(ae(c)))}return t}var ie=n(2285),se=n(2286),ue=n(2273),le=n(2355),de=n(1181),pe=n.n(de),fe=n(198),be=n(2284),je=n(238);function he(){var e=Object(je.b)(),t=Object(je.g)().data,n=A(),r=Object(u.g)();return Object(k.jsx)("div",{children:Object(k.jsxs)(p.a,{children:[Object(k.jsx)(d.a,{color:"primary",onClick:function(){e.signOut().then((function(){return r.push("/")}),(function(e){n("error","Could not logout"),console.error(e)}))},children:"Logout"}),t.email]})})}var me=n(515),ve=n.n(me),Oe=n(329);function ye(){return(ye=Object(m.a)(Object(h.a)().mark((function e(t){var n,r;return Object(h.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(b.f)(t);case 2:return n=e.sent,r=ve()(n,{space:2}),e.next=6,xe("backup/"+we(t,{timestamped:!0}),r);case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function ge(){return(ge=Object(m.a)(Object(h.a)().mark((function e(t){var n,r;return Object(h.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(b.f)(t);case 2:return n=e.sent,r=ve()(n,{space:2}),e.next=6,xe("backup/"+we(t,{timestamped:!0,tag:"publish"}),r);case 6:return e.next=8,xe("publish/"+we(t),r);case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function xe(e,t){return ke.apply(this,arguments)}function ke(){return(ke=Object(m.a)(Object(h.a)().mark((function e(t,n){var r;return Object(h.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=Oe.c.ref(t),e.next=3,r.putString(n,void 0,{contentType:"text/json"}).then();case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function we(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.timestamped,r=t.tag,o=n?"-"+Ie():"",c=r?"-"+r:"";return"".concat(e,"/happy-").concat(e).concat(o).concat(c,".json")}function Ie(){return(new Date).toISOString()}function Ae(){var e=Object(u.h)().bookId,t=Object(u.g)(),n=Object(b.j)("books",e),o=A();Object(r.useEffect)((function(){n||(console.error("Book not found: ".concat(e)),t.replace("/"))}));return n?Object(k.jsxs)(k.Fragment,{children:[Object(k.jsxs)("div",{children:[Object(k.jsx)(d.a,{color:"primary",onClick:function(){Object(b.f)(e).then((function(t){!function(e,t){var n=ve()(t,{space:2});L(e,"data:application/json;charset=utf-8,"+encodeURIComponent(n))}("happy-".concat(e,".json"),t)}),(function(e){o("error","Could not download"),console.error(e)}))},children:"Download"}),Object(k.jsx)(d.a,{color:"primary",onClick:function(){(function(e){return ye.apply(this,arguments)})(e).then((function(){o("info","Created backup")}),(function(e){o("error","Could not backup"),console.error(e)}))},children:"Backup"}),Object(k.jsx)(d.a,{color:"primary",onClick:function(){(function(e){return ge.apply(this,arguments)})(e).then((function(){o("info","Created backup and published")}),(function(e){o("error","Could not publish"),console.error(e)}))},children:"Publish"})]}),Object(k.jsx)(d.a,{color:"primary",onClick:function(){return t.push("/")},children:"View book list"})]}):Object(k.jsx)(k.Fragment,{})}var Ce=n(2282);function Pe(){var e=Object(u.h)().bookId,t=Object(u.g)(),n="#/books/".concat(e,"/question-playground");return Object(k.jsxs)(k.Fragment,{children:[Object(k.jsx)(f.a,{severity:"info",children:Object(k.jsx)(Ce.a,{href:n,onClick:function(){return t.push(n)},children:"Question generation playground"})}),Object(k.jsx)(f.a,{severity:"info",children:Object(k.jsx)(Ce.a,{href:"https://oblador.github.io/react-native-vector-icons/",target:"_blank",children:"Icons"})}),Object(k.jsx)(f.a,{severity:"info",children:Object(k.jsx)(Ce.a,{href:"https://translate.google.com/?hl=vi&sl=en&tl=vi&op=translate",target:"_blank",children:"Google Translate"})})]})}var Me=n(99),Se=n(2283),ze=n(2356),Te=n(820),_e=n.n(Te),qe=n(1180),De=n.n(qe),Qe=n(1179),Ee=n.n(Qe);function Fe(){return(Fe=Object(m.a)(Object(h.a)().mark((function e(t){var n,r,o,c;return Object(h.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=Object.keys(g.topPageIds),r=0;case 2:if(!(r<n.length)){e.next=10;break}return o=n[r],c={parentId:t,order:r+1,id:o,title:o},e.next=7,Object(b.b)([t,"pages"],o,c);case 7:r++,e.next=2;break;case 10:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Le(e){var t=e.msg;return Object(k.jsx)(p.a,{color:"error",children:t})}var Be=function(e){Object(E.a)(n,e);var t=Object(F.a)(n);function n(e){var r;return Object(D.a)(this,n),(r=t.call(this,e)).state={hasError:!1},r}return Object(Q.a)(n,[{key:"render",value:function(){return this.state.hasError?Object(k.jsx)(Le,{msg:this.props.errorMsg}):this.props.children}}],[{key:"getDerivedStateFromError",value:function(e){return console.error(e),{hasError:!0}}}]),n}(r.Component);function Re(e){return Object(k.jsx)(Be,{errorMsg:e.errorMsg,children:Object(k.jsx)(r.Suspense,{fallback:Object(k.jsx)($.a,{}),children:e.children})})}var Ue=n(65),Ne=Object(s.b)({key:"docTreeState",default:{expandedNodeIds:["pages"],selectedNodeId:"pages"}});function Ge(e,t,n){return"/books/".concat(e,"/").concat(t,"/").concat(n)}var Je=Ge;function We(){return Object(s.c)(Ne)}function Ke(){var e=Object(u.h)().bookId,t=Object(b.j)("books",e),n=We(),r=Object(v.a)(n,2),o=r[0],c=o.expandedNodeIds,a=o.selectedNodeId,i=r[1];return Object(k.jsxs)(ne,{children:[Object(k.jsx)(p.a,{variant:"h5",children:null===t||void 0===t?void 0:t.title}),Object(k.jsx)(p.a,{variant:"h6",children:null===t||void 0===t?void 0:t.subtitle}),Object(k.jsxs)(Se.a,{defaultCollapseIcon:Object(k.jsx)(Ee.a,{}),defaultExpandIcon:Object(k.jsx)(De.a,{}),expanded:c,selected:a,onNodeToggle:function(e,t){return i({expandedNodeIds:t,selectedNodeId:a})},children:[Object(k.jsx)(Ve,{bookId:e}),Object(k.jsx)($e,{bookId:e})]})]})}function Ve(e){var t=e.bookId;return Object(k.jsx)(ze.a,{nodeId:"lists",label:"Text lists",children:Object(k.jsx)(He,{bookId:t,collection:"lists",recursive:!1,level:0,parentId:t,labelMaker:function(e){return e.title}})})}function $e(e){var t=e.bookId;return Object(r.useEffect)((function(){Object(b.g)("books",t).then((function(e){e&&function(e){Fe.apply(this,arguments)}(t)}))}),[t]),Object(k.jsx)(ze.a,{nodeId:"pages",label:"Pages",children:Object(k.jsx)(He,{bookId:t,collection:"pages",recursive:!0,level:0,parentId:t,labelMaker:function(e){return e.title}})})}function He(e){return Object(k.jsx)(Re,{errorMsg:"Error loading ".concat(e.collection),children:Object(k.jsx)(Ye,Object(Me.a)({},e))})}function Ye(e){var t=e.bookId,n=e.collection,r=e.recursive,o=e.level,c=e.parentId,a=e.grandParentId,i=e.labelMaker,s=Object(u.g)(),l=We(),d=Object(v.a)(l,1)[0].selectedNodeId,p=Object(b.m)([t,n],c),f=A(),j=function(e){Object(b.c)([t,n],e).then((function(e){s.push(Ge(t,n,e))}),(function(e){console.error(e),f("error","Could not add new document to ".concat(n))}))};return Object(k.jsxs)(k.Fragment,{children:[p.map((function(e){var a=e.id,u=Je(t,n,a),l=Ge(t,n,a);return Object(k.jsx)(ze.a,{nodeId:u,label:i(e),onLabelClick:function(e){e.preventDefault(),s.push(l)},children:r&&Object(k.jsx)(He,{bookId:t,collection:n,recursive:!0,level:o+1,parentId:a,grandParentId:c,labelMaker:i})},u)})),(c===t&&"pages"!==n||Je(t,n,c)===d)&&Object(k.jsxs)(k.Fragment,{children:[o<=3&&Object(k.jsx)(ze.a,{nodeId:"add-doc-to-".concat(t,"-").concat(n,"-").concat(c),icon:Object(k.jsx)(_e.a,{}),label:"Add child",onClick:function(){return j(c)}}),a&&Object(k.jsx)(ze.a,{nodeId:"add-doc-to-".concat(t,"-").concat(n,"-").concat(a),icon:Object(k.jsx)(_e.a,{}),label:"Add sibling",onClick:function(){return j(a)}})]})]})}function Ze(){return Object(k.jsxs)(k.Fragment,{children:[Object(k.jsx)(u.b,{path:"/books/:bookId",children:Object(k.jsx)(Ke,{})}),Object(k.jsxs)(ne,{children:[Object(k.jsxs)(u.b,{path:"/books/:bookId",children:[Object(k.jsx)(Pe,{}),Object(k.jsx)(Ae,{})]}),Object(k.jsx)(he,{})]})]})}function Xe(){var e=Object(fe.a)();return Object(be.a)(e.breakpoints.up("md"))}function et(e){var t=e.title,n=Xe(),o=Object(r.useState)(!1),c=Object(v.a)(o,2),a=c[0],i=c[1];return Object(k.jsx)(ie.a,{position:"static",children:Object(k.jsxs)(se.a,{children:[!n&&Object(k.jsxs)(k.Fragment,{children:[Object(k.jsx)(ue.a,{color:"inherit",edge:"start",onClick:function(){return i(!0)},children:Object(k.jsx)(pe.a,{})}),Object(k.jsx)(le.a,{anchor:"left",open:a,onClose:function(){return i(!1)},children:Object(k.jsx)(Ze,{})})]}),Object(k.jsx)(p.a,{children:t})]})})}function tt(e){return Object(k.jsxs)(k.Fragment,{children:[Object(k.jsx)(et,{title:e.title}),Object(k.jsx)("div",{style:{marginTop:"1em"},children:Object(k.jsx)(Re,{errorMsg:"There's error, please try reloading this web page.",children:e.children})})]})}var nt=Object(k.jsx)(u.b,{path:"/",exact:!0,children:Object(k.jsx)(tt,{title:"Books",children:Object(k.jsx)(rt,{})})});function rt(){var e=Object(b.m)("books",void 0);return e.sort((function(e,t){return e.title<t.title?-1:1})),Object(k.jsxs)(k.Fragment,{children:[e.map((function(e){return Object(k.jsx)(oe,{bookId:e.id,collection:"books",doc:e,onDelete:function(){}},e.id)})),Object(k.jsx)(d.a,{color:"primary",onClick:function(){return Object(b.c)("books",void 0)},children:"Add book"}),Object(k.jsx)(f.a,{severity:"info",children:Object(k.jsx)(p.a,{children:"Deleting books from this admin UI is not effecient for the system. If you want to delete a book, please contact a DB admin."})})]})}var ot=Object(k.jsx)(u.b,{path:"/books/:bookId",exact:!0,children:Object(k.jsx)(tt,{title:"Edit book",children:Object(k.jsx)(ct,{})})});function ct(){return Object(k.jsx)(p.a,{children:"Please start from the sidebar."})}var at=n(1269),it=n(1266),st=(n(2063),n(2064),{status:"pending",promise:null,result:null});function ut(e,t){if("fulfilled"===e.status)return e.result;if("rejected"===e.status)throw e.result;throw e.promise||(e.promise=t().then((function(t){"pending"===e.status&&(e.status="fulfilled",e.promise=null,e.result=t)}),(function(t){"pending"===e.status&&(e.status="rejected",e.promise=null,e.result=t)}))),e.promise}var lt=function(e){var t={status:"pending",promise:null,result:null};return function(o){var c=ut(st,(function(){return n.e(183).then(n.bind(null,3222))})).default,a=ut(t,e).default,i=Object(r.useRef)(null),s=Object(r.useRef)(null);return Object(r.useLayoutEffect)((function(){s.current||(s.current=c(i.current));var e=s.current;return function(){e.unmount()}}),[c]),Object(r.useLayoutEffect)((function(){s.current&&s.current.render(a,o)}),[a,o]),Object(k.jsx)("div",{style:{display:"contents"},ref:i})}}((function(){return Promise.resolve().then(n.bind(null,1266))}));function dt(e){var t=e.bookId,n=e.pageId,r=Object(b.n)(t,n),o=A();return Object(k.jsx)(Re,{errorMsg:"Could not render macros",children:Object(k.jsx)(lt,{pageId:n,before:r,onSave:function(e){var n=e.after,c=e.create,a=e.update,i=e.remove,s=Promise.all(c.map((function(e){var r=n[e],o=[t,r.macroType];return Object(b.a)(o,r.doc).then((function(e){return r.doc.id=e}))}))),u=Promise.all(a.map((function(e){var r=n[e],o=[t,r.macroType];return Object(b.h)(o,r.doc.id,r.doc)}))),l=Promise.all(i.map((function(e){var n=r[e],o=[t,n.macroType];return Object(b.e)(o,n.doc.id)})));return Promise.all([s,u,l]).then((function(){return o("info","Successfully updated"),n}),(function(e){return o("error","Could not update"),console.error(e),n}))}},"".concat(t,"-").concat(n))})}var pt=Object(s.b)({key:"srcPageState",default:{srcBookId:"",srcPage:void 0}});function ft(e){var t=e.bookId,n=e.currentPageAndAncestors,r=Object(s.c)(pt),o=Object(v.a)(r,2),c=o[0],a=c.srcBookId,i=c.srcPage,u=o[1],l=Y(),p=A(),f=n[0],j=Object.keys(g.topPageIds).includes(f.id),O=Object(k.jsx)(d.a,{color:"secondary",onClick:function(){u({srcBookId:t,srcPage:f}),p("info","Select a page at the page tree to copy/move to")},children:"Copy/move this page"});if(!i)return j?null:O;if(i&&i.id===f.id)return null;if(function(e,t,n,r){if(e!==n)return!1;var o,c=Object(Ue.a)(r);try{for(c.s();!(o=c.n()).done;){if(o.value.id===t.id)return!0}}catch(a){c.e(a)}finally{c.f()}return!1}(a,i,t,n))return O;if(function(e,t,n,r){if(e!==n)return!1;return t.parentId===r.id}(a,i,t,f))return O;var y=Object(k.jsx)(d.a,{color:"secondary",onClick:Object(m.a)(Object(h.a)().mark((function e(){return Object(h.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:u({srcBookId:"",srcPage:void 0}),l("Copying page...",Object(m.a)(Object(h.a)().mark((function e(){return Object(h.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(b.d)({bookIdAndDataCollection:[a,"pages"],id:i.id},{bookIdAndDataCollection:[t,"pages"],parentId:f.id});case 2:p("info","Page copy finished");case 3:case"end":return e.stop()}}),e)}))));case 2:case"end":return e.stop()}}),e)}))),children:"Copy it here"}),x=Object(k.jsx)(d.a,{color:"secondary",onClick:Object(m.a)(Object(h.a)().mark((function e(){return Object(h.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return u({srcBookId:"",srcPage:void 0}),e.next=3,Object(b.i)([t,"pages"],i.id,f.id);case 3:p("info","Page move finished");case 4:case"end":return e.stop()}}),e)}))),children:"Move it here"}),w=Object(k.jsx)(Ce.a,{href:"/#/books/".concat(t,"/pages/").concat(i.id),target:"_blank",children:"Page to move"});return Object(k.jsxs)(k.Fragment,{children:[w,y,a===t&&x,O]})}var bt=[["lists","Edit text list"],["pages","Edit page"]].map((function(e){var t=Object(v.a)(e,2),n=t[0],r=t[1];return Object(k.jsx)(u.b,{path:"/books/:bookId/".concat(n,"/:bookDataId"),exact:!0,children:Object(k.jsx)(tt,{title:r,children:Object(k.jsx)(jt,{collection:n})})},n)}));function jt(e){var t=e.collection,n=Object(u.h)(),o=n.bookId,c=n.bookDataId,a=Object(b.k)([o,t],c),i=function(){var e=Object(s.c)(Ne),t=Object(v.a)(e,2),n=t[0].expandedNodeIds,o=t[1];return Object(r.useCallback)((function(e,t,r,c){var a,i=Je(e,t,r),s=Object(j.a)(n),u=Object(Ue.a)(c);try{for(u.s();!(a=u.n()).done;){var l=a.value,d=Je(e,t,l);s.includes(d)||s.push(d)}}catch(f){u.e(f)}finally{u.f()}var p=s.length!==n.length;o({expandedNodeIds:p?s:n,selectedNodeId:i})}),[n,o])}(),l=Object(u.g)(),p=Object(r.useState)(!1),f=Object(v.a)(p,2),h=f[0],m=f[1],O=a.map((function(e){return e.id}));if(Object(at.a)((function(){return i(o,t,c,O)}),[i,o,t,c,O]),0===a.length)return Object(k.jsx)(Le,{msg:"Could not load data to edit"});var y=g.shortJsonSchemas[t],x=Object.keys(y.properties),w=a[0],I="".concat(o,"/").concat(t,"/").concat(c);return Object(k.jsxs)(k.Fragment,{children:["pages"===t&&Object(k.jsx)(ft,{bookId:o,currentPageAndAncestors:a}),h?Object(k.jsx)(oe,{bookId:o,collection:t,doc:w,onDelete:function(){return l.push("/books/".concat(o))},onCancel:function(){return m(!1)}},I):Object(k.jsxs)(ee.a,{style:{padding:"1em",marginBottom:"1em"},children:[Object(k.jsx)(it.DocShow,{doc:w,sortKeys:x}),Object(k.jsx)(d.a,{color:"primary",onClick:function(){return m(!0)},children:"Edit"})]}),"pages"===t&&Object(k.jsx)(Re,{errorMsg:"Could not load macros",children:Object(k.jsx)(dt,{bookId:o,pageId:c},I)})]})}var ht=n(2342),mt=n(1264),vt=n.n(mt),Ot=Object(k.jsx)(u.b,{path:"/books/:bookId/question-playground",children:Object(k.jsx)(tt,{title:"Question generation playground",children:Object(k.jsx)(yt,{})})});function yt(){var e=Object(r.useState)(""),t=Object(v.a)(e,2),n=t[0],o=t[1],c=Object(r.useState)([]),a=Object(v.a)(c,2),i=a[0],s=a[1],u=Object(r.useState)([]),l=Object(v.a)(u,2),f=l[0],b=l[1],j=Object(r.useState)([]),O=Object(v.a)(j,2),y=O[0],g=O[1],x=Object(r.useState)(!1),w=Object(v.a)(x,2),I=w[0],A=w[1],C=Object(r.useState)(""),P=Object(v.a)(C,2),M=P[0],S=P[1];return Object(k.jsxs)(k.Fragment,{children:[!I&&Object(k.jsxs)(k.Fragment,{children:[Object(k.jsx)(ht.a,{fullWidth:!0,multiline:!0,rows:10,value:n,onChange:function(e){return o(e.target.value)}}),Object(k.jsx)(d.a,{color:"primary",disabled:0===n.trim().length,onClick:Object(m.a)(Object(h.a)().mark((function e(){var t,r,o,c,a,i,u,l,d,p,f,j;return Object(h.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:A(!0),S(""),s([]),b([]),g([]),t=vt.a.sentences(n,{newline_boundaries:!0}),s(t),r=[],o=[],e.prev=9,c=Object(Ue.a)(t),e.prev=11,c.s();case 13:if((a=c.n()).done){e.next=42;break}return i=a.value,e.next=17,kt(i);case 17:u=e.sent,r.push(u),l=[],d=Object(Ue.a)(u),e.prev=21,d.s();case 23:if((p=d.n()).done){e.next=31;break}return f=p.value,e.next=27,It(f,i);case 27:j=e.sent,l.push(j);case 29:e.next=23;break;case 31:e.next=36;break;case 33:e.prev=33,e.t0=e.catch(21),d.e(e.t0);case 36:return e.prev=36,d.f(),e.finish(36);case 39:o.push(l);case 40:e.next=13;break;case 42:e.next=47;break;case 44:e.prev=44,e.t1=e.catch(11),c.e(e.t1);case 47:return e.prev=47,c.f(),e.finish(47);case 50:b(r),g(o),e.next=57;break;case 54:e.prev=54,e.t2=e.catch(9),S(e.t2.message);case 57:A(!1);case 58:case"end":return e.stop()}}),e,null,[[9,54],[11,44,47,50],[21,33,36,39]])}))),children:"Generate questions"})]}),I&&Object(k.jsx)($.a,{}),M.length>0&&Object(k.jsx)(Le,{msg:M}),i.map((function(e,t){return Object(k.jsxs)("div",{children:[Object(k.jsxs)(p.a,{children:[t+1,". ",e]}),f[t]&&y[t]&&Object(k.jsx)("div",{children:f[t].map((function(e,n){return Object(k.jsxs)("div",{children:[Object(k.jsxs)(p.a,{children:["Q: ",e]}),Object(k.jsxs)(p.a,{children:["A: ",y[t][n]]})]},n)}))},t),Object(k.jsx)("hr",{})]},t)}))]})}var gt="https://api-inference.huggingface.co",xt="api_DwXNmIqfMrkqtAsBPajwkjVDLzUNGeFzBr";function kt(e){return wt.apply(this,arguments)}function wt(){return(wt=Object(m.a)(Object(h.a)().mark((function e(t){var n,r,o,c;return Object(h.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("".concat(gt,"/models/valhalla/t5-base-e2e-qg"),{headers:{authorization:"Bearer ".concat(xt)},body:JSON.stringify({inputs:"generate questions: ".concat(t," </s>")}),method:"POST"});case 2:if((n=e.sent).ok){e.next=8;break}return e.next=6,n.text();case 6:throw r=e.sent,new Error(r);case 8:return e.next=10,n.json();case 10:return o=e.sent,c=o[0].generated_text,e.abrupt("return",c.split("<sep>").map((function(e){return e.trim()})).filter((function(e){return e.length>0})));case 13:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function It(e,t){return At.apply(this,arguments)}function At(){return(At=Object(m.a)(Object(h.a)().mark((function e(t,n){var r,o,c,a;return Object(h.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("".concat(gt,"/models/valhalla/t5-base-qa-qg-hl"),{headers:{authorization:"Bearer ".concat(xt)},body:JSON.stringify({inputs:"question: ".concat(t,"  context: ").concat(n," </s>")}),method:"POST"});case 2:if((r=e.sent).ok){e.next=8;break}return e.next=6,r.text();case 6:throw o=e.sent,new Error(o);case 8:return e.next=10,r.json();case 10:return c=e.sent,a=c[0].generated_text,e.abrupt("return",a);case 13:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Ct(){var e=Xe();return Object(k.jsxs)(l.a,{container:!0,spacing:e?2:0,children:[e&&Object(k.jsx)(l.a,{item:!0,md:5,children:Object(k.jsx)(Ze,{})}),Object(k.jsx)(l.a,{item:!0,md:7,sm:12,children:Object(k.jsxs)(u.d,{children:[nt,ot,bt,Ot,Object(k.jsx)(u.a,{from:"*",to:"/"})]})})]})}n(2068);function Pt(){var e=Object(je.b)(),t=A();return Object(k.jsx)(l.a,{item:!0,md:6,sm:12,children:Object(k.jsx)(ne,{children:Object(k.jsx)(O.a,{autoComplete:"off",schema:{type:"object",required:["email","password"],properties:{email:{type:"string",format:"email",title:"Email"},password:{type:"string",title:"Password"}}},uiSchema:{password:{"ui:widget":"password"}},onSubmit:function(n){var r,o,c=n.formData;return r=c.email,o=c.password,void e.signInWithEmailAndPassword(r,o).then((function(){}),(function(e){t("error","Could not login"),console.error(e)}))},children:Object(k.jsx)(d.a,{type:"submit",color:"primary",children:"Login"})})})})}function Mt(e){var t=e.children;return Object(k.jsx)(je.a,{firebaseApp:Oe.a,suspense:!0,children:Object(k.jsx)(St,{children:t})})}function St(e){var t=e.children,n=Object(je.f)(),r=n.status,o=n.data;if("error"===r)throw new Error("Could not check signin");return"loading"===r?Object(k.jsx)($.a,{}):o.signedIn?Object(k.jsx)(k.Fragment,{children:t}):Object(k.jsx)(Pt,{})}function zt(){return Object(k.jsxs)(k.Fragment,{children:[Object(k.jsx)(i.a,{}),Object(k.jsx)(Re,{errorMsg:"There's error, please try reloading this page",children:Object(k.jsx)(s.a,{children:Object(k.jsxs)(a.a,{children:[Object(k.jsx)(I,{}),Object(k.jsx)(q,{}),Object(k.jsx)(X,{}),Object(k.jsx)(Mt,{children:Object(k.jsx)(Ct,{})})]})})})]})}c.a.render(Object(k.jsx)(zt,{}),document.getElementById("root"))},329:function(e,t,n){"use strict";(function(e){n.d(t,"a",(function(){return o})),n.d(t,"b",(function(){return c})),n.d(t,"c",(function(){return a}));var r=n(281),o=(n(2072),n(2073),r.a.initializeApp({apiKey:"AIzaSyB-svyOf1GKrlLnGCNWFo7SA9xMzKKLkys",projectId:"happy-child-302620",authDomain:"localhost",storageBucket:"gs://happy-child-302620.appspot.com"})),c=r.a.firestore(o),a=r.a.storage(o);e.firestore=c}).call(this,n(186))},332:function(e,t,n){"use strict";var r=n(694).default;Object.defineProperty(t,"__esModule",{value:!0}),t.isOrdered=t.collectionFromPath=t.collectionPath=void 0;var o=n(104);function c(e){return"string"===typeof e?e:e[1]}t.collectionPath=function(e){if("string"===typeof e)return e;var t=r(e,2),n=t[0],o=t[1];return"books/".concat(n,"/").concat(o)},t.collectionFromPath=c,t.isOrdered=function(e){var t=c(e),n=o.collectionsWithoutParent,r=o.childCollectionsWithoutOrder;return!n.includes(t)&&!r.includes(t)}},335:function(e,t,n){"use strict";var r=n(1375).default,o=n(902).default,c=n(905).default,a=n(1376).default;function i(){return(i=a(r().mark((function e(n,a){var i,u,l,d,p,f;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:i=[],u=c(t.macroTypes),e.prev=2,u.s();case 4:if((l=u.n()).done){e.next=13;break}return d=l.value,e.next=8,a(d,n);case 8:p=e.sent,f=s(d,p),i.push.apply(i,o(f));case 11:e.next=4;break;case 13:e.next=18;break;case 15:e.prev=15,e.t0=e.catch(2),u.e(e.t0);case 18:return e.prev=18,u.f(),e.finish(18);case 21:return i.sort((function(e,t){return e.doc.order-t.doc.order})),e.abrupt("return",i);case 23:case"end":return e.stop()}}),e,null,[[2,15,18,21]])})))).apply(this,arguments)}function s(e,t){return t.map((function(t){return{macroType:e,doc:t}}))}Object.defineProperty(t,"__esModule",{value:!0}),t.useMacros=t.getMacros=t.defaultImage=t.tocTypes=t.panelTypes=t.includePageTypes=t.macroTypes=void 0,t.macroTypes=["mQuizzes","mRearrangeQuizzes","mInputQuizzes","mQuizGroups","mQuizTests","mAccordions","mAudios","mExpands","mImages","mIncludePages","mInputs","mListSelects","mListShows","mMarkdowns","mPanels","mQuotes","mSurveys","mTocs","mYouTubes"],t.includePageTypes=["inline","expand","link"],t.panelTypes=["info","note","success","warning","error"],t.tocTypes=["parts","chapters","pages"],t.defaultImage="data:image/gif;base64,R0lGODlhEAAQAMQAAORHHOVSKudfOulrSOp3WOyDZu6QdvCchPGolfO0o/XBs/fNwfjZ0frl3/zy7////wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACH5BAkAABAALAAAAAAQABAAAAVVICSOZGlCQAosJ6mu7fiyZeKqNKToQGDsM8hBADgUXoGAiqhSvp5QAnQKGIgUhwFUYLCVDFCrKUE1lBavAViFIDlTImbKC5Gm2hB0SlBCBMQiB0UjIQA7",t.getMacros=function(e,t){return i.apply(this,arguments)},t.useMacros=function(e,n){var r,a=[],i=c(t.macroTypes);try{for(i.s();!(r=i.n()).done;){var u=r.value,l=s(u,n(u,e));a.push.apply(a,o(l))}}catch(d){i.e(d)}finally{i.f()}return a.sort((function(e,t){return e.doc.order-t.doc.order})),a}},617:function(e,t,n){"use strict";n.d(t,"b",(function(){return l})),n.d(t,"a",(function(){return g}));var r,o=n(55),c=n(65),a=n(104),i=Object(c.a)(a.collections);try{for(i.s();!(r=i.n()).done;){var s=r.value;delete a.jsonSchemas[s].properties.id,delete a.jsonSchemas[s].properties.parentId}}catch(x){i.e(x)}finally{i.f()}var u,l={},d=Object(c.a)(a.collections);try{for(d.s();!(u=d.n()).done;){var p=u.value;l[p]={}}}catch(x){d.e(x)}finally{d.f()}var f,b={"ui:widget":"textarea","ui:options":{rows:20}},j=Object(a.getMarkdownProperties)(),h=Object(c.a)(a.collections);try{for(h.s();!(f=h.n()).done;){var m,v=f.value,O=Object(c.a)(j[v]);try{for(O.s();!(m=O.n()).done;){var y=m.value;l[v][y]=b}}catch(x){O.e(x)}finally{O.f()}}}catch(x){h.e(x)}finally{h.f()}var g={};a.collections.forEach((function(e){var t=a.jsonSchemas[e].properties;g[e]={};for(var n=0,r=Object.entries(t);n<r.length;n++){var c=Object(o.a)(r[n],2),i=c[0],s=c[1];g[e][i]=s.default}}))},692:function(e,t,n){"use strict";var r=n(902).default;Object.defineProperty(t,"__esModule",{value:!0}),t.collections=t.bookDataCollections=t.childCollectionsWithoutOrder=t.collectionsWithoutParent=void 0;var o=n(335);t.collectionsWithoutParent=["books"],t.childCollectionsWithoutOrder=["lists"],t.bookDataCollections=[].concat(r(t.childCollectionsWithoutOrder),["pages"],r(o.macroTypes)),t.collections=[].concat(r(t.collectionsWithoutParent),r(t.bookDataCollections))},813:function(e,t,n){"use strict";function r(e,t){return e?new Promise((function(n){var r=new Image;r.onload=function(){if(r.width<=t)n(e);else{var o=function(e,t){var n=e.height*t/e.width,r=document.createElement("canvas");return r.width=t,r.height=n,r.getContext("2d").drawImage(e,0,0,t,n),r.toDataURL("image/jpeg",.7)}(r,t);n(o)}},r.src=e})):Promise.resolve(e)}n.d(t,"a",(function(){return r}))},906:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.iconSets=void 0,t.iconSets=["AntDesign","Entypo","EvilIcons","Feather","FontAwesome","FontAwesome5","Fontisto","Foundation","Ionicons","MaterialCommunityIcons","MaterialIcons","Octicons","Zocial","SimpleLineIcons"]},907:function(e,t,n){"use strict";var r=n(694).default;Object.defineProperty(t,"__esModule",{value:!0}),t.getMarkdownProperties=t.jsonSchemas=t.shortJsonSchemas=void 0;var o=n(692),c=n(1381),a=n(1382),i=n(1383),s=n(1384),u=n(1385),l=n(1386),d=n(1387),p=n(1388),f=n(1389),b=n(1390),j=n(1391),h=n(1392),m=n(1393),v=n(1394),O=n(1395),y=n(1396),g=n(1397),x=n(908),k=n(1398),w=n(1399),I=n(1400),A=n(1401);t.shortJsonSchemas={books:c.books,lists:a.lists,pages:i.pages,mAccordions:s.mAccordions,mAudios:u.mAudios,mExpands:l.mExpands,mImages:d.mImages,mIncludePages:p.mIncludePages,mInputs:f.mInputs,mListSelects:b.mListSelects,mListShows:j.mListShows,mMarkdowns:h.mMarkdowns,mPanels:m.mPanels,mQuotes:v.mQuotes,mSurveys:O.mSurveys,mTocs:y.mTocs,mYouTubes:g.mYouTubes,mQuizzes:x.mQuizzes,mRearrangeQuizzes:k.mRearrangeQuizzes,mInputQuizzes:w.mInputQuizzes,mQuizGroups:I.mQuizGroups,mQuizTests:A.mQuizTests},t.jsonSchemas=JSON.parse(JSON.stringify(t.shortJsonSchemas));for(var C=0,P=Object.entries(t.jsonSchemas);C<P.length;C++){var M=r(P[C],2),S=M[0],z=M[1],T=o.collectionsWithoutParent.includes(S),_=o.childCollectionsWithoutOrder.includes(S);z.properties=Object.assign({id:{type:"string"}},T?{}:_?{parentId:{type:"string"}}:{parentId:{type:"string"},order:{type:"integer",default:99}},z.properties),z.required||(z.required=[]),T?z.required.unshift("id"):_?z.required.unshift("id","parentId"):z.required.unshift("id","parentId","order")}t.getMarkdownProperties=function(){for(var e={},n=0,o=Object.entries(t.jsonSchemas);n<o.length;n++){var c=r(o[n],2),a=c[0],i=c[1];e[a]=[];for(var s=0,u=Object.entries(i.properties);s<u.length;s++){var l=r(u[s],2),d=l[0],p=l[1];"string"===p.type&&"Markdown"===p.$comment&&e[a].push(d)}}return e}},908:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.mQuizzes=void 0,t.mQuizzes={title:"Quiz",description:"Macro that shows a quiz (can be multiple choices)",type:"object",properties:{question:{type:"string",default:"Quiz question?",$comment:"Markdown"},image:{type:"string",format:"data-url"},choices:{type:"array",items:{title:"Choice",type:"object",properties:{choice:{type:"string",default:"Choice"},correct:{type:"boolean",default:!1}},required:["choice","correct"]},uniqueItems:!0,default:[{choice:"Choice 1",correct:!0},{choice:"Choice 2",correct:!1}]},multiple:{type:"boolean",default:!1},explanation:{description:"Explanation about the answer",type:"string",default:"Markdown text",$comment:"Markdown"}},required:["choices","multiple"]}}},[[2070,158,159]]]);