(this["webpackJsonphappy-author"]=this["webpackJsonphappy-author"]||[]).push([[9],{2376:function(e,t,n){"use strict";n.r(t),n.d(t,"MediaStore",(function(){return r.a})),n.d(t,"MediaStoreError",(function(){return i.a})),n.d(t,"isMediaStoreError",(function(){return i.b})),n.d(t,"getMediaEnvironment",(function(){return r.b})),n.d(t,"getMediaRegion",(function(){return r.c})),n.d(t,"UploadController",(function(){return o.a})),n.d(t,"isPreviewableType",(function(){return a.c})),n.d(t,"isMediaCollectionItemFullDetails",(function(){return a.b})),n.d(t,"getArtifactUrl",(function(){return c.a})),n.d(t,"isMediaClientError",(function(){return u.b})),n.d(t,"getMediaClientErrorReason",(function(){return u.a})),n.d(t,"isUploadingFileState",(function(){return s.g})),n.d(t,"isProcessingFileState",(function(){return s.f})),n.d(t,"isProcessedFileState",(function(){return s.e})),n.d(t,"isErrorFileState",(function(){return s.a})),n.d(t,"isPreviewableFileState",(function(){return s.d})),n.d(t,"isFinalFileState",(function(){return s.b})),n.d(t,"isImageRepresentationReady",(function(){return s.c})),n.d(t,"mapMediaFileToFileState",(function(){return s.h})),n.d(t,"mapMediaItemToFileState",(function(){return s.i})),n.d(t,"StreamsCache",(function(){return f.a})),n.d(t,"uploadFile",(function(){return ee})),n.d(t,"request",(function(){return ne.a})),n.d(t,"RequestError",(function(){return re.a})),n.d(t,"isRequestError",(function(){return re.b})),n.d(t,"isRateLimitedError",(function(){return ie.g})),n.d(t,"isAbortedRequestError",(function(){return ie.f})),n.d(t,"mapResponseToJson",(function(){return ie.i})),n.d(t,"mapResponseToBlob",(function(){return ie.h})),n.d(t,"mapResponseToVoid",(function(){return ie.j})),n.d(t,"createUrl",(function(){return ie.d})),n.d(t,"PollingFunction",(function(){return oe.a})),n.d(t,"isPollingError",(function(){return ae.b})),n.d(t,"PollingError",(function(){return ae.a})),n.d(t,"imageResizeModeToFileImageMode",(function(){return ce})),n.d(t,"FileFetcherImpl",(function(){return Re})),n.d(t,"FileFetcherError",(function(){return me})),n.d(t,"isFileFetcherError",(function(){return ve})),n.d(t,"CollectionFetcher",(function(){return Ke})),n.d(t,"MediaClient",(function(){return Ge})),n.d(t,"StargateClient",(function(){return qe})),n.d(t,"isImageRemote",(function(){return Je})),n.d(t,"checkWebpSupport",(function(){return Ve})),n.d(t,"getDimensionsFromBlob",(function(){return je.a})),n.d(t,"createMediaSubject",(function(){return ke.a})),n.d(t,"safeUnsubscribe",(function(){return We})),n.d(t,"isFileIdentifier",(function(){return Xe})),n.d(t,"isExternalImageIdentifier",(function(){return Qe})),n.d(t,"isDifferentIdentifier",(function(){return Ye})),n.d(t,"withMediaClient",(function(){return ut})),n.d(t,"getMediaClient",(function(){return ct})),n.d(t,"globalMediaEventEmitter",(function(){return be.a})),n.d(t,"isMediaBlobUrl",(function(){return dt})),n.d(t,"getAttrsFromUrl",(function(){return mt})),n.d(t,"addFileAttrsToUrl",(function(){return bt})),n.d(t,"objectToQueryString",(function(){return vt})),n.d(t,"createMediaSubscribable",(function(){return Ce})),n.d(t,"RECENTS_COLLECTION",(function(){return W.f})),n.d(t,"MAX_RESOLUTION",(function(){return W.c})),n.d(t,"getMediaTypeFromMimeType",(function(){return gt})),n.d(t,"isImageMimeTypeSupportedByBrowser",(function(){return wt})),n.d(t,"isDocumentMimeTypeSupportedByBrowser",(function(){return Ot})),n.d(t,"isMimeTypeSupportedByBrowser",(function(){return xt})),n.d(t,"isImageMimeTypeSupportedByServer",(function(){return jt})),n.d(t,"isDocumentMimeTypeSupportedByServer",(function(){return kt})),n.d(t,"isAudioMimeTypeSupportedByServer",(function(){return St})),n.d(t,"isVideoMimeTypeSupportedByServer",(function(){return It})),n.d(t,"isUnknownMimeTypeSupportedByServer",(function(){return Pt})),n.d(t,"isMimeTypeSupportedByServer",(function(){return Ft}));var r=n(2431),i=n(2466),o=n(2596),a=n(2441),c=n(2519),u=n(2521),s=n(2373),f=n(2442),l=n(12),d=n.n(l),p=n(26),h=n.n(p),m=n(1138),v=n(230),b=n(427),y=n(1139),g=n(1140),w=n(538),O=n(2597);function x(e){return Array.prototype.map.call(new Uint8Array(e),(function(e){return("00"+e.toString(16)).slice(-2)})).join("")}var j=function(e){return function(e){var t=new FileReader;return new Promise((function(n,r){t.onload=function(){n(this.result)},t.onerror=r,t.readAsArrayBuffer(e)}))}(e).then((function(e){return crypto.subtle.digest("SHA-1",e)})).then(x)},k=n(1),S=n.n(k),I=n(311);function P(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function F(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?P(Object(n),!0).forEach((function(t){S()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):P(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function C(){return(C=h()(d.a.mark((function e(t){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("string"!==typeof t){e.next=6;break}return e.next=3,fetch(t).then((function(e){return e.blob()}));case 3:return e.abrupt("return",e.sent);case 6:return e.abrupt("return",t);case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var E=function(e,t,n){return Object(y.fromPromise)(function(e){return C.apply(this,arguments)}(e)).pipe(Object(v.concatMap)((function(e){var r=t.chunkSize,i=n.onProgress,o=Math.ceil(e.size/r),a=function(e,t){var n=t.size,r=Math.ceil(e.size/n);return Object(g.range)(0,r).pipe(Object(w.map)((function(t){return e.slice(t*n,(t+1)*n)})))}(e,{size:r}),c=function(e,t){var n=t.hasher,r=t.concurrency;return Object(O.asyncMap)(function(e){return function(t){return e(t).then((function(e){return{blob:t,hash:"".concat(e,"-").concat(t.size)}}))}}(n||j),r)(e)}(a,{concurrency:t.hashingConcurrency,hasher:t.hashingFunction}),u=function(e,t){var n=t.batchSize,r=t.prober;return e.pipe(Object(b.bufferCount)(n),Object(v.concatMap)((function(e){return r(e).then((function(t){return e.map((function(e,n){return F(F({},e),{},{exists:t[n]})}))}))})),Object(v.concatMap)((function(e){return Object(I.from)(e)})))}(c,{batchSize:t.probingBatchSize,prober:t.probingFunction}),s=0,f=function(e,t){return e.pipe(Object(O.asyncMap)((function(e){return e.exists?Promise.resolve(e):t.uploader(e).then((function(){return e}))}),t.concurrency))}(u,{concurrency:t.uploadingConcurrency,uploader:t.uploadingFunction});return i&&(f=f.pipe(Object(m.tap)((function(){i((s+=1)/o)})))),function(e,t){return e.pipe(Object(b.bufferCount)(t.batchSize)).pipe(Object(v.concatMap)((function(e){return t.processor?t.processor(e).then((function(){return e})):Promise.resolve(e)})))}(f,{batchSize:t.processingBatchSize,processor:t.processingFunction}).pipe(Object(v.concatMap)((function(e){return Object(I.from)(e)})),Object(b.bufferCount)(o))})))},U=null,R=function(){var e=h()(d.a.mark((function e(){var t,r,i,o,a;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=3,U){e.next=17;break}return e.prev=2,e.next=5,n.e(187).then(n.bind(null,3225));case 5:r=e.sent,i=r.WorkerHasher,U=new i(t),e.next=17;break;case 10:return e.prev=10,e.t0=e.catch(2),e.next=14,n.e(186).then(n.bind(null,3226));case 14:o=e.sent,a=o.SimpleHasher,U=new a;case 17:return e.abrupt("return",U);case 18:case"end":return e.stop()}}),e,null,[[2,10]])})));return function(){return e.apply(this,arguments)}}(),T=n(9),B=n.n(T),M=n(10),A=n.n(M),N=n(15),L=n.n(N),D=n(18),K=n.n(D),z=n(7),q=n.n(z),G=n(2411);function J(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=q()(e);if(t){var i=q()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return K()(this,n)}}var V=function(e){L()(n,e);var t=J(n);function n(e,r,i){var o;return B()(this,n),(o=t.call(this,e)).reason=e,o.id=r,o.metadata=i,o}return A()(n,[{key:"attributes",get:function(){var e=this.reason,t=this.id,n=this.metadata;return{reason:e,id:t,collectionName:(n=void 0===n?{}:n).collectionName,occurrenceKey:n.occurrenceKey}}}]),n}(G.a);var W=n(2391),H="fileSizeExceedsLimit",_=n(3117),X=function(){var e=h()(d.a.mark((function e(t){var n;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,R();case 2:return n=e.sent,e.abrupt("return",n.hash(t));case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),Q=function(e,t){return function(){var n=h()(d.a.mark((function n(r){var i,o;return d.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,e.probeChunks(te(r),{collectionName:t});case 2:return i=n.sent,o=i.data.results,n.abrupt("return",Object.values(o).map((function(e){return e.exists})));case 5:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}()},Y=function(e,t){return function(n){return e.uploadChunk(n.hash,n.blob,{collectionName:t})}},Z=function(e,t,n){var r=0;return function(){var i=h()(d.a.mark((function i(o){return d.a.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:return i.t0=e,i.next=3,t;case 3:return i.t1=i.sent,i.t2={chunks:te(o),offset:r},i.t3=n,i.next=8,i.t0.appendChunksToUpload.call(i.t0,i.t1,i.t2,i.t3);case 8:r+=o.length;case 9:case"end":return i.stop()}}),i)})));return function(e){return i.apply(this,arguments)}}()},$=function(){var e=h()(d.a.mark((function e(t,n,r,i){var o,a,c,u,s;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=t.collection,a=t.name,c=t.mimeType,u=r.id,s=r.occurrenceKey,e.abrupt("return",n.createFileFromUpload({uploadId:i,name:a,mimeType:c},{occurrenceKey:s,collection:o,replaceFileId:u}));case 3:case"end":return e.stop()}}),e)})));return function(t,n,r,i){return e.apply(this,arguments)}}(),ee=function(e,t,n,r){var i=e.content,o=e.collection,c=n.deferredUploadId,u=n.id,s=n.occurrenceKey,f=W.a;try{i instanceof Blob&&Object(_.c)("mediaUploadApiV2",t.featureFlags)&&(f=function(e){if(e>W.d)throw new Error(H);return e<=5*a.a.GB?5*a.a.MB:e>5*a.a.GB&&e<=50*a.a.GB?50*a.a.MB:e>50*a.a.GB&&e<=.95*a.a.TB?100*a.a.MB:210*a.a.MB}(i.size))}catch(h){return h instanceof Error&&h.message===H&&(null===r||void 0===r||r.onUploadFinish(new V(h.message,u,{collectionName:o,occurrenceKey:s}))),{cancel:function(){null===r||void 0===r||r.onUploadFinish("canceled")}}}var l=function(e,t,n){return E(e,t,n)}(i,{hashingFunction:X,hashingConcurrency:5,probingBatchSize:100,chunkSize:f,uploadingConcurrency:3,uploadingFunction:Y(t,o),probingFunction:Q(t,o),processingBatchSize:W.e,processingFunction:Z(t,c,o)},{onProgress:function(e){r&&r.onProgress(e)}}),d=r&&r.onUploadFinish||function(){},p=Object(I.from)(c).pipe(Object(v.concatMap)((function(r){return l.pipe(Object(v.concatMap)((function(){return Object(I.from)($(e,t,n,r))})))}))).subscribe({error:function(e){return d(e)},complete:function(){return d()}});return{cancel:function(){p.unsubscribe(),d("canceled")}}},te=function(e){return e.map((function(e){return e.hash}))},ne=n(2520),re=n(2467),ie=n(2392),oe=n(2468),ae=n(2469),ce=function(e){return"stretchy-fit"===e?"full-fit":e},ue=n(317),se=n(1128),fe=n(310),le=n.n(fe),de=(n(863),n(214)),pe=function(e,t){var n=!!window.MSInputMethodContext&&!!document.documentMode,r=/^((?!chrome|android).)*safari/i.test(navigator.userAgent),i="media-download-iframe",o=document.createElement("a"),a=document.getElementById(i);a||((a=document.createElement("iframe")).style.display="none",a.id=i,a.name=i,document.body.appendChild(a)),o.href=e,t&&t.name&&(o.download=t.name),o.target=n||r?"_blank":i,document.body.appendChild(o),o.click(),document.body.removeChild(o)};function he(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=q()(e);if(t){var i=q()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return K()(this,n)}}var me=function(e){L()(n,e);var t=he(n);function n(e,r,i){var o;return B()(this,n),(o=t.call(this,e)).reason=e,o.id=r,o.metadata=i,o}return A()(n,[{key:"attributes",get:function(){var e=this.reason,t=this.id,n=this.metadata;return{reason:e,id:t,collectionName:(n=void 0===n?{}:n).collectionName,occurrenceKey:n.occurrenceKey}}}]),n}(G.a);function ve(e){return e instanceof me}var be=n(2522),ye=n(874),ge=n.n(ye),we=n(2599),Oe=n(2492),xe=function(e,t){return Object(s.a)(e)||"unknown"!==e.mediaType?{}:{mediaType:t}},je=n(2566),ke=n(2443),Se=n(2412),Ie=n(2601),Pe=n(2598);function Fe(e){return{subscribe:function(t){var n=e.subscribe(t);return{unsubscribe:function(){n.unsubscribe()}}}}}function Ce(e){return Fe(Object(ke.a)(e))}function Ee(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Ue(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Ee(Object(n),!0).forEach((function(t){S()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Ee(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Re=function(){function e(t){var n=this;B()(this,e),S()(this,"createDownloadFileStream",(function(e,t,r){var i=Object(ke.a)(),o=new oe.a;return o.onError=function(e){return i.error(e)},o.execute(h()(d.a.mark((function a(){var c,u;return d.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,n.dataloader.load({id:e,collectionName:t});case 2:if(c=a.sent){a.next=5;break}throw new me("emptyItems",e,{collectionName:t,occurrenceKey:r});case 5:if(!Object(Pe.a)(c)){a.next=7;break}throw new me("zeroVersionFile",e,{collectionName:t,occurrenceKey:r});case 7:u=Object(s.i)(e,c),i.next(u),a.t0=u.status,a.next="processing"===a.t0?12:"processed"===a.t0?14:16;break;case 12:return o.next(),a.abrupt("break",16);case 14:return i.complete(),a.abrupt("break",16);case 16:case"end":return a.stop()}}),a)})))),i})),this.mediaStore=t,this.dataloader=Object(we.a)(t)}return A()(e,[{key:"getFileState",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=n.collectionName,i=n.occurrenceKey;if(!ge()(e)){var o=Object(ke.a)();return o.error(new me("invalidFileId",e,{collectionName:r,occurrenceKey:i})),Fe(o)}return Fe(Object(f.b)().getOrInsert(e,(function(){return t.createDownloadFileStream(e,r)})))}},{key:"getCurrentState",value:function(e,t){return function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new ue.Subscription;return new Promise((function(n,r){return t.add(e.subscribe({next:function(e){n(e),t.unsubscribe()},error:function(e){r(e),t.unsubscribe()}}))}))}(this.getFileState(e,t))}},{key:"getArtifactURL",value:function(e,t,n){return this.mediaStore.getArtifactURL(e,t,n)}},{key:"getFileBinaryURL",value:function(e,t){return this.mediaStore.getFileBinaryURL(e,t)}},{key:"touchFiles",value:function(e,t){return this.mediaStore.touchFiles({descriptors:e},{collection:t}).then((function(e){return e.data}))}},{key:"generateUploadableFileUpfrontIds",value:function(e){var t=le()(),n=le()(),r={fileId:t,occurrenceKey:n,collection:e};return{id:t,occurrenceKey:n,deferredUploadId:this.touchFiles([r],e).then((function(e){return e.created[0].uploadId}))}}},{key:"uploadExternal",value:function(){var e=h()(d.a.mark((function e(t,n){var r,i,o,a,c,u,s,l,p=this;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=this.generateUploadableFileUpfrontIds(n),i=r.id,o=r.occurrenceKey,a=Object(ke.a)(),c=fetch(t).then((function(e){return e.blob()})).catch((function(){})),u=new Promise(function(){var e=h()(d.a.mark((function e(t,n){var r;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,c;case 2:(r=e.sent)||n("Could not fetch the blob"),t({value:r,origin:"remote"});case 5:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()),s=t.split("/").pop()||"",l={status:"processing",name:s,size:0,mediaType:"unknown",mimeType:"",id:i,occurrenceKey:o,preview:u},a.next(l),Object(f.b)().set(i,a),e.abrupt("return",new Promise(function(){var e=h()(d.a.mark((function e(t,f){var l,h,m,v,b,y;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,c;case 2:if(l=e.sent){e.next=5;break}return e.abrupt("return",f("Could not download remote file"));case 5:return h=l.type,m=l.size,v={content:l,mimeType:h,collection:n,name:s},b=Object(Oe.a)(h),a.next({status:"processing",name:s,size:m,mediaType:b,mimeType:h,id:i,occurrenceKey:o,preview:u}),p.upload(v,void 0,r),e.next=12,Object(je.a)(b,l);case 12:y=e.sent,t({dimensions:y,uploadableFileUpfrontIds:r});case 14:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()));case 10:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"upload",value:function(e,t,n){var r=this;"string"===typeof e.content&&(e.content=function(e){for(var t=e.split(",")[1],n=atob(t),r=[],i=function(e){var t=n.slice(e,e+512),i=t.split("").map((function(e,n){return t.charCodeAt(n)})),o=new Uint8Array(i);r.push(o)},o=0;o<n.length;o+=512)i(o);return new Blob(r,{type:"image/jpeg"})}(e.content));var i=e.content,o=e.name,a=void 0===o?"":o,c=e.collection;n||(n=this.generateUploadableFileUpfrontIds(c));var u,s=n.id,l=n.occurrenceKey,d="",p=0,h=function(e){if(e.content instanceof Blob){var t=e.content.type;return Object(Oe.a)(t)}return"unknown"}(e),m=Object(ke.a)(),b=new ue.Subscription;i instanceof Blob&&(p=i.size,d=i.type,Object(Se.d)(i.type)&&(u={value:i,origin:"local"}));var y={id:s,occurrenceKey:l,name:a,size:p,mediaType:h,mimeType:d,preview:u},g=function(e){m.next(Ue(Ue({status:"uploading"},y),{},{progress:e}))},O=ee(e,this.mediaStore,n,{onUploadFinish:function(e){if(e)return m.error(e);b.add(Object(Ie.b)(h,d,u).pipe(Object(v.concatMap)((function(e){return e?r.createDownloadFileStream(s,c,l).pipe(Object(w.map)((function(e){return Ue(Ue(Ue({},y),e),xe(e,h))}))):Object(se.of)(Ue({status:"processing",representations:{}},y))}))).subscribe(m))},onProgress:g}).cancel;return Object(f.b)().set(s,m),setTimeout((function(){g(0)}),0),t&&t.setAbort((function(){O(),b.unsubscribe()})),Fe(m)}},{key:"downloadBinary",value:function(){var e=h()(d.a.mark((function e(t){var n,r,i,o=arguments;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=o.length>1&&void 0!==o[1]?o[1]:"download",r=o.length>2?o[2]:void 0,e.next=4,this.mediaStore.getFileBinaryURL(t,r);case 4:i=e.sent,pe(i,{name:n}),be.a.emit("media-viewed",{fileId:t,isUserCollection:r===W.f,viewingLevel:"download"});case 7:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"copyFile",value:function(){var e=h()(d.a.mark((function e(t,n){var i,o,a,c,u,l,p,h,m,v,b,y,g,w,O,x,j,k,S,I,P,F,C,E,U,R,T,B=arguments;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=B.length>2&&void 0!==B[2]?B[2]:{},o=t.authProvider,a=t.collection,c=t.id,u=n.authProvider,l=n.collection,p=n.replaceFileId,h=n.occurrenceKey,m=i.preview,v=i.mimeType,b=n.mediaStore||new r.a({authProvider:u}),e.t0=de.authToOwner,e.next=8,o({collectionName:a});case 8:return e.t1=e.sent,y=(0,e.t0)(e.t1),g={sourceFile:{id:c,collection:a,owner:y}},w={collection:l,replaceFileId:p,occurrenceKey:h},O=Object(f.b)(),e.prev=13,e.next=16,b.copyFileWithToken(g,w);case 16:if(j=e.sent,k=j.data,S=Ue(Ue({},k),v?{mimeType:v}:void 0),I=S.id,P=S.mimeType,F=P?Object(Oe.a)(P):"unknown",C=Object(s.h)({data:S}),E=O.get(I),U=E||Object(ke.a)(),R=!Object(s.a)(C)&&m?{preview:m}:{},e.t2=!Object(s.b)(C)&&P,!e.t2){e.next=30;break}return e.next=29,Object(Ie.a)(F,P,m);case 29:e.t2=e.sent;case 30:if(!e.t2){e.next=35;break}U.next(Ue(Ue(Ue({},C),xe(C,F)),R)),x=this.createDownloadFileStream(I,l,h).subscribe({next:function(e){return U.next(Ue(Ue(Ue({},e),xe(e,F)),!Object(s.a)(e)&&R))},error:function(e){return U.error(e)},complete:function(){return U.complete()}}),e.next=36;break;case 35:Object(s.f)(C)||U.next(Ue(Ue({},C),!Object(s.a)(C)&&R));case 36:return O.has(I)||Object(f.b)().set(I,U),e.abrupt("return",k);case 40:throw e.prev=40,e.t3=e.catch(13),x&&x.unsubscribe(),p&&((T=O.get(p))?T.error(e.t3):O.set(c,Object(ke.a)(e.t3))),e.t3;case 45:case"end":return e.stop()}}),e,this,[[13,40]])})));return function(t,n){return e.apply(this,arguments)}}()}]),e}(),Te=n(24),Be=n.n(Te),Me=n(476);function Ae(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Ne(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Ae(Object(n),!0).forEach((function(t){S()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Ae(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Le,De={},Ke=function(){function e(t){B()(this,e),this.mediaStore=t}return A()(e,[{key:"createFileStateObserver",value:function(e,t){var n=new Me.ReplaySubject(1),r=Ne({id:e},t),i=Object(s.h)({data:r});return n.next(i),n}},{key:"populateCache",value:function(e){var t=this;e.forEach((function(e){var n=t.createFileStateObserver(e.id,e.details);Object(f.b)().set(e.id,n)}))}},{key:"removeFromCache",value:function(e,t){var n=De[t].items.findIndex((function(t){return t.id===e}));-1!==n&&(Object(f.b)().remove(e),De[t].items.splice(n,1))}},{key:"getItems",value:function(e,t){var n=this;De[e]||(De[e]={items:[],subject:new Me.ReplaySubject(1),isLoadingNextPage:!1});var r=De[e],i=r.subject;return this.mediaStore.getCollectionItems(e,Ne(Ne({},t),{},{details:"full"})).then((function(e){var t=e.data,o=t.contents,a=t.nextInclusiveStartKey;n.populateCache(o),r.items=e.data.contents,r.nextInclusiveStartKey=a,i.next(r.items)})).catch((function(e){return i.error(e)})),Fe(i)}},{key:"removeFile",value:function(){var e=h()(d.a.mark((function e(t,n,r){var i;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.mediaStore.removeCollectionFile(t,n,r);case 2:this.removeFromCache(t,n),(i=De[n]).subject.next(i.items);case 5:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"loadNextPage",value:function(){var e=h()(d.a.mark((function e(t,n){var r,i,o,a,c,u,s,f,l,p,h,m;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=De[t],i=!!r&&r.isLoadingNextPage,r&&r.nextInclusiveStartKey&&!i){e.next=4;break}return e.abrupt("return");case 4:return r.isLoadingNextPage=!0,o=De[t],a=o.nextInclusiveStartKey,c=o.items,u=o.subject,e.next=8,this.mediaStore.getCollectionItems(t,Ne(Ne({},n),{},{inclusiveStartKey:a,details:"full"}));case 8:s=e.sent,f=s.data,l=f.contents,p=f.nextInclusiveStartKey,this.populateCache(l),h=s.data.contents,m=[].concat(Be()(c),Be()(h)),u.next(m),De[t]={items:m,nextInclusiveStartKey:p,subject:u,isLoadingNextPage:!1};case 15:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()}]),e}(),ze=n(531),qe=function(){function e(t){B()(this,e),this.baseUrl=t||"/gateway/api"}return A()(e,[{key:"fetchToken",value:function(){var e=h()(d.a.mark((function e(t){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("".concat(this.baseUrl,"/media/auth/smartedge"),{credentials:"include",headers:{"x-client-id":t}});case 2:return e.abrupt("return",e.sent.json());case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"isTokenExpired",value:function(e){var t=(new Date).getTime()/1e3;return e.data.iat+e.data.expiresIn-t<0}}]),e}(),Ge=function(){function e(t,n){B()(this,e),this.mediaClientConfig=t,this.featureFlags=n,this.mediaStore=new r.a({authProvider:t.authProvider,initialAuth:t.initialAuth},n),this.config=t,this.collection=new Ke(this.mediaStore),this.file=new Re(this.mediaStore),this.eventEmitter=new ze.EventEmitter2,this.stargate=new qe(t.stargateBaseUrl)}return A()(e,[{key:"getImage",value:function(e,t,n,r){return this.mediaStore.getImage(e,t,n,r)}},{key:"getImageUrl",value:function(e,t){return this.mediaStore.getFileImageURL(e,t)}},{key:"getImageUrlSync",value:function(e,t){return this.mediaStore.getFileImageURLSync(e,t)}},{key:"getImageMetadata",value:function(){var e=h()(d.a.mark((function e(t,n){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.mediaStore.getImageMetadata(t,n);case 2:return e.abrupt("return",e.sent.metadata);case 3:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"mobileUploadPromise",value:function(){var e=h()(d.a.mark((function e(){var t;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.mobileUpload){e.next=2;break}return e.abrupt("return",this.mobileUpload);case 2:return e.next=4,Promise.all([n.e(7),n.e(163)]).then(n.bind(null,3315));case 4:return t=e.sent,this.mobileUpload=new t.MobileUploadImpl(this.mediaStore),e.abrupt("return",this.mobileUpload);case 7:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"on",value:function(e,t){this.eventEmitter.on(e,t)}},{key:"off",value:function(e,t){this.eventEmitter.off(e,t)}},{key:"emit",value:function(e,t){return this.eventEmitter.emit(e,t)}}]),e}(),Je=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:window.location.origin;if(URL&&URL.prototype){var n=new URL(e);return!!n.host&&n.origin!==t}return!0},Ve=function(){return void 0!==Le?Promise.resolve(Le):new Promise((function(e){var t=new Image;t.src="data:image/webp;base64,UklGRi4AAABXRUJQVlA4TCEAAAAvAUAAEB8wAiMwAgSSNtse/cXjxyCCmrYNWPwmHRH9jwMA",t.onload=t.onerror=function(){Le=2===t.height,e(Le)}}))},We=function(e){console.warn("safeUnsubscribe() is deprecated and will be removed in the next media-client major version"),setTimeout((function(){return e&&e.unsubscribe()}),0)},He=n(2385),_e=n.n(He),Xe=function(e){return"file"===e.mediaItemType},Qe=function(e){return"external-image"===e.mediaItemType},Ye=function(e,t){return Xe(e)&&Xe(t)?e.id!==t.id||e.collectionName!==t.collectionName||e.occurrenceKey!==t.occurrenceKey:!_e()(e,t)},Ze=n(28),$e=n.n(Ze),et=n(42),tt=n.n(et),nt=n(0),rt=n.n(nt),it=["mediaClientConfig"];function ot(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=q()(e);if(t){var i=q()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return K()(this,n)}}var at=new Map,ct=function(e,t){var n=at.get(e);return n||(n=new Ge(e,t),at.set(e,n)),n},ut=function(e,t){return function(n){L()(i,n);var r=ot(i);function i(){return B()(this,i),r.apply(this,arguments)}return A()(i,[{key:"render",value:function(){var n=this.props,r=n.mediaClientConfig,i=tt()(n,it),o=r?ct(r,t):function(e){return new Ge({authProvider:function(){return Promise.resolve({clientId:"",token:"",baseUrl:""})}},e)}(t);return rt.a.createElement(e,$e()({},i,{mediaClient:o}))}}]),i}(rt.a.Component)};function st(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function ft(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?st(Object(n),!0).forEach((function(t){S()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):st(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var lt="media-blob-url",dt=function(e){return e.indexOf("".concat(lt,"=true"))>-1},pt=function(e,t){var n=e.get(t);return"string"!==typeof n||isNaN(parseInt(n))?void 0:parseInt(n)},ht=function(e,t){var n=e.get(t);if(n)return decodeURIComponent(n)},mt=function(e){var t=new URL(e).hash.replace("#",""),n=new URLSearchParams(t),r=n.get("id"),i=n.get("contextId");if(r&&i)return{id:r,contextId:i,collection:ht(n,"collection"),alt:ht(n,"alt"),height:pt(n,"height"),width:pt(n,"width"),size:pt(n,"size"),name:ht(n,"name"),mimeType:ht(n,"mimeType")}},vt=function(e){return Object.keys(e).filter((function(t){return"undefined"!==typeof e[t]&&null!==e[t]})).map((function(t){var n=e[t];if("undefined"!==typeof n&&null!==n)return"".concat(encodeURIComponent(t),"=").concat(encodeURIComponent(n.toString()))})).join("&")},bt=function(e,t){if(/^((?!chrome|android).)*safari/i.test(navigator.userAgent))return e;var n=ft(ft({},S()({},lt,"true")),t),r=vt(n);return"".concat(e,"#").concat(r)},yt=n(2401),gt=Oe.a,wt=Se.c,Ot=Se.b,xt=Se.d,jt=yt.c,kt=yt.b,St=yt.a,It=yt.f,Pt=yt.e,Ft=yt.d},2391:function(e,t,n){"use strict";n.d(t,"f",(function(){return i})),n.d(t,"b",(function(){return o})),n.d(t,"c",(function(){return a})),n.d(t,"a",(function(){return c})),n.d(t,"e",(function(){return u})),n.d(t,"d",(function(){return s}));var r=n(2441),i="recents",o=2592e3,a=4096,c=4*r.a.MB,u=1e3,s=2*r.a.TB},2392:function(e,t,n){"use strict";n.d(t,"f",(function(){return y})),n.d(t,"g",(function(){return w})),n.d(t,"d",(function(){return O})),n.d(t,"k",(function(){return x})),n.d(t,"i",(function(){return j})),n.d(t,"h",(function(){return S})),n.d(t,"j",(function(){return P})),n.d(t,"b",(function(){return F})),n.d(t,"a",(function(){return C})),n.d(t,"e",(function(){return R})),n.d(t,"c",(function(){return B}));var r=n(12),i=n.n(r),o=n(26),a=n.n(o),c=n(24),u=n.n(c),s=n(23),f=n.n(s),l=n(1),d=n.n(l),p=n(214);var h=n(2467);function m(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function v(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?m(Object(n),!0).forEach((function(t){d()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):m(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function b(e){return new Promise((function(t){return setTimeout(t,e)}))}function y(e){return e instanceof Error&&"request_cancelled"===e.message||!!e&&"AbortError"===e.name}function g(e){return e instanceof TypeError}function w(e){return!!e&&Object(h.b)(e)&&429===e.attributes.statusCode||!!e&&!!e.message&&e.message.includes("429")}function O(e,t){var n=t.params,r=t.auth,i=new URL(e),o=r&&function(e){return Object(p.isClientBasedAuth)(e)?{client:e.clientId,token:e.token}:{issuer:e.asapIssuer,token:e.token}}(r)||{},a=v(v({},n),o);return Object.entries(a).filter((function(e){var t=f()(e,2);t[0];return null!=t[1]})).forEach((function(e){var t;(t=i.searchParams).append.apply(t,u()(e))})),i.searchParams.sort(),i.toString()}function x(e){return function(t){return e?v(v({},t||{}),function(e){return Object(p.isClientBasedAuth)(e)?{"X-Client-Id":e.clientId,Authorization:"Bearer ".concat(e.token)}:{"X-Issuer":e.asapIssuer,Authorization:"Bearer ".concat(e.token)}}(e)):t}}function j(e){return k.apply(this,arguments)}function k(){return(k=a()(i.a.mark((function e(t){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.warn("Helper is deprecated and will be remove in the next major version"),e.prev=1,e.next=4,t.json();case 4:return e.abrupt("return",e.sent);case 7:throw e.prev=7,e.t0=e.catch(1),new h.a("serverInvalidBody",{statusCode:t.status},e.t0);case 10:case"end":return e.stop()}}),e,null,[[1,7]])})))).apply(this,arguments)}function S(e){return I.apply(this,arguments)}function I(){return(I=a()(i.a.mark((function e(t){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.warn("Helper is deprecated and will be remove in the next major version"),e.prev=1,e.next=4,t.blob();case 4:return e.abrupt("return",e.sent);case 7:throw e.prev=7,e.t0=e.catch(1),new h.a("serverInvalidBody",{statusCode:t.status},e.t0);case 10:case"end":return e.stop()}}),e,null,[[1,7]])})))).apply(this,arguments)}function P(){return console.warn("Helper is deprecated and will be remove in the next major version"),Promise.resolve()}function F(e){return function(){var t=a()(i.a.mark((function t(n){return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,n.json();case 3:return t.abrupt("return",t.sent);case 6:throw t.prev=6,t.t0=t.catch(0),new h.a("serverInvalidBody",v(v(v({},e),M(n)),{},{statusCode:n.status}),t.t0);case 9:case"end":return t.stop()}}),t,null,[[0,6]])})));return function(e){return t.apply(this,arguments)}}()}function C(e){return function(){var t=a()(i.a.mark((function t(n){return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,n.blob();case 3:return t.abrupt("return",t.sent);case 6:throw t.prev=6,t.t0=t.catch(0),new h.a("serverInvalidBody",v(v(v({},e),M(n)),{},{statusCode:n.status}),t.t0);case 9:case"end":return t.stop()}}),t,null,[[0,6]])})));return function(e){return t.apply(this,arguments)}}()}var E={startTimeoutInMs:1e3,maxAttempts:5,factor:2};function U(e,t){var n=e.reason,r=e.metadata,i=e.innerError;return new h.a(n,v(v({},r),t),i)}function R(e,t){return T.apply(this,arguments)}function T(){return T=a()(i.a.mark((function e(t,n){var r,o,c,u,s,f,l,d,p,m=arguments;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=m.length>2&&void 0!==m[2]?m[2]:{},o=v(v({},E),r),c=o.startTimeoutInMs,u=o.maxAttempts,s=o.factor,f=0,l=c,p=function(){var e=a()(i.a.mark((function e(){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,b(l);case 2:l*=s,f+=1;case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();case 6:if(!(f<u)){e.next=24;break}return e.prev=7,e.next=10,t();case 10:return e.abrupt("return",e.sent);case 13:if(e.prev=13,e.t0=e.catch(7),d=e.t0,!y(e.t0)){e.next=18;break}throw new h.a("clientAbortedRequest",n,e.t0);case 18:if((g(e.t0)||Object(h.b)(e.t0))&&(!Object(h.b)(e.t0)||e.t0.metadata&&e.t0.metadata.statusCode&&!(e.t0.metadata.statusCode<500))){e.next=20;break}throw e.t0;case 20:return e.next=22,p();case 22:e.next=6;break;case 24:if(!Object(h.b)(d)){e.next=26;break}throw U(d,{attempts:f,clientExhaustedRetries:!0});case 26:throw new h.a("serverUnexpectedError",v(v({},n),{},{attempts:f,clientExhaustedRetries:!0}),d);case 27:case"end":return e.stop()}}),e,null,[[7,13]])}))),T.apply(this,arguments)}function B(e){return function(t){if(t.ok||t.status<400)return t;var n=function(e,t){var n=t.status,r=function(e){switch(e){case 400:return"serverBadRequest";case 401:return"serverUnauthorized";case 403:return"serverForbidden";case 404:return"serverNotFound";case 429:return"serverRateLimited";case 500:return"serverInternalError";case 502:return"serverBadGateway";default:return"serverUnexpectedError"}}(n);return new h.a(r,v(v(v({},e),M(t)),{},{statusCode:n}))}(e,t);throw n}}function M(e){var t=e.headers;return{mediaRegion:t.get("x-media-region")||"unknown",mediaEnv:t.get("x-media-env")||"unknown"}}},2431:function(e,t,n){"use strict";n.d(t,"a",(function(){return F})),n.d(t,"b",(function(){return U})),n.d(t,"c",(function(){return R}));var r=n(12),i=n.n(r),o=n(26),a=n.n(o),c=n(9),u=n.n(c),s=n(10),f=n.n(s),l=n(1),d=n.n(l),p=n(2391),h=n(2519),m=n(2520),v=n(2392),b=n(2466),y=function(e,t){return new Promise((function(n,r){setTimeout(r,e,t)}))},g=function(){var e=a()(i.a.mark((function e(t,n){var r,o,a=arguments;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=a.length>2&&void 0!==a[2]?a[2]:1e4,e.prev=1,e.next=4,Promise.race([t(n),y(r,new b.a("authProviderTimedOut"))]);case 4:o=e.sent,e.next=12;break;case 7:if(e.prev=7,e.t0=e.catch(1),!(e.t0 instanceof b.a)){e.next=11;break}throw e.t0;case 11:throw new b.a("failedAuthProvider",e.t0);case 12:if(o){e.next=14;break}throw new b.a("emptyAuth");case 14:return e.abrupt("return",o);case 15:case"end":return e.stop()}}),e,null,[[1,7]])})));return function(t,n){return e.apply(this,arguments)}}();function w(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function O(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?w(Object(n),!0).forEach((function(t){d()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):w(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var x="media-api-region",j="media-api-environment",k={"max-age":p.b,allowAnimated:!0,mode:"crop"},S={limit:30,sortDirection:"desc"},I=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return O(O(O({},k),e),t?{width:p.c,height:p.c}:{})},P={Accept:"application/json","Content-Type":"application/json"},F=function(){function e(t,n){var r=this;u()(this,e),d()(this,"resolveAuth",(function(e){return g(r.config.authProvider,e)})),d()(this,"resolveInitialAuth",(function(){return function(e){if(!e)throw new b.a("missingInitialAuth");return e}(r.config.initialAuth)})),this.config=t,this.featureFlags=n}return f()(e,[{key:"getCollectionItems",value:function(){var e=a()(i.a.mark((function e(t,n){var r,o,a,c,u,s,f,l;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=O(O({},r={method:"GET",endpoint:"/collection/{collectionName}/items"}),{},{authContext:{collectionName:t},params:O(O({},S),n),headers:{Accept:"application/json"}}),e.next=4,this.request("/collection/".concat(t,"/items"),o);case 4:return a=e.sent,e.next=7,Object(v.b)(r)(a);case 7:return c=e.sent,u=c.data,s=u.contents,f=u.nextInclusiveStartKey,l=s.filter((function(e){return e.details.size&&e.details.size>0})),e.abrupt("return",{data:{contents:l,nextInclusiveStartKey:f}});case 13:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"removeCollectionFile",value:function(){var e=a()(i.a.mark((function e(t,n,r){var o,a;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o={actions:[{action:"remove",item:{type:"file",id:t,occurrenceKey:r}}]},a=O(O({},{method:"PUT",endpoint:"/collection/{collectionName}"}),{},{authContext:{collectionName:n},headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(o)}),e.next=5,this.request("/collection/".concat(n),a);case 5:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"createUpload",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1?arguments[1]:void 0,n={method:"POST",endpoint:"/upload"},r=O(O({},n),{},{authContext:{collectionName:t},params:{createUpTo:e},headers:{Accept:"application/json"}});return this.request("/upload",r).then(Object(v.b)(n))}},{key:"uploadChunk",value:function(){var e=a()(i.a.mark((function e(t,n){var r,o,a,c,u,s=arguments;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=s.length>2&&void 0!==s[2]?s[2]:{},o=r.collectionName,a=r.uploadId,c=r.partNumber,u=O(O({},{method:"PUT",endpoint:"/chunk/{etag}"}),{},{params:{uploadId:a,partNumber:c},authContext:{collectionName:o},body:n}),e.next=5,this.request("/chunk/".concat(t),u);case 5:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"probeChunks",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.collectionName,r=t.uploadId,i={method:"POST",endpoint:"/chunk/probe"},o=O(O({},i),{},{params:{uploadId:r},authContext:{collectionName:n},headers:P,body:JSON.stringify({chunks:e})});return this.request("/chunk/probe",o).then(Object(v.b)(i))}},{key:"createFileFromUpload",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n={method:"POST",endpoint:"/file/upload"},r=O(O({},n),{},{authContext:{collectionName:t.collection},params:t,headers:P,body:JSON.stringify(e)});return this.request("/file/upload",r).then(Object(v.b)(n))}},{key:"touchFiles",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n={method:"POST",endpoint:"/upload/createWithFiles"},r=O(O({},n),{},{authContext:{collectionName:t.collection},headers:P,body:JSON.stringify(e)});return this.request("/upload/createWithFiles",r).then(Object(v.b)(n))}},{key:"getFile",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n={method:"GET",endpoint:"/file/{fileId}"},r=O(O({},n),{},{authContext:{collectionName:t.collection},params:t});return this.request("/file/".concat(e),r).then(Object(v.b)(n))}},{key:"getFileImageURL",value:function(){var e=a()(i.a.mark((function e(t,n){var r,o;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=(n||{}).collection,e.next=3,this.resolveAuth({collectionName:r});case 3:return o=e.sent,e.abrupt("return",this.createFileImageURL(t,o,n));case 5:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"getFileImageURLSync",value:function(e,t){var n=this.resolveInitialAuth();return this.createFileImageURL(e,n,t)}},{key:"createFileImageURL",value:function(e,t,n){var r={params:I(n),auth:t};return Object(v.d)("".concat(t.baseUrl,"/file/").concat(e,"/image"),r)}},{key:"getFileBinaryURL",value:function(){var e=a()(i.a.mark((function e(t,n){var r,o;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.resolveAuth({collectionName:n});case 2:return r=e.sent,o={params:{dl:!0,collection:n,"max-age":p.b},auth:r},e.abrupt("return",Object(v.d)("".concat(r.baseUrl,"/file/").concat(t,"/binary"),o));case 5:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"getArtifactURL",value:function(){var e=a()(i.a.mark((function e(t,n,r){var o,a,c;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(o=Object(h.a)(t,n)){e.next=3;break}throw new Error("artifact ".concat(n," not found"));case 3:return e.next=5,this.resolveAuth({collectionName:r});case 5:return a=e.sent,c={params:{collection:r,"max-age":p.b},auth:a},e.abrupt("return",Object(v.d)("".concat(a.baseUrl).concat(o),c));case 8:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"getImage",value:function(){var e=a()(i.a.mark((function e(t,n,r,o){var a,c,u;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return!1,u=O(O({},c={method:"GET",endpoint:"/file/{fileId}/image"}),{},{authContext:{collectionName:n&&n.collection},params:I(n,o),headers:a}),e.abrupt("return",this.request("/file/".concat(t,"/image"),u,r).then(Object(v.a)(c)));case 5:case"end":return e.stop()}}),e,this)})));return function(t,n,r,i){return e.apply(this,arguments)}}()},{key:"getItems",value:function(){var e=a()(i.a.mark((function e(t,n){var r,o,a;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.map((function(e){return{type:"file",id:e,collection:n}})),a=O(O({},o={method:"POST",endpoint:"/items"}),{},{authContext:{collectionName:n},headers:P,body:JSON.stringify({descriptors:r})}),e.abrupt("return",this.request("/items",a).then(Object(v.b)(o)));case 4:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"getImageMetadata",value:function(){var e=a()(i.a.mark((function e(t,n){var r,o;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=O(O({},r={method:"GET",endpoint:"/file/{fileId}/image/metadata"}),{},{authContext:{collectionName:n&&n.collection},params:n}),e.abrupt("return",this.request("/file/".concat(t,"/image/metadata"),o).then(Object(v.b)(r)));case 3:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"appendChunksToUpload",value:function(){var e=a()(i.a.mark((function e(t,n,r){var o;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=O(O({},{method:"PUT",endpoint:"/upload/{uploadId}/chunks"}),{},{authContext:{collectionName:r},headers:P,body:JSON.stringify(n)}),e.next=4,this.request("/upload/".concat(t,"/chunks"),o);case 4:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"copyFileWithToken",value:function(e,t){var n={method:"POST",endpoint:"/file/copy/withToken"},r=O(O({},n),{},{authContext:{collectionName:t.collection},params:t,headers:P,body:JSON.stringify(e)});return this.request("/file/copy/withToken",r).then(Object(v.b)(n))}},{key:"request",value:function(){var e=a()(i.a.mark((function e(t){var n,r,o,a,c,u,s,f,l,d,p,h=arguments;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=h.length>1&&void 0!==h[1]?h[1]:{method:"GET",endpoint:void 0,authContext:{}},r=h.length>2?h[2]:void 0,o=n.method,a=n.endpoint,c=n.authContext,u=n.params,s=n.headers,f=n.body,l=n.clientOptions,e.next=5,this.resolveAuth(c);case 5:return d=e.sent,e.next=8,Object(m.a)("".concat(d.baseUrl).concat(t),{method:o,endpoint:a,auth:d,params:u,headers:s,body:f,clientOptions:l},r);case 8:return p=e.sent,E(x,p.headers.get("x-media-region")),E(j,p.headers.get("x-media-env")),e.abrupt("return",p);case 12:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),e}(),C=function(e){return window&&window.sessionStorage&&window.sessionStorage.getItem(e)||void 0},E=function(e,t){t&&window&&window.sessionStorage&&(window.sessionStorage.getItem(e)!==t&&window.sessionStorage.setItem(e,t))},U=function(){return C(j)},R=function(){return C(x)}},2441:function(e,t,n){"use strict";n.d(t,"c",(function(){return o})),n.d(t,"b",(function(){return a})),n.d(t,"a",(function(){return r}));var r,i=n(3117),o=function(e,t){var n=["audio","video","image"];return Object(i.c)("newCardExperience",t)?[].concat(n,["doc"]).indexOf(e)>-1:n.indexOf(e)>-1},a=function(e){return!!e.mediaType&&!!e.mimeType&&!!e.processingStatus};!function(e){e[e.MB=1048576]="MB",e[e.GB=1073741824]="GB",e[e.TB=1099511627776]="TB"}(r||(r={}))},2466:function(e,t,n){"use strict";n.d(t,"a",(function(){return h})),n.d(t,"b",(function(){return m}));var r=n(9),i=n.n(r),o=n(10),a=n.n(o),c=n(15),u=n.n(c),s=n(18),f=n.n(s),l=n(7),d=n.n(l);function p(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=d()(e);if(t){var i=d()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return f()(this,n)}}var h=function(e){u()(n,e);var t=p(n);function n(e,r){var o;return i()(this,n),(o=t.call(this,e)).reason=e,o.innerError=r,o}return a()(n,[{key:"attributes",get:function(){return{reason:this.reason,innerError:this.innerError}}}]),n}(n(2411).a);function m(e){return e instanceof h}},2467:function(e,t,n){"use strict";n.d(t,"a",(function(){return h})),n.d(t,"b",(function(){return m}));var r=n(9),i=n.n(r),o=n(10),a=n.n(o),c=n(15),u=n.n(c),s=n(18),f=n.n(s),l=n(7),d=n.n(l);function p(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=d()(e);if(t){var i=d()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return f()(this,n)}}var h=function(e){u()(n,e);var t=p(n);function n(e,r,o){var a;return i()(this,n),(a=t.call(this,e)).reason=e,a.metadata=r,a.innerError=o,a}return a()(n,[{key:"attributes",get:function(){var e=this.reason,t=this.metadata;return{reason:e,method:(t=void 0===t?{}:t).method,endpoint:t.endpoint,mediaRegion:t.mediaRegion,mediaEnv:t.mediaEnv,attempts:t.attempts,clientExhaustedRetries:t.clientExhaustedRetries,statusCode:t.statusCode,innerError:this.innerError}}}]),n}(n(2411).a);function m(e){return e instanceof h}},2519:function(e,t,n){"use strict";n.d(t,"a",(function(){return r}));var r=function(e,t){var n=e[t];if(n&&n.url)return n.url}},2520:function(e,t,n){"use strict";n.d(t,"a",(function(){return u}));var r=n(12),i=n.n(r),o=n(26),a=n.n(o),c=n(2392);function u(e){return s.apply(this,arguments)}function s(){return s=a()(i.a.mark((function e(t){var n,r,o,a,u,s,f,l,d,p,h,m,v,b=arguments;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=b.length>1&&void 0!==b[1]?b[1]:{},r=b.length>2?b[2]:void 0,o=n.method,a=void 0===o?"GET":o,u=n.endpoint,s=n.auth,f=n.params,l=n.headers,d=n.body,p=n.clientOptions,h=(void 0===p?{}:p).retryOptions,m={method:a,endpoint:u},v=function(){return fetch(Object(c.d)(t,{params:f}),{method:a,body:d,headers:Object(c.k)(s)(l),signal:r&&r.signal}).then(Object(c.c)(m))},e.abrupt("return",Object(c.e)(v,m,h));case 7:case"end":return e.stop()}}),e)}))),s.apply(this,arguments)}},2521:function(e,t,n){"use strict";function r(e){return e instanceof Object&&"attributes"in e&&e.attributes instanceof Object&&"reason"in e.attributes&&e instanceof Error}function i(e){return r(e)?e.attributes.reason:"unknown"}n.d(t,"b",(function(){return r})),n.d(t,"a",(function(){return i}))},2522:function(e,t,n){"use strict";n.d(t,"a",(function(){return i}));var r=n(214),i={on:function(e,t){r.mediaState.eventEmitter&&r.mediaState.eventEmitter.on(e,t)},off:function(e,t){r.mediaState.eventEmitter&&r.mediaState.eventEmitter.off(e,t)},emit:function(e,t){if(r.mediaState.eventEmitter)return r.mediaState.eventEmitter.emit(e,t)}}},2566:function(e,t,n){"use strict";n.d(t,"a",(function(){return s}));var r=n(12),i=n.n(r),o=n(26),a=n.n(o),c=function(e){return new Promise((function(t,n){var r=new Image;r.src=e,r.onload=function(){return t({width:r.width,height:r.height})},r.onerror=n}))},u=n(2600),s=function(){var e=a()(i.a.mark((function e(t,n){var r;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:e.t0=t,e.next="image"===e.t0?3:"video"===e.t0?11:12;break;case 3:return r=URL.createObjectURL(n),e.prev=4,e.next=7,c(r);case 7:return e.abrupt("return",e.sent);case 8:return e.prev=8,URL.revokeObjectURL(r),e.finish(8);case 11:return e.abrupt("return",Object(u.a)(n));case 12:throw new Error("Can't extract dimensions from ".concat(t));case 13:case"end":return e.stop()}}),e,null,[[4,,8,11]])})));return function(t,n){return e.apply(this,arguments)}}()},2596:function(e,t,n){"use strict";n.d(t,"a",(function(){return c}));var r=n(9),i=n.n(r),o=n(10),a=n.n(o),c=function(){function e(){i()(this,e)}return a()(e,[{key:"setAbort",value:function(e){this.abortFunction=e}},{key:"abort",value:function(){this.abortFunction&&this.abortFunction()}}]),e}()},2597:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(227);t.Observable=r.Observable;var i=n(792),o=n(2742);t.asyncMap=function(e,t){return i.mergeMap(function(e){var t=new Array,n=function(){var e=t.findIndex((function(e){return!e.notifyIfReady()}));e>0&&t.splice(0,e)};return function(i){return new r.Observable((function(r){t.push(o.notify(e(i),r,n))}))}}(e),t)}},2742:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.notify=function(e,t,n){var r={notifyIfReady:function(){return!1}};return e.then((function(e){r.notifyIfReady=function(){return t.next(e),t.complete(),!0},n(r)}),(function(e){r.notifyIfReady=function(){return t.error(e),!0},n(r)})),r}},3117:function(e,t,n){"use strict";n.d(t,"b",(function(){return s})),n.d(t,"a",(function(){return f})),n.d(t,"c",(function(){return d}));var r=n(23),i=n.n(r),o=(n(0),function(e){try{return"undefined"!==typeof window&&window.localStorage?window.localStorage.getItem(e):null}catch(t){}return null}),a=["confluence","jira"],c={confluence:{newCardExperience:"confluence.frontend.media.cards.new.experience",captions:"confluence.frontend.fabric.editor.media.captions",mediaInline:"confluence.frontend.fabric.editor.media.inline",folderUploads:"confluence.frontend.media.picker.folder.uploads",observedWidth:"",timestampOnVideo:"",mediaUploadApiV2:"confluence.enable.media.upload.api.v2"},jira:{newCardExperience:"issue.details.media-cards-new-experience",captions:"issue.details.editor.media.captions",mediaInline:"",folderUploads:"issue.details.media-picker-folder-upload",observedWidth:"",timestampOnVideo:"",mediaUploadApiV2:"issue.details.enable-media-upload-api-version-2"}},u=function(){return c},s=function(e){return Object.entries(e).filter((function(e){var t=i()(e,2);t[0];return!!t[1]})).map((function(e){return i()(e,1)[0]}))},f=function(e){var t=s(e),n=[];return t.forEach((function(e){return a.forEach((function(t){return n.push(u()[t][e])}))})),n.filter((function(e){return""!==e}))},l={newCardExperience:!1,captions:!1,mediaInline:!1,folderUploads:!1,observedWidth:!1,timestampOnVideo:!1,mediaUploadApiV2:!0};function d(e,t){var n=o(e);if(null!==n)try{return JSON.parse(n)}catch(r){}return t&&e in t?t[e]:l[e]}Object.keys(l).forEach((function(e){var t=o(e);null!==t&&console.info("%c* LOCAL * MediaFeatureFlag.".concat(e," = ").concat(t),"font-weight:bold;color:cyan")}))}}]);