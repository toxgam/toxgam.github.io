(this["webpackJsonphappy-author"]=this["webpackJsonphappy-author"]||[]).push([[28],{2425:function(e,t,n){"use strict";n.r(t),n.d(t,"DropzoneBase",(function(){return U})),n.d(t,"Dropzone",(function(){return B}));var r,i=n(15),a=n.n(i),o=n(22),s=n.n(o),u=n(9),c=n.n(u),f=n(10),v=n.n(f),l=n(4),d=n.n(l),p=n(12),g=n.n(p),h=n(13),m=n.n(h),D=n(6),y=n.n(D),A=n(1),E=n.n(A),L=n(2011),b=n(215),k=n(1254),F=n(3007);function O(e){var t=void 0!==e?e:navigator;if(void 0!==e&&(r=void 0),void 0===r){if("undefined"!==typeof t){var n=/Edge\/(\d+)/.exec(t.userAgent),i=/MSIE \d/.test(t.userAgent),a=/Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(t.userAgent),o=/Opera/.test(t.platform)||/OPR/.test(t.platform),s=!!(i||a||n),u=/Firefox/.test(t.userAgent);return!s&&!o&&!u}return!1}return r}var T=n(335),w=function(e){return[].concat.apply([],e)},x=function e(t){return t.isDirectory?function(e){return new Promise((function(t){e.createReader().readEntries(t)}))}(t).then((function(t){var n=t.map(e);return Promise.all(n).then((function(e){return w(e)}))})):Promise.resolve([t])},C=function(e){var t,n=(t=e,[].slice.call(t,0)).map((function(e){var t=e.webkitGetAsEntry();return x(t)}));return Promise.all(n).then((function(e){return w(e)}))},P=function(e){return new Promise((function(t){var n=[];e.forEach((function(r){r.file((function(r){n.push(r),n.length===e.length&&t(n)}))}))}))},I=(function(){function e(e,t){var n=this;this.onDrop=function(e){return Object(T.b)(n,void 0,void 0,(function(){var t,n,r;return Object(T.d)(this,(function(i){switch(i.label){case 0:return e.preventDefault(),t=this.callback,n=e.dataTransfer.items,[4,C(n)];case 1:return r=i.sent(),t(r),[2]}}))}))},this.dropzone=e,this.callback=t}e.prototype.subscribe=function(){var e=this.dropzone;e.addEventListener("dragover",this.onDragOver,!1),e.addEventListener("drop",this.onDrop)},e.prototype.onDragOver=function(e){e.preventDefault()}}(),n(2235)),R=n(2223);function S(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=y()(e);if(t){var i=y()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return m()(this,n)}}function j(e){if(!e.dataTransfer)return!1;var t=e.dataTransfer.types;return Array.from(t).indexOf("Files")>-1}var z="dropzone",U=function(e){g()(n,e);var t=S(n);function n(e){var r;return c()(this,n),r=t.call(this,e,z),E()(d()(r),"uiActive",!1),E()(d()(r),"addContainerListeners",(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:r.getContainer();e.addEventListener("dragover",r.onDragOver,!1),e.addEventListener("dragleave",r.onDragLeave,!1),e.addEventListener("drop",r.onFileDropped)})),E()(d()(r),"removeContainerListeners",(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:r.getContainer();e.removeEventListener("dragover",r.onDragOver,!1),e.removeEventListener("dragleave",r.onDragLeave,!1),e.removeEventListener("drop",r.onFileDropped)})),E()(d()(r),"onDragOver",(function(e){if(e.preventDefault(),e.dataTransfer&&j(e)){var t,n=e.dataTransfer;try{t=n.effectAllowed}catch(a){}n.dropEffect="move"===t||"linkMove"===t?"move":"copy";var i=r.getDraggedItemsLength(n);e.stopPropagation(),r.emitDragOver({length:i})}})),E()(d()(r),"onDragLeave",(function(e){if(e.dataTransfer){e.preventDefault();var t=0;if(j(e)){var n=e.dataTransfer;t=r.getDraggedItemsLength(n)}r.emitDragLeave({length:t})}})),E()(d()(r),"onFileDropped",function(){var e=s()(a.a.mark((function e(t){var n,i;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.dataTransfer){e.next=2;break}return e.abrupt("return");case 2:if(t.preventDefault(),t.stopPropagation(),!O()||!Object(b.a)("folderUploads",r.props.featureFlags)){e.next=13;break}return r.fireAnalyticsForFolders(t.dataTransfer.items),e.next=8,r.getFilesFromDragEvent(t.dataTransfer.items);case 8:n=e.sent,r.onDropFolders(n.length),r.uploadService.addFiles(n),e.next=16;break;case 13:r.onDrop(t),i=Array.from(t.dataTransfer.files),r.uploadService.addFiles(i);case 16:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),E()(d()(r),"fireAnalyticsForFolders",(function(e){var t=Array.from(e),n=t.filter((function(e){return function(e){return e.webkitGetAsEntry().isDirectory}(e)})).length;n>0&&r.fireAnalyticsEvent("folderDroppedInto",n)})),E()(d()(r),"getFilesFromDragEvent",function(){var e=s()(a.a.mark((function e(t){var n,i,o;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t,e.next=3,C(n);case 3:return i=e.sent,e.next=6,P(i);case 6:return o=e.sent,e.abrupt("return",r.filterFilesAgainstBlacklist(o));case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),E()(d()(r),"filterFilesAgainstBlacklist",(function(e){var t=[".DS_Store","thumbs.db","desktop.ini"];return e.filter((function(e){return!t.includes(e.name)}))})),E()(d()(r),"onDropFolders",(function(e){e>0&&r.sendAnalyticsAndEmitDragLeave(e)})),E()(d()(r),"onDrop",(function(e){if(e.dataTransfer&&j(e)){var t=e.dataTransfer,n=r.getDraggedItemsLength(t);r.sendAnalyticsAndEmitDragLeave(n)}})),E()(d()(r),"sendAnalyticsAndEmitDragLeave",(function(e){r.fireAnalyticsEvent("droppedInto",e),r.props.onDrop&&r.props.onDrop(),r.emitDragLeave({length:e})})),r}return v()(n,[{key:"getContainer",value:function(){return this.props.config.container||document.body}},{key:"componentDidMount",value:function(){var e=this.props.onCancelFn;this.addContainerListeners(this.getContainer()),e&&e(this.cancel)}},{key:"componentWillUnmount",value:function(){this.removeContainerListeners(this.getContainer())}},{key:"UNSAFE_componentWillReceiveProps",value:function(e){var t=e.config.container,n=this.props.config.container;t!==n&&(this.removeContainerListeners(n),this.addContainerListeners(t))}},{key:"getDraggedItemsLength",value:function(e){return e.items?Array.from(e.items).filter((function(e){return"file"===e.kind})).length:e.files.length}},{key:"emitDragOver",value:function(e){if(!this.uiActive){var t=this.props.onDragEnter;this.uiActive=!0,this.fireAnalyticsEvent("draggedInto",e.length),t&&t(e)}}},{key:"emitDragLeave",value:function(e){var t=this;this.uiActive&&(this.uiActive=!1,window.setTimeout((function(){if(!t.uiActive){var n=t.props.onDragLeave;t.fireAnalyticsEvent("draggedOut",e.length),n&&n(e)}}),50))}},{key:"fireAnalyticsEvent",value:function(e,t){var n=this.props.createAnalyticsEvent;n&&n({eventType:"ui",actionSubject:"dropzone",action:e,attributes:{fileCount:t}}).fire(k.a)}},{key:"render",value:function(){return null}}]),n}(I.a),B=Object(F.a)(Object(R.a)(z),{filterFeatureFlags:["folderUploads","newCardExperience"]})(Object(L.a)()(U))}}]);